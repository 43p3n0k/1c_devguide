<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>&#1043;&#1083;&#1072;&#1074;&#1072; 18. &#1052;&#1077;&#1093;&#1072;&#1085;&#1080;&#1079;&#1084; &#1079;&#1072;&#1076;&#1072;&#1085;&#1080;&#1081;</title>
		<LINK REL="stylesheet" href="/db/content/v8310doc/src/руководство разработчика/style.css?_=1496848987">
		<script charset="windows-1251" src="/db/content/v8310doc/src/руководство разработчика/script.js?_=1496848987" TYPE="text/javascript"></script>		<!--[if !IE]>--><script charset="windows-1251" src="/db/content/v8310doc/src/руководство разработчика/zeroclipboard.js?_=1496848987" TYPE="text/javascript"></script><!--<![endif]-->
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="/db/content/v8310doc/src/руководство разработчика/глава 18. механизм заданий.htm" rel="canonical">
<link href="/static/its.content.css?_=1490872753" type="text/css" rel="stylesheet">
<script charset="windows-1251" type="text/javascript" src="/static/its.content.js?_=1489758009"></script>
<!--[if lt IE 9]><script charset="windows-1251" type="text/javascript" src="/static/html5shiv.js?_=1484636606"></script><![endif]-->

</head>
	<body class="v8310doc">
<a name="_ref214443770"></a><a name="_ref214437041"></a><a name="_ref213649880"></a><a name="_ref254102949"></a><a name="_ref237783519"></a><a id="TI000000792" class="bookmark"><h1>Глава 18.  Механизм заданий</h1></a>

<a id="TI000001595" class="bookmark" name="issogl1_18.1_общая_информация"><h2>18.1. Общая информация</h2></a>

<p class="MsoNormalCxSpFirst">Механизм
заданий предназначен для выполнения какой-либо прикладной функциональности по
расписанию или асинхронно.</p>

<p class="MsoNormalCxSpLast">Механизм
заданий решает следующие задачи:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
возможность определения регламентных процедур на
этапе конфигурирования системы;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
выполнение заданных действий по расписанию;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
выполнение вызова заданной процедуры или функции
асинхронно, т. е. без ожидания ее завершения;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
отслеживание хода выполнения определенного задания
и получение его статуса завершения (значения, указывающего успешность или
неуспешность его выполнения);</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
получение списка текущих заданий;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
возможность ожидания завершения одного или
нескольких заданий;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
управление заданиями (возможность отмены,
блокировка выполнения и др.).</p>

<p class="MsoNormal">Механизм
заданий состоит из следующих компонентов:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
метаданных регламентных заданий,</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
регламентных заданий,</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
фоновых заданий,</p>

<p class="MsoListBulletCxSpLast">&#9679; 
планировщика заданий.</p>

<p class="MsoNormalCxSpFirst"><span class="Bold">Регламентные задания</span>
предназначены для выполнения прикладных задач по расписанию. Регламентные
задания хранятся в информационной базе и создаются на основе метаданных,
определяемых в конфигурации. Метаданные регламентного задания содержат такую
информацию, как наименование, метод, использование и т. д.</p>

<p class="MsoNormalCxSpMiddle">Регламентное
задание имеет <span class="Bold">расписание</span>, которое определяет, в какие моменты
времени нужно выполнять связанный с регламентным заданием метод. Расписание,
как правило, задается в информационной базе, но может быть задано и на этапе
конфигурирования (например, для предопределенных регламентных заданий).</p>

<p class="MsoNormalCxSpMiddle"><span class="Bold">Фоновые задания</span> предназначены для выполнения прикладных
задач асинхронно, реализуются средствами встроенного языка.</p>

<p class="MsoNormalCxSpLast"><span class="Bold">Планировщик заданий</span> используется для планирования выполнения
регламентных заданий. Для каждого регламентного задания планировщик периодически
проверяет, соответствует ли текущая дата и время расписанию регламентного
задания. Если соответствует, планировщик назначает такое задание на выполнение.
Для этого по данному регламентному заданию планировщик создает фоновое задание,
которое и выполняет реальную обработку.</p>

<a name="_ref337482766"></a><a name="_ref337482765"></a><a name="_ref370403743"></a><a name="_ref370403742"></a><a id="TI000000793" class="bookmark" name="issogl1_18.2_фоновые_задания"><h2>18.2. Фоновые задания</h2></a>

<p class="MsoNormalCxSpFirst">Фоновые
задания удобно использовать для выполнения сложных вычислений, когда результат
вычисления может быть получен через продолжительное время. Механизм заданий
имеет средства для выполнения таких вычислений асинхронно.</p>

<p class="MsoNormalCxSpMiddle">С
фоновым заданием связан метод, который вызывается при выполнении фонового
задания. В качестве метода фонового задания может выступать любая процедура или
функция неглобального общего модуля, которую можно вызвать на сервере. Параметрами
фонового задания могут быть любые значения, которые разрешено передавать на
сервер. Параметры фонового задания должны в точности соответствовать параметрам
той процедуры или функции, которую оно вызывает. Если методом фонового задания
является функция, то ее возвращаемое значение игнорируется.</p>

<p class="MsoNormalCxSpMiddle">Фоновое
задание может иметь <span class="Bold">ключ</span> – любое прикладное значение. Ключ
вводит ограничение на запуск фоновых заданий – в единицу времени может
выполняться только одно фоновое задание с определенным значением ключа и
заданным именем метода фонового задания (имя метода состоит из имени модуля и
имени процедуры или функции). Ключ позволяет группировать фоновые задания,
имеющие одинаковые методы, по определенному прикладному признаку с тем, чтобы в
рамках одной группы выполнялось не более одного фонового задания.</p>

<p class="MsoNormalCxSpMiddle">Создание
и управление фоновыми заданиями выполняются программно из любого соединения.
Создавать фоновое задание разрешено любому пользователю. При этом оно
выполняется от имени того пользователя, который его создал. Получать задания, а
также ожидать их завершения разрешено из любого соединения пользователю с
административными правами либо пользователю, который создал эти фоновые
задания. При проверке состояния фонового задания (с помощью свойства
фонового задания <span class="Term">Состояние</span>) следует помнить, что это состояние
не обновляется в существующем объекте типа <span class="Term">ФоновоеЗадание</span>.
Для проверки состояния необходимо перед каждой проверкой получать проверяемое
фоновое задание командой <span class="Term">ФЗ =
ФоновыеЗадания.НайтиПоУникальномуИдентификатору();</span>.</p>

<p class="MsoNormalCxSpMiddle">Фоновое
задание является чисто сеансовым объектом, но не принадлежит какому-либо
пользовательскому сеансу. Для каждого задания создается специальный системный
сеанс, выполняющийся от имени того пользователя, который выполнил вызов. Фоновые
задания не имеют сохраняемого состояния.</p>

<p class="MsoNormalCxSpMiddle">Фоновое
задание может порождать другие фоновые задания. В клиент-серверном варианте это
позволяет распараллеливать сложные вычисления по рабочим процессам кластера,
что может значительно ускорить процесс вычисления в целом. Распараллеливание
реализуется порождением нескольких дочерних фоновых заданий с ожиданием
завершения каждого из них в основном фоновом задании.</p>

<p class="MsoNormalCxSpMiddle">Фоновое задание имеет возможность помещать
данные во временное хранилище вызывающего сеанса (см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 20. механизм временного хранилища, работа с файлами и картинками.htm?_=1496848987#_ref263243074">здесь</a>). Это может быть использовано, например, для передачи
в вызывающий сеанс сформированного отчета или подготовленных для обработки
данных. Передача данных из вызывающего сеанса в сеанс фонового задания
невозможна.</p>

<p class="MsoNormalCxSpLast">Запуск фонового задания выполняется
следующим образом:</p>

<p class="MsoListBullet">&#9679; 
Выполняются служебные действия:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
Фиксируется факт запуска фонового задания в
журнале регистрации (см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 21. журнал регистрации.htm?_=1496848987#_ref248042713">здесь</a>);</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
Устанавливаются параметры соединения с внешними
источниками данных (см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 23. внешние источники данных.htm?_=1496848987#_ref370293939">здесь</a>);</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
Устанавливается режим интерфейса и т. д.</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
В модуле сеанса выполняется обработчик события <span class="Term">УстановкаПараметровСеанса</span>
(см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 4. встроенный язык.htm?_=1496848987#_ref419722284">здесь</a>);</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Выполняется собственно фоновое задание.</p>

<p class="MsoNormal">Завершившиеся
успешно или аварийно фоновые задания хранятся в течение суток, а потом
удаляются. История выполнения фоновых и регламентных заданий имеет следующие
особенности:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
История хранится для каждой информационной базы;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Хранится история выполнения:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
Фоновых заданий – не более 1 000 заданий.</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
Регламентных заданий – не более 1 000
заданий. При этом система пытается хранить не менее 3 последних запусков для
каждого различного регламентного задания. При превышении общего ограничения в
1 000 запусков, система будет пытаться обеспечить хранение 2 последних
запусков для каждого регламентного задания, а потом 1.</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
Системных фоновых заданий – не более
1 000 запусков. В данном разделе речь идет о фоновых заданиях, которые инициируются
системой для выполнения каких-либо действий (выполнение отчетов, поиск и т. д.).</p>

<p class="MsoNormal">При старте фонового задания в сеансе
фонового задания будут подключены те расширения, которые были подключены в родительском
сеансе. В тоже время имеется возможность запустить фоновое задание таким
образом, чтобы в сеансе фонового задания были подключены все расширения,
зарегистрированные для текущей информационной базы и текущего набора
разделителей. Для этого следует использовать метод <span class="Term">РасширенияКонфигурации.ВыполнитьФоновоеЗаданиеСРасширениямиБазыДанных()</span>.
Однако, в некоторых сценариях может потребоваться запускать фоновое задание
совсем без расширений конфигурации. Для этого следует использовать метод <span class="Term">РасширенияКонфигурации.ВыполнитьФоновоеЗаданиеБезРасширений()</span>.</p>

<a name="_ref416778995"></a><a name="_ref416778994"></a><a id="TI000000794" class="bookmark" name="issogl1_18.3_регламентные_задания"><h2>18.3. Регламентные задания</h2></a>

<p class="MsoNormalCxSpFirst">Регламентные
задания используются, когда необходимо выполнить определенные периодические или
однократные действия в соответствии с расписанием.</p>

<p class="MsoNormalCxSpMiddle">Регламентные
задания хранятся в информационной базе и создаются на основе метаданных
регламентного задания, определенных в конфигурации. Метаданные задают такие
параметры регламентного задания, как вызываемый метод, наименование, ключ,
возможность использования, признак предопределенности и др. При создании
регламентного задания дополнительно можно указать расписание (может быть указано
в метаданных), значения параметров метода, имя пользователя, от имени которого
должно выполняться регламентное задание, и др.</p>

<p class="MsoNormalCxSpLast">Создание
и управление регламентными заданиями выполняется с помощью встроенного языка из любого соединения и разрешены только
пользователям, имеющим административные права.</p>

<p class="Note"><span class="Note">Примечание. </span>При работе в файловом
варианте создавать и редактировать регламентные задания возможно без запуска планировщика
заданий.</p>

<p class="MsoNormalCxSpFirst">С
регламентным заданием связан метод, который вызывается при выполнении регламентного
задания. В качестве метода регламентного задания может выступать любая
процедура или функция неглобального общего модуля, которую можно вызвать на
сервере. Параметрами регламентного задания могут быть любые значения, которые
разрешено передавать на сервер. Параметры регламентного задания должны в
точности соответствовать параметрам той процедуры или функции, которую оно
вызывает. Если методом регламентного задания является функция, то ее
возвращаемое значение игнорируется.</p>

<p class="MsoNormalCxSpMiddle">Регламентное
задание может иметь <span class="Bold">ключ</span> – любое прикладное значение. Ключ
вводит ограничение на запуск регламентных заданий, т. к. в единицу
времени среди регламентных заданий, связанных с одним и тем же объектом
метаданных, может выполняться только одно регламентное задание с определенным
значением ключа. Ключ позволяет группировать регламентные задания, связанные с
одним и тем же объектом метаданных, по определенному прикладному признаку с
тем, чтобы в рамках одной группы выполнялось не более одного регламентного
задания.</p>

<p class="MsoNormalCxSpMiddle">При
конфигурировании можно определить <span class="Bold">предопределенные</span> регламентные задания. Предопределенные
регламентные задания ничем не отличаются от обычных регламентных заданий, за
исключением того, что их нельзя явно создавать и удалять. Если в метаданных
регламентного задания установлен признак предопределенного регламентного
задания, то при обновлении конфигурации в информационной базе автоматически
будет создано предопределенное регламентное задание. Если признак предопределенности
снят, то при обновлении конфигурации в информационной базе автоматически будет
удалено предопределенное регламентное задание. Начальные значения свойств
предопределенного регламентного задания (например, расписание) устанавливаются
в метаданных. В дальнейшем при работе приложения их можно менять через
соответствующие методы встроенного языка. Изменение свойств уже созданного
предопределенного регламентного задания в метаданных не окажет влияния на реальные
параметры этого задания в информационной базе. Предопределенные регламентные задания не имеют
параметров.</p>

<p class="MsoNormalCxSpLast">Расписание
регламентного задания определяет, в какие моменты времени регламентное задание
должно быть запущено. Расписание позволяет:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
задавать дату и время начала и окончания
выполнения задания;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
период выполнения;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
дни недели и месяцы, по которым нужно выполнять
регламентное задание и др. (см. описание встроенного языка).</p>

<p class="Lang-subheader">Примеры расписаний регламентных заданий:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Расписание</b></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Значения параметров</b></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Каждый
  час, только один день</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 0</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораВТечениеДня</span>
  = 3600</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Каждый
  день один раз в день</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 1</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораВТечениеДня</span>
  = 0</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Один
  день, один раз</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 0</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Через
  день один раз в день</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 2</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Каждый
  час с 01.00 до 07.00 каждый день</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 1</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораВТечениеДня</span>
  = 3600</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ВремяНачала</span>
  = 01.00</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ВремяКонца</span>
  = 07.00</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Каждую
  субботу и воскресенье в 09.00 </p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 1</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ДниНедели</span>
  = 6, 7</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ВремяНачала</span>
  = 09.00</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Каждый
  день одну неделю, неделя пропуска</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 1</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодНедель</span>
  = 2</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">В
  01.00 один раз</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ВремяНачала</span>
  = 01.00</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Последнее
  число каждого месяца в 9.00</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 1</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ДеньВМесяце</span>
  = -1</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ВремяНачала</span>
  = 09.00</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Пятое
  число каждого месяца в 9.00</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 1</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ДеньВМесяце</span>
  = 5</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ВремяНачала</span>
  = 09.00</p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Вторая
  среда каждого месяца в 9.00</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ПериодПовтораДней</span>
  = 1</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ДеньНеделиВМесяце</span>
  = 2</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ДниНедели</span>
  = 3</p>
  <p class="MsoNormalCxSpMiddle"><span class="Term">ВремяНачала</span>
  = 09.00</p>
  </td>
  
 </tr>
</table>

<p class="MsoNormalCxSpMiddle">Можно
проверять, выполняется ли задание для заданной даты (метод <span class="Term">ТребуетсяВыполнение()</span> объекта <span class="Term">РасписаниеРегламентныхЗаданий</span>). Регламентные задания всегда выполняются
от имени определенного пользователя. Если пользователь регламентного задания не
указан, то выполнение происходит с правами, которые определяются набором
ролей, указанных в свойстве конфигурации <span class="Term">ОсновныеРоли</span>.
В том случае, если в этом свойстве не указано ни одной роли, выполнение происходит без ограничения прав
доступа.</p>

<p class="MsoNormalCxSpMiddle">Выполнение
регламентных заданий происходит с использованием фоновых заданий. Когда
планировщик определяет, что регламентное задание должно быть запущено, то
автоматически на основе данного регламентного задания создается фоновое задание,
которое и выполняет всю дальнейшую обработку. Если данное регламентное задание
уже выполняется, то оно не будет запущено повторно, вне зависимости от его
расписания.</p>

<p class="MsoNormalCxSpMiddle">Регламентные
задания имеют возможность перезапуска. Это особенно актуально, когда метод
регламентного задания должен быть гарантированно выполнен. Перезапуск
регламентного задания осуществляется в том случае, когда оно завершено аварийно,
либо когда рабочий процесс (в клиент-серверном варианте) или клиентский процесс
(в файловом варианте), на котором выполнялось регламентное задание, завершен
аварийно. В регламентном задании можно указать, сколько раз нужно его перезапускать
(свойство <span class="Interface">Количество повторов
при аварийном завершении</span>), а также интервал между перезапусками
(свойство <span class="Interface">Интервал повтора при
аварийном завершении</span>). После выполнения заданного количества перезапусков, попытки
запуска прекращаются до момента, когда наступит очередное время старта
регламентного задания (в соответствии с расписанием). При этом счетчик
количества повторов сбрасывается и при аварийном завершении регламентного
задания, процесс перезапуска начинается сначала.</p>

<p class="MsoNormalCxSpLast">При
реализации метода перезапускаемого регламентного задания нужно учитывать, что
при перезапуске его выполнение будет начато с начала, а не продолжено с момента
аварийного завершения.</p>

<a name="_ref351996985"></a><a id="TI000000795" class="bookmark" name="issogl1_18.4_особенности_выполнения_фоновых_заданий_в_файловом_и_клиент-серверном_вариантах"><h2>18.4. Особенности выполнения фоновых заданий в файловом и клиент-серверном вариантах</h2></a>

<p class="MsoNormal">Механизмы
выполнения фоновых заданий в файловом и клиент-серверном вариантах различаются.</p>

<a name="_ref292462081"></a><a name="_ref392864183"></a><a id="TI000000796" class="bookmark" name="issogl2_18.4.1.1_файловый_вариант"><h3>18.4.1.1. Файловый вариант</h3></a>

<p class="MsoNormalCxSpFirst">Фоновые и регламентные задания выполняются
клиентскими приложениями или расширением веб-сервера. Фоновые задания
выполняются на том клиентском приложении, которое инициировало запуск фонового
задания. Фоновые задания исполняются последовательно, т. е. на одном
клиентском приложении не может одновременно выполняться два фоновых задания. В
случае работы через веб-сервер, для каждой информационной базы, доступ к
которой осуществляется через этот веб-сервер, организовано последовательное
выполнение фоновых и регламентных заданий.</p>

<p class="MsoNormalCxSpLast">Поведение фоновых и регламентных заданий в
файловом варианте имеет следующие особенности:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Информация о фоновых заданиях, вызванных с
помощью методов языка или выполняющих отчеты, доступна только в том клиентском
приложении, которое их выполняло. Информация не сохраняется после завершения
работы клиентского приложения.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Информация о фоновых заданиях, инициированных
регламентными заданиями, доступна на всех клиентских приложениях и сохраняется
между запусками.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Регламентные задания выполняются только одним
клиентским приложением. Имеется возможность запретить запуск регламентных
заданий определенным клиентским приложением или указать, что какое-либо
клиентское приложение принудительно назначается исполнителем регламентных
заданий. Такое управление осуществляется с помощью:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
Параметра командной строки <span class="Term">/AllowExecuteScheduledJobs</span>
для толстого и тонкого клиентских приложений.</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
Атрибута <span class="Term">allowexecutescheduledjobs</span>
элемента <span class="Term">point</span> файла публикации <span class="Interface">default.vrd</span> (см. <a href="/db/v8310doc/bookmark/adm/TI000000380" target="_top">здесь</a>) в случае
публикации информационной базы на веб-сервере.</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Регламентные задания выполняются первым, по
порядку запуска, клиентским приложением, у которого не указан запрет выполнения
регламентных заданий. После завершения сеанса этого клиентского приложения,
выполнение переходит к какому-либо из оставшихся запущенными клиентских
приложений. Если запускается клиентское приложение с явным указанием на
необходимость исполнения регламентных заданий, то регламентные задания начинают
выполняться этим клиентским приложением, независимо от наличия других клиентских
приложений (включая расширения веб-сервера).</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Регламентные задания выполняются расширением
веб-сервера до тех пор, пока расширение веб-сервера обслуживает хотя бы один
клиентский сеанс.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Регламентные задания обрабатываются один раз в
60 секунд.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Инициализация планировщика фоновых заданий
выполняется через 60 секунд после старта клиентского приложения или после
попытки запустить первое фоновое задание. До момента запуска планировщика
фоновых заданий в синхронном режиме выполняются следующие операции: поиск в
динамическом списке, построение отчетов и поиск для ввода по строке.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Инициализация механизма планировщика
регламентных заданий выполняется через 60 секунд после запуска механизма
планировщика фоновых заданий. Следовательно, регламентные задания прикладного
решения начинают выполняться максимум через 120 секунд после запуска
клиентского приложения.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Выполняется принудительное завершение фоновых
заданий, которые не завершились в течение 30 секунд после завершения работы
клиентского приложения. В журнале регистрации в этом случае фиксируется событие<span class="Interface"> Фоновое задание. Принудительное завершение</span> (<span class="Term">_$Job$_.Terminate</span>).</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Не поддерживается работа регламентных заданий в
файловом варианте информационной базы в сеансе, который получен с
использованием automation-сервера «1С:Предприятия» или COM-соединения. Если в таком
сеансе создаются фоновые задания, они размещаются в очереь, но запуск таких
заданий выполнен не будет.</p>

<a id="TI000000797" class="bookmark" name="issogl2_18.4.1.2_клиент-серверный_вариант"><h3>18.4.1.2. Клиент-серверный вариант</h3></a>

<p class="MsoNormalCxSpFirst">В
клиент-серверном варианте для выполнения фоновых заданий используется <span class="Bold">планировщик заданий</span>, который физически находится в менеджере
кластера. Планировщик получает наименее загруженный рабочий процесс для всех
поставленных в очередь на выполнение фоновых заданий и использует его для
выполнения соответствующего фонового задания. Рабочий процесс выполняет задание
и уведомляет планировщик о результатах выполнения.</p>

<p class="MsoNormalCxSpLast">В
клиент-серверном варианте имеется возможность блокирования выполнения
регламентных заданий. Блокирование выполнения регламентных заданий происходит в
следующих случаях:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
На информационную базу установлена явная
блокировка регламентных заданий. Блокировка может быть установлена через
консоль кластера.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
На информационную базу установлена блокировка начала
сеансов. Блокировка может быть установлена через консоль кластера.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Из встроенного языка вызван метод <span class="Term">УстановитьМонопольныйРежим()</span>
с параметром <span class="Term">Истина</span>.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
В некоторых других случаях (например, при
обновлении конфигурации базы данных).</p>

<a name="_ref417569452"></a><a name="_ref417569451"></a><a id="TI000000798" class="bookmark" name="issogl1_18.5_создание_метаданных_регламентного_задания"><h2>18.5. Создание метаданных регламентного задания</h2></a>

<p class="MsoNormalCxSpFirst">Перед
тем как создать регламентное задание в информационной базе с помощью
встроенного языка,
необходимо создать для него объект конфигурации.</p>

<p class="MsoNormalCxSpMiddle">Для
создания объекта конфигурации регламентного задания в ветке <span class="Interface">Общие</span> дерева конфигурации для ветки <span class="Interface">Регламентные задания</span> нужно выполнить команду <span class="Interface">Добавить</span>.</p>

<p class="MsoNormalCxSpMiddle">Регламентное задание обладает рядом свойств,
которые описаны ниже.</p>

<p class="MsoNormalCxSpMiddle"><span class="Interface">Имя метода</span> –
указывается имя метода регламентного задания.</p>

<p class="MsoNormalCxSpMiddle"><span class="Interface">Ключ</span> – указывается
произвольное строковое значение, которое будет использовано в качестве ключа
регламентного задания.</p>

<p class="MsoNormalCxSpLast"><span class="Interface">Расписание</span> –
указывается расписание регламентного задания. Для формирования расписания следует
перейти по ссылке <span class="Interface">Открыть</span> и в
открывшейся форме расписания установить нужные значения.</p>

<p class="Regularbeforepicture">На закладке <span class="Interface">Общее</span> указывается дата начала и завершения задания и
режим повтора.</p>

<p class="Picture"><IMG src="/db/content/v8310doc/src/руководство разработчика/_img/img00460.gif?_=1496848987" WIDTH="479" ALT HEIGHT="393"></p>

<p class="MsoCaption">Рис. 452. Общее расписание</p>

<p class="Regularbeforepicture">На закладке <span class="Interface">Дневное</span> указывается дневное расписание задания.</p>

<p class="Picture"><IMG src="/db/content/v8310doc/src/руководство разработчика/_img/img00461.gif?_=1496848987" WIDTH="479" ALT HEIGHT="393"></p>

<p class="MsoCaption">Рис. 453. Дневное расписание</p>

<p class="MsoNormal">В расписании можно указать:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
время начала и окончания задания;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
время завершения задания, после которого оно
будет принудительно завершено;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
период повтора задания;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
продолжительность паузы между повторами;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
продолжительность выполнения.</p>

<p class="MsoNormal">Допускается указание произвольного сочетания
условий.</p>

<p class="Regularbeforepicture">На закладке <span class="Interface">Недельное</span> указывается недельное расписание задания.</p>

<p class="Picture"><IMG src="/db/content/v8310doc/src/руководство разработчика/_img/img00462.gif?_=1496848987" WIDTH="479" ALT HEIGHT="393"></p>

<p class="MsoCaption">Рис. 454. Недельное расписание</p>

<p class="MsoNormalCxSpFirst">Нужно
установить флажки по тем дням недели, по которым задание будет выполняться.
Если требуется повторять задание, указать интервал повтора в неделях. Например,
задание выполняется через 2 недели, значение повтора – 2.</p>

<p class="MsoNormalCxSpLast">В том случае, задано недельное расписание и
значение свойства Повторять каждые больше 1, то при определении границ недели
будет учитываться свойство <span class="Interface">Первый
день недели</span>, заданный в региональных настройках информационной базы
(подробнее см. <a href="/db/v8310doc/bookmark/adm/TI000000135" target="_top">здесь</a>).</p>

<p class="Regularbeforepicture">На закладке <span class="Interface">Месячное</span> указывается месячное расписание задания.</p>

<p class="Picture"><IMG src="/db/content/v8310doc/src/руководство разработчика/_img/img00463.gif?_=1496848987" WIDTH="479" ALT HEIGHT="393"></p>

<p class="MsoCaption">Рис. 455. Месячное расписание</p>

<p class="MsoNormalCxSpFirst">Нужно
установить флажки по тем месяцам, в которых задание будет выполняться. При необходимости
можно указать конкретный день (месяца или недели) выполнения с начала
месяца/недели или конца.</p>

<p class="MsoNormalCxSpMiddle"><span class="Interface">Использование</span> –
если установлено, то задание будет выполняться согласно расписанию.</p>

<p class="MsoNormalCxSpMiddle"><span class="Interface">Предопределенное</span> –
если установлено, то задание является предопределенным.</p>

<p class="MsoNormalCxSpMiddle"><span class="Interface">Количество повторов
при аварийном завершении</span> – указывает количество повторов при
аварийном завершении.</p>

<p class="MsoNormalCxSpLast"><span class="Interface">Интервал повтора при
аварийном завершении</span> – указывает интервал повтора при аварийном
завершении.</p>

<p class="Lang-subheader">Пример создания фонового задания «Обновление
индекса полнотекстового поиска»:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">ФоновыеЗадания<span class="operator">.</span><span class="keyword">Выполнить</span><span class="operator">(</span><span class="string">&quot;ОбновлениеИндексаПолнотекстовогоПоиска&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Lang-subheader">Пример создания регламентного задания «Восстановление
последовательностей»:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Расписание <span class="operator">=</span> <span class="keyword">Новый</span> РасписаниеРегламентногоЗадания<span class="operator">;</span>
Расписание<span class="operator">.</span>ПериодПовтораДней <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>
Расписание<span class="operator">.</span>ПериодПовтораВТечениеДня <span class="operator">=</span> <span class="number">0</span><span class="operator">;</span>
Задание <span class="operator">=</span> РегламентныеЗадания<span class="operator">.</span>СоздатьРегламентноеЗадание<span class="operator">(</span><span class="string">&quot;ВосстановлениеПоследовательностей&quot;</span><span class="operator">)</span><span class="operator">;</span>
Задание<span class="operator">.</span>Расписание <span class="operator">=</span> Расписание<span class="operator">;</span>
Задание<span class="operator">.</span>Записать<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="MsoNormalCxSpFirst"> </p>

<br>		<script type="text/javascript">listenCopy('zeroclipboard.swf');</script>
	</body>
</html>