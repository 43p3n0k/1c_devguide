<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>&#1043;&#1083;&#1072;&#1074;&#1072; 26. &#1057;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072; &#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;</title>
		<LINK REL="stylesheet" href="/db/content/v8310doc/src/руководство разработчика/style.css?_=1496848987">
		<script charset="windows-1251" src="/db/content/v8310doc/src/руководство разработчика/script.js?_=1496848987" TYPE="text/javascript"></script>
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="/db/content/v8310doc/src/руководство разработчика/глава 26. система взаимодействия.htm" rel="canonical">
<link href="/static/its.content.css?_=1490872753" type="text/css" rel="stylesheet">
<script charset="windows-1251" type="text/javascript" src="/static/its.content.js?_=1489758009"></script>
<!--[if lt IE 9]><script charset="windows-1251" type="text/javascript" src="/static/html5shiv.js?_=1484636606"></script><![endif]-->

</head>
	<body class="v8310doc">
<a name="_ref473022322"></a><a id="TI000001900" class="bookmark"><h1>Глава 26.  Система взаимодействия</h1></a>

<a id="TI000001901" class="bookmark" name="issogl1_26.1_общая_информация"><h2>26.1. Общая информация</h2></a>

<p class="MsoNormal"><span class="Bold">Система взаимодействия</span> –
это механизм, позволяющий пользователям одной информационной базы системы
«1С:Предприятие» общаться друг с другом в режиме реального времени с помощью
текстовых сообщений и видеозвонков. Под термином «видеозвонок» понимается любой
возможный вариант общения двух пользователей, который включает в себя как
только голосовой канал общения, так и полноценный видеозвонок (и голосовая
информация и изображение). Видеозвонки поддерживаются:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
В тонком клиенте: при работе под управлением ОС
Windows 7 и старше;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
В веб-клиенте:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
При работе в веб-браузерах Google Chrome,
Mozilla Firefox версии 47 и старше.</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
При работе в веб-браузере Google Chrome
видеозвонки поддерживаются только в том случае, если доступ к информационной
базе выполняется по протоколу HTTPS.</p>

<p class="MsoNormal">Общение пользователей возможно с помощью
обсуждений (наборы сообщений, связанных одной темой обсуждения), которые могут
быть двух видов:</p>

<p class="MsoListNumberCxSpFirst">1. 
<span class="Bold">Неконтекстные</span>
обсуждения – обсуждения, которые не привязаны к объекту информационной
базы. В таких обсуждениях могут принимать участие любые пользователи
информационной базы. Неконтекстных обсуждений может быть произвольное
количество.</p>

<p class="MsoListNumberCxSpLast">2.  <span class="Bold">Контекстные</span> обсуждения – обсуждения, которые привязаны к
каким-либо объектам информационной базы. В таких обсуждениях могут принимать
участие только те пользователи информационной базы, которые имеют доступ к
обсуждаемому объекту. Каждый объект может иметь только одно обсуждение.</p>

<p class="MsoNormalCxSpFirst">Доступ к сообщениям возможен с помощью
Центра оповещений, элемента <span class="Interface">Обсуждения</span> панели открытых, а также специальной панели
сообщений в формах объектов системы (для контекстных сообщений).</p>

<p class="MsoNormalCxSpLast">Система взаимодействия реализована в
клиент-серверной архитектуре и состоит из следующих частей:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Bold">Клиентская часть</span> системы
взаимодействия является составной частью системы «1С:Предприятие».</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Bold">Серверная часть</span>
представляет собой специализированный сервер, представленный сервисом <span class="Interface">1cDialog.com</span>.</p>

<p class="MsoNormalCxSpFirst">Обмен сообщениями между клиентской частью и
сервером взаимодействия осуществляется по протоколу WebSocket. Этот протокол
обеспечивает защищенную передачу данных, что позволяет безопасно передавать
сообщения, с помощью которых общаются пользователи, как в локальной сети, так и
через Интернет. Вся переписка пользователей хранится на сервере системы взаимодействия.</p>

<p class="MsoNormalCxSpLast">Система «1С:Предприятие» обеспечивает
пользовательский интерфейс для обмена сообщениями (любых поддерживаемых видов),
а также предоставляет специализированный программный интерфейс, позволяющий
выполнить некоторые операции, в число которых входят следующие:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
зарегистрировать или отменить регистрацию
информационной базы в серверной части системы взаимодействия;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
создавать обсуждения и сообщения;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
получать сообщения, адресованные текущему
пользователю.</p>

<p class="MsoNormal">Не поддерживается работа с несколькими
копиями одной информационной базы. В том случае, если информационная база будет
скопирована, то такая база сможет подключиться к сервису, однако при работе
будут наблюдаться различные особенности, например:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Обсуждения и оповещения будут доступны во всех
копиях информационных базах.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Будут наблюдаться проблемы при работе с
контекстными обсуждениями для тех объектов, которые созданы после клонирования
оригинальной информационной базы.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Будут наблюдаться проблемы при работе с
получателями сообщений в том случае, если пользователи в информационных базах
создавались после клонирования.</p>

<a id="TI000001902" class="bookmark" name="issogl1_26.2_устройство_системы_взаимодействия"><h2>26.2. Устройство системы взаимодействия</h2></a>

<p class="MsoNormalCxSpFirst">Работа системы взаимодействия построена на
клиент-серверном обмене данными между системой «1С:Предприятие» и сервером
системы взаимодействия. Для того чтобы начать использовать систему
взаимодействия, необходимо зарегистрировать информационную базу в сервисе
системы. Если в информационной базе включено разделение данных, то под термином
«информационная база» понимается конкретная область данных. Каждую область
данных необходимо отдельно регистрировать в сервисе системы взаимодействия.</p>

<p class="MsoNormalCxSpLast">Во время регистрации информационной базе в
сервисе создается (и сохраняется) следующая информация:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Уникальный идентификатор информационной базы в
сервисе. Этот идентификатор сохраняется как в самой информационной базе, так на
сервере системы взаимодействия. Этот идентификатор нельзя получить и установить
самостоятельно.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Криптографические ключи, которые используются
для обеспечения безопасной передачи сообщений между клиентской и серверной
частями системы взаимодействия. Эти ключи хранятся как в информационной базе,
так и на сервере системы взаимодействия.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
В сервисе также сохраняется имя регистрируемой
информационной базы и адрес электронной почты, который используется при
регистрации информационной базы. Адрес электронной почты, который используется
при регистрации информационной базы в сервисе, будет олицетворять <span class="Bold">абонента сервиса</span>. Один абонент сервиса может зарегистрировать
несколько информационных баз.</p>

<p class="MsoNormalCxSpFirst">Для того чтобы прекратить работу системы взаимодействия,
необходимо выполнить отмену регистрации информационной базы в сервисе. В этом
случае в информационной базе удаляются криптографические ключи, используемые
для обеспечения обмена и, как следствие, обмен сообщениями становится
невозможным. Однако при повторной регистрации той же информационной базы будет
создана новая пара ключей. В результате обмен сообщениями будет восстановлен и
станет доступна вся история сообщений. Для корректного восстановления обмена
сообщениями важно, чтобы у информационной базы остался неизменным уникальный
идентификатор этой базы в сервисе. Если это правило нарушено –
восстановить доступ к истории сообщений будет невозможно. Для переноса данных
регистрации между информационными базами предназначены методы <span class="Term">ПолучитьДанныеРегистрацииИнформационнойБазы()</span>/<span class="Term">УстановитьДанныеРегистрацииИнформационнойБазы()</span>.
Эти методы оперируют специальным объектом (<span class="Term">ДанныеРегистрацииИнфорационнойБазыСИстемыВзаимодействия</span>),
который может быть передан между различными информаицонными базами, например, с
помощью Web-сервиса.</p>

<p class="MsoNormalCxSpMiddle">В обмене участвуют только те пользователи,
которые зарегистрированы в качестве пользователей информационной базы. Для
каждого пользователя информационной базы создается парный пользователь в
системе взаимодействия. Создание такого пользователя выполняется при первой
авторизации пользователя информационной базы после регистрации этой базы в
сервере системы взаимодействия. Идентификация пользователя выполняется по
уникальному идентификатору пользователя информационной базы системы «1С:Предприятие».
Синхронизация списка пользователей (кроме создания парного пользователя) не
поддерживается как автоматически, так и с помощью программного доступа.</p>

<p class="MsoNormalCxSpLast">Таким образом, обмен сообщениями возможен
только между теми пользователями, которые зарегистрированы в сервере системы
взаимодействия. Более того, для отправки сообщения можно выбрать только того
пользователя, который зарегистрирован в сервисе системы взаимодействия.</p>

<a id="TI000001903" class="bookmark" name="issogl1_26.3_параметры_пользователей"><h2>26.3. Параметры пользователей</h2></a>

<p class="MsoNormalCxSpFirst">После подключения информационной базы к
сервису взаимодействия, появляется возможность указания дополнительных параметров
для пользователя, которые зарегистрированы в системе взаимодействия.</p>

<p class="MsoNormalCxSpLast">Поддерживается хранение телефонного номера и
адреса электронной почты.</p>

<a id="TI000001904" class="bookmark" name="issogl1_26.4_виды_обсуждений"><h2>26.4. Виды обсуждений</h2></a>

<a id="TI000001905" class="bookmark" name="issogl2_26.4.1_неконтекстные_обсуждения"><h3>26.4.1. Неконтекстные обсуждения</h3></a>

<p class="MsoNormal">Неконтекстные обсуждения не привязаны к
каким-либо объектам информационной базы. Любой пользователь может создать
произвольное количество таких обсуждений. Неконтекстные обсуждения могут иметь
любое количество участников. При создании обсуждения его участниками являются
пользователь, создавший обсуждение, и те пользователи, которых он указал при создании
обсуждения. В дальнейшем любой участник обсуждения может:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
просматривать сообщения обсуждения;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
добавлять сообщения в обсуждение;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
изменять название (тему) обсуждения;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
добавлять новых участников обсуждения (любых
пользователей информационной базы);</p>

<p class="MsoListBulletCxSpLast">&#9679; 
покинуть обсуждение.</p>

<p class="MsoNormalCxSpFirst">Если обсуждение покидает последний участник,
то обсуждение становится недоступным. При этом на сервере содержимое обсуждений
сохраняется. Неконтекстное обсуждение видимо только для участников обсуждения.</p>

<p class="MsoNormalCxSpMiddle">Создание неконтекстного обсуждения
выполняется с помощью специальной формы обсуждений, которая становится
доступной после регистрации информационной базы в сервисе взаимодействия.</p>

<p class="MsoNormalCxSpMiddle">Основная форма системы взаимодействия всегда
является второй (после начальной страницы) формой в панели открытых. Эту форму
нельзя закрыть и перетащить в другое место панели. Если в прикладном решении
отсутствует начальная страница, основная форма системы взаимодействия
становится первой формой в панели открытых.</p>

<p class="MsoNormalCxSpMiddle">При создании нового сообщения предлагается
указать тему сообщения и участников. Инициатор обсуждения автоматически добавляется
в список участников.</p>

<p class="MsoNormalCxSpMiddle">В списке обсуждений показываются все
неконтекстные обсуждения, по которым для пользователя есть уведомления. Если
таких обсуждений меньше 50, то список дополняется неконтекстными обсуждениями,
в которых пользователь является участником и по которым для пользователя нет
уведомлений. Эти обсуждения добавляются в список в порядке убывания даты
последнего сообщения в обсуждении, пока размер списка не достигнет 50
элементов.</p>

<p class="MsoNormalCxSpMiddle">Поиск в списке обсуждений работает только по
темам обсуждений, поиск в списке сообщений работает только по сообщениям
выбранного обсуждения. Не поддерживается возможность поиска обсуждения по
тексту сообщений.</p>

<p class="MsoNormalCxSpLast">При появлении в обсуждении новых сообщений,
участники обсуждения получают оповещения.</p>

<a id="TI000001906" class="bookmark" name="issogl2_26.4.2_контекстные_обсуждения"><h3>26.4.2. Контекстные обсуждения</h3></a>

<p class="MsoNormalCxSpFirst">Контекстные обсуждения (как уже было сказано
ранее) привязаны к объектам информационной базы. Если информационная база
подключена к сервису взаимодействия, то для форм элементов ссылочных типов и
форм записей регистров сведений, становится доступна команда формы <span class="Interface">Обсуждение</span>. Для каждого объекта существует только одно
контекстное обсуждение. В обсуждении могут принимать участие все пользователи
информационной базы, которые имеют право <span class="Term">Чтение</span>
для обсуждаемого объекта.</p>

<p class="MsoNormalCxSpMiddle">Контекстные обсуждения могут использоваться
для ссылочных типов (справочники, документы, планы видов характеристик и т. д.),
форм записей регистров сведений, а также для форм, у которых навигационная
ссылка указывает на данные или команды.</p>

<p class="MsoNormalCxSpMiddle">Контекстное обсуждение выполняется в форме
обсуждаемого объекта (в правой части). Такое обсуждение не имеет заголовка.
Открытие и закрытие списка сообщений выполняется циклическим нажатием кнопки <span class="Interface">Обсуждение</span>.</p>

<p class="MsoNormalCxSpMiddle">Несмотря на то, что в обсуждении по
умолчанию могут принимать участие все пользователи информационной базы (с
соответствующими правами), при создании сообщения в контекстном обсуждении
имеется возможность выбрать адресатов сообщения. В данном случае адресаты
выбираются для того, чтобы отобразить им оповещения о новом сообщении.
Остальные пользователи получат оповещение только в том случае, если они
подпишутся на получение оповещений о новых сообщениях в этом обсуждении.</p>

<p class="MsoNormalCxSpMiddle">Команда <span class="Interface">Обсуждение</span> не выводится в формах, которые блокируют окно
владельца или весь интерфейс. Эти формы обычно используются для отображения и
редактирования данных, не имеющих самостоятельного прикладного значения,
поэтому механизм обсуждений для них не предусмотрен.</p>

<p class="MsoNormalCxSpMiddle">Для форм, которые не блокируют окно
владельца или интерфейс приложения, имеется возможность управлять доступностью
команды <span class="Interface">Обсуждение</span>
в форме. Управление осуществляется с помощью свойства управляемой формы <span class="Term">ОтображениеОбсуждений</span>.
Установка данного свойства в значение <span class="Interface">Не отображать</span> приведет к тому, что команда <span class="Interface">Обсуждение</span> не будет доступна в форме.</p>

<p class="MsoNormalCxSpLast">Следует, однако, учитывать, что контекстное
обсуждение доступно только в той форме, навигационная ссылка которой указывает
на данные, которые хранятся в информационной базе, или команду.</p>

<a id="TI000001907" class="bookmark" name="issogl1_26.5_виды_сообщений"><h2>26.5. Виды сообщений</h2></a>

<a id="TI000001908" class="bookmark" name="issogl2_26.5.1_текстовые_сообщения"><h3>26.5.1. Текстовые сообщения</h3></a>

<p class="MsoNormal">Основным механизмом в системе взаимодействия
считается обмен текстовыми сообщениями. Текстовые сообщения – это простой
текст, в котором недоступно никакое оформление. Размер текстового сообщения
ограничен значением 4 000 символов.</p>

<a id="TI000001909" class="bookmark" name="issogl2_26.5.2_видеозвонки"><h3>26.5.2. Видеозвонки</h3></a>

<p class="MsoNormal">Для использования видеозвонков должны быть
выполнены следующие требования:</p>

<p class="MsoListNumberCxSpFirst">1. 
Сервер взаимодействия должен разрешать
видеозвонки для абонента, который выполнял регистрацию информационной базы.</p>

<p class="MsoListNumberCxSpMiddle">2.  Клиентское
приложение, которое применяется для доступа к информационной базе, позволяет
использовать видеозвонки.</p>

<p class="MsoListNumberCxSpLast">3.  Компьютеры
пользователей – участников видеозвонка должны быть оснащены микрофонами.
При наличии видеокамеры у участника видеозвонка обеспечивается показ
изображения видеокамеры другому участнику видеозвонка.</p>

<p class="MsoNormal">В система взаимодействия поддерживаются
видеозвонки только с двумя участниками.</p>

<a id="TI000001910" class="bookmark" name="issogl1_26.6_оповещения"><h2>26.6. Оповещения</h2></a>

<p class="MsoNormal">Для информирования пользователей о новых
сообщениях, система взаимодействия использует оповещения. Оповещения направляются:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
при добавлении сообщения в неконтекстное
обсуждение – всем участникам обсуждения, кроме автора сообщения;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
при добавлении сообщения в контекстное
обсуждение – всем пользователям, которых автор сообщения указал в качестве
адресатов, а также пользователям, включившим режим наблюдения для этого
контекстного обсуждения;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
при пропущенном видеозвонке – пользователю,
пропустившему видеозвонок.</p>

<a id="TI000001911" class="bookmark" name="issogl1_26.7_администрирование"><h2>26.7. Администрирование</h2></a>

<p class="MsoNormalCxSpFirst">Описание администрирования системы
взаимодействия см. <a href="/db/v8310doc/bookmark/adm/TI000000755" target="_top">здесь</a>.</p>

<p class="MsoNormalCxSpMiddle"> </p>

<br>
	</body>
</html>