<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>&#1043;&#1083;&#1072;&#1074;&#1072; 20. &#1052;&#1077;&#1093;&#1072;&#1085;&#1080;&#1079;&#1084; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1075;&#1086; &#1093;&#1088;&#1072;&#1085;&#1080;&#1083;&#1080;&#1097;&#1072;, &#1088;&#1072;&#1073;&#1086;&#1090;&#1072; &#1089; &#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080; &#1080; &#1082;&#1072;&#1088;&#1090;&#1080;&#1085;&#1082;&#1072;&#1084;&#1080;</title>
		<LINK REL="stylesheet" href="style.css?_=1496848987">
		<SCRIPT src="script.js?_=1496848987" TYPE="text/javascript"></script>		<!--[if !IE]>--><SCRIPT src="zeroclipboard.js?_=1496848987" TYPE="text/javascript"></script><!--<![endif]-->
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="/db/content/v8310doc/src/руководство разработчика/глава 20. механизм временного хранилища, работа с файлами и картинками.htm" rel="canonical">
<link href="/static/its.content.css?_=1490872753" type="text/css" rel="stylesheet">
<script type="text/javascript" src="/static/its.content.js?_=1489758009"></script>
<!--[if lt IE 9]><script type="text/javascript" src="/static/html5shiv.js?_=1484636606"></script><![endif]-->

</head>
	<body class="v8310doc">
<a name="_ref214436821"></a><a name="_ref214436733"></a><a name="_ref404183483"></a><a name="_ref237783544"></a><a id="TI000000803" class="bookmark"><h1>Глава 20.  Механизм временного хранилища, работа с файлами и картинками</h1></a>

<a name="_ref393795376"></a><a name="_ref393795375"></a><a id="TI000000804" class="bookmark" name="issogl1_20.1_временное_хранилище"><h2>20.1. Временное хранилище</h2></a>

<p class="MsoNormalCxSpFirst">В «1С:Предприятии» существует механизм
работы с временным хранилищем, обеспечивающий хранение некоторых данных,
привязанных к сеансу. Кроме того, реализован механизм работы с файлами, который
обеспечивает обмен файлами между информационной базой и клиентским приложением.
Особенностью данного механизма является то, что он ориентирован на использование
в тонком клиенте и веб-клиенте и разработан с учетом ограничений на работу с
файлами, накладываемых веб-браузерами.</p>

<p class="MsoNormalCxSpMiddle"><span class="Bold">Временное хранилище</span> –
это специализированное хранилище информации, в которое может быть помещено
значение. Основное назначение – это временное хранение информации при
клиент-серверном взаимодействии до ее переноса в базу данных. Механизм
временного хранилища совместно с механизмом работы с файлами предоставляет
набор, с помощью которого можно поместить данные, хранящиеся локально у
пользователя, во временное хранилище информационной базы, перенести эту информацию
из временного хранилища в базу данных и получить ее обратно на компьютер
пользователя. Наиболее распространенные прикладные задачи, решаемые этими
механизмами, – это хранение сопроводительной информации, например,
изображений товаров, связанных с договорами документов и т. п.
Механизмы временного хранилища и работы с файлами часто используются совместно,
но могут использоваться и по отдельности.</p>

<p class="MsoNormalCxSpMiddle">Необходимость во временном хранилище
возникает, например, из-за того, что в модели работы веб-браузера требуется
передать выбранный пользователем файл непосредственно на сервер без возможности
его хранения на клиенте. При передаче файла он помещается во временное
хранилище и потом может быть использован при записи объекта в базу данных.</p>

<p class="MsoNormalCxSpMiddle">При помещении данных во временное хранилище
следует помнить, что во временное хранилище не могут быть помещены данные, типы
которых не поддерживают сериализацию, причем как непосредственно, так и в
составе любых коллекций.</p>

<p class="MsoNormalCxSpLast">Можно использовать временное хранилище как
универсальное хранилище с контролируемым временем жизни данных:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Если при помещении данных во временное хранилище
была выполнена привязка данных к некоторой форме, то время жизни сохраненных
данных зависит от продолжительности жизни формы, к которой привязаны данные. При
удалении объекта формы временное хранилище будет очищено от всей связанной с
ней информации.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Если при помещении данных во временное хранилище
привязка к форме не была выполнена, то очистка временного хранилища будет
выполнена в следующих случаях:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
При следующем запросе формы.</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
При следующем серверном вызове из клиентского общего
модуля.</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
При контекстном и неконтекстном клиентских вызовах
из формы.</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
При серверном вызове из модуля команды. Если
вызов сервера осуществляется для помещения значения во временное хранилище, то
очистка не производится. Очистка производится после того, как вызов закончил
свою работу.</p>

<p class="MsoNormalCxSpFirst">То есть можно поместить одно или несколько
значений во временное хранилище, а в следующем вызове это значение использовать.
При этом после использования и перед тем, как серверный вызов будет окончен,
помещенное значение будет автоматически удалено.</p>

<p class="MsoNormalCxSpMiddle">Наиболее типичная прикладная задача,
решаемая временным хранилищем, – обеспечение доступа к файлам или
картинкам до того, как объект будет записан в информационную базу, например, в
форме элемента. При организации такого доступа рекомендуется передавать данные
с клиентских компьютеров на сервер именно как файлы, без предварительного
«преобразования» в текстовый документ, табличный документ и аналогичные форматы
системы «1С:Предприятие». Рекомендуется передать файл на сторону сервера и уже
на стороне сервера загружать данные файла в нужный формат системы «1С:Предприятие».</p>

<p class="MsoNormalCxSpMiddle">Данные, помещенные в хранилище,
идентифицируются уникальным адресом, который в дальнейшем можно использовать в
операциях записи, чтения или удаления. Этот адрес выдают методы записи значения
во временное хранилище. Отдельный метод во встроенном языке позволяет определить,
является ли переданный адрес адресом, указывающим на данные во временном хранилище.</p>

<p class="MsoNormalCxSpLast">Временное хранилище, сформированное в одном
сеансе, недоступно из другого сеанса. Исключением является возможность передачи
данных из фонового задания в сеанс, инициировавший это фоновое задание, с
помощью временного хранилища (подробнее см. <a href="#_ref393795347">здесь</a>).</p>

<a name="_ref400971879"></a><a name="_ref405477343"></a><a name="_ref405477342"></a><a name="_ref405477295"></a><a name="_ref405477294"></a><a id="TI000001507" class="bookmark" name="issogl1_20.2_особенности_работы_с_файлами_в_асинхронном_режиме_и_веб-клиенте"><h2>20.2. Особенности работы с файлами в асинхронном режиме и веб-клиенте</h2></a>

<p class="MsoNormalCxSpFirst">Работа
с файлами в асинхронном режиме присутствует только на стороне клиентского
приложения. В общем случае рекомендуется использовать синхронные методы для
работы на стороне сервера и асинхронные – для работы на стороне
клиентского приложения.</p>

<p class="MsoNormalCxSpLast">Рассмотрим
пример работы с файлами в асинхронной технике: удаление всех файлов в каталоге
временных файлов. Для синхронной техники такое действие будет выглядеть
следующим образом:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> Удалить<span class="operator">(</span>Команда<span class="operator">)</span>
    УдалитьФайлы<span class="operator">(</span>КаталогВременныхФайлов<span class="operator">(</span><span class="operator">)</span><span class="operator">,</span> ПолучитьМаскуВсеФайлыКлиента<span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
    Сообщить<span class="operator">(</span><span class="string">&quot;Удаление успешно завершено&quot;</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="MsoNormal">Асинхронная
техника будет выглядеть по-другому:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> Удалить<span class="operator">(</span>Команда<span class="operator">)</span>
    ОбратныйВызов <span class="operator">=</span> <span class="keyword">Новый</span> ОписаниеОповещения<span class="operator">(</span><span class="string">&quot;ПолучитьКаталогВременныхФайловЗавершение&quot;</span><span class="operator">,</span> ЭтотОбъект<span class="operator">,</span> <span class="operator">,</span> <span class="string">&quot;УдалитьОшибка&quot;</span><span class="operator">,</span> ЭтотОбъект<span class="operator">)</span><span class="operator">;</span>
    НачатьПолучениеКаталогаВременныхФайлов<span class="operator">(</span>ОбратныйВызов<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ПолучитьКаталогВременныхФайловЗавершение<span class="operator">(</span>ИмяКаталогаВременныхФайлов<span class="operator">,</span> ДополнительныеПараметры<span class="operator">)</span> <span class="keyword">Экспорт</span>
    ОбратныйВызов <span class="operator">=</span> <span class="keyword">Новый</span> ОписаниеОповещения<span class="operator">(</span><span class="string">&quot;УдалитьЗавершение&quot;</span><span class="operator">,</span> ЭтотОбъект<span class="operator">,</span> <span class="operator">,</span> <span class="string">&quot;ФайловаяОшибка&quot;</span><span class="operator">,</span> ЭтотОбъект<span class="operator">)</span><span class="operator">;</span>
    НачатьУдалениеФайлов<span class="operator">(</span>ОбратныйВызов<span class="operator">,</span> ИмяКаталогаВременныхФайлов<span class="operator">,</span> ПолучитьМаскуВсеФайлыКлиента<span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> УдалитьЗавершение<span class="operator">(</span>ДополнительныеПараметры<span class="operator">)</span> <span class="keyword">Экспорт</span>
    Сообщить<span class="operator">(</span><span class="string">&quot;Удаление успешно завершено&quot;</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ФайловаяОшибка <span class="operator">(</span>ИнформацияОбОшибке<span class="operator">,</span> СтандартнаяОбработка<span class="operator">,</span> ДополнительныеПараметры<span class="operator">)</span> <span class="keyword">Экспорт</span>
    Сообщить<span class="operator">(</span><span class="string">&quot;При выполнении файловой операции обнаружена ошибка: &quot;</span> <span class="operator">+</span> КраткоеПредставлениеОшибки<span class="operator">(</span>ИнформацияОбОшибке<span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="MsoNormalCxSpFirst">Во-первых,
следует обратить внимание, что практически все файловые операции стали
асинхронными. Даже такие простые действия, как получение каталога временных
файлов. И необходимость получения такого каталога приводит к первому асинхронному
вызову.</p>

<p class="MsoNormalCxSpMiddle">Затем
происходит вызов собственно удаления всех файлов. И обработка завершения
удаления требует второй обработчик, в котором должны располагаться действия,
которые должны происходить после удаления всех файлов в каталоге временных
файлов. В данном примере это выдача сообщения о завершении операции.</p>

<p class="MsoNormalCxSpMiddle">Если
при выполнении файловых операций произойдет ошибка – управление будет
передано обработчику <span class="Term">ФайловыеОшибка()</span>. В нем можно корректно
обработать сложившуюся ситуацию.</p>

<p class="MsoNormalCxSpLast">Работа
с файлами в веб-клиенте имеет ряд особенностей:</p>

<p class="MsoListNumberCxSpFirst">1.  Без
установки расширений, в любом веб-браузере, доступны только методы <span class="Term">ПолучитьФайл()</span> и <span class="Term">НачатьПомещениеФайла()</span>. Метод <span class="Term">ПоместитьФайл()</span> не поддерживается при работе с
веб-браузером Google Chrome и в том случае, если для конфигурации запрещено
использование модальных методов (свойство конфигурации <span class="Interface">Режим использования
модальности</span>, см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 5. объекты конфигурации.htm?_=1496848987#_ref370288523">здесь</a>).</p>

<p class="MsoListNumberCxSpMiddle">2.  При
установке расширения работы с файлами (см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 4. встроенный язык.htm?_=1496848987#_ref404250037">здесь</a>) во всех веб-браузерах, кроме Google Chrome, доступы
как синхронные, так и асинхронные методы работы с файлами (синхронность или
асинхронность зависит от свойства конфигурации <span class="Interface">Режим использования
модальности</span>, см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 5. объекты конфигурации.htm?_=1496848987#_ref370288523">здесь</a>).</p>

<p class="MsoListNumberCxSpMiddle">3.  Для
веб-браузера Google Chrome доступно только асинхронное расширение работы с
файлами. Синхронная работа не поддерживается.</p>

<p class="MsoListNumberCxSpLast">4.  Расширение
работы с файлами не поддерживает работу по протоколу HTTPS с использованием
клиентского сертификата.</p>

<p class="NoteCxSpFirst"><span class="Note">Примечание 1.</span> Для корректной работы расширения работы
с файлами в веб-браузере Microsoft Internet Explorer рекомендуется использование
библиотеки Microsoft Core XML Services (MSXML) версий 4.0 или 6.0.</p>

<p class="NoteCxSpLast"><span class="Note">Примечание 2.</span> Расширение работы с файлами для
веб-браузера Microsoft Internet Explorer устанавливается в каталог <span class="Interface">%APPDATA%\1C\1СEWebExt\FileSystemExtIE</span>.</p>

<a id="TI000000805" class="bookmark" name="issogl1_20.3_способы_работы_с_файлами_и_временным_хранилищем"><h2>20.3. Способы работы с файлами и временным хранилищем</h2></a>

<p class="MsoNormal">В данном разделе описаны наиболее частые
варианты использования механизма работы с временным хранилищем и файлами.</p>

<a id="TI000000806" class="bookmark" name="issogl2_20.3.1_сохранение_данных_из_файла_во_временное_хранилище"><h3>20.3.1. Сохранение данных из файла во временное хранилище</h3></a>

<a name="_ref370403780"></a><a id="TI000000807" class="bookmark" name="issogl3_20.3.1.1_помещение_одного_файла"><h4>20.3.1.1. Помещение одного файла</h4></a>

<p class="MsoNormal">Метод <span class="Term">ПоместитьФайл()</span>
помещает файл из локальной файловой системы во временное хранилище. Метод может
принимать адрес во временном хранилище, по которому нужно сохранить файл. Если
же адрес не определен или является пустой строкой, то будет создан новый адрес
и метод вернет его через специальный параметр.</p>

<p class="Note">Примечание.
Объем данных, перемещаемых между клиентом и сервером, за один вызов метода <span class="Term">ПоместитьФайл()</span>, не должен превышать 4 Gb (в
сериализованном виде).</p>

<p class="MsoNormalCxSpFirst">Если параметр, определяющий интерактивный
режим работы, равен <span class="Term">Истина</span>, то метод отобразит стандартное
диалоговое окно выбора файла, в котором можно выбрать файл для помещения в
хранилище. В этом случае метод также вернет адрес выбранного файла.</p>

<p class="MsoNormalCxSpLast">В качестве результата метод возвращает <span class="Term">Ложь</span>,
если пользователь в интерактивном режиме отказался от совершения операции в
диалоге выбора файла.</p>

<a name="_ref370403792"></a><a id="TI000000808" class="bookmark" name="issogl3_20.3.1.2_помещение_набора_файлов"><h4>20.3.1.2. Помещение набора файлов</h4></a>

<p class="MsoNormal">Метод <span class="Term">ПоместитьФайлы()</span>
помещает во временное хранилище несколько файлов за один вызов. Существует
несколько различных способов использования этого метода:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
предварительно сформировать список добавляемых
файлов, например, когда предварительно выбрал файлы, которые необходимо
поместить в информационную базу;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
передать в метод маску поиска файлов, например,
когда требуется поместить в информационную базу все файлы определенного вида,
например, все картинки;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
передать в метод предварительно подготовленный
объект <span class="Term">ДиалогВыбораФайла</span> в режиме открытия файлов.</p>

<p class="MsoNormal">После окончания работы метод может вернуть
список реально добавленных файлов.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// СписокФайлов – реквизит формы типа СписокЗначений,</span>
<span class="comment">//                    содержащий список добавляемых файлов</span>
МассивФайлов <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
<span class="keyword">Для</span> <span class="keyword">каждого</span> ЭлементСписка <span class="keyword">Из</span> СписокФайлов <span class="keyword">Цикл</span>
    МассивФайлов<span class="operator">.</span>Добавить<span class="operator">(</span><span class="keyword">Новый</span> ОписаниеПередаваемогоФайла<span class="operator">(</span>ЭлементСписка<span class="operator">,</span> <span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецЦикла</span><span class="operator">;</span>
ПомещенныеФайлы <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
Результат <span class="operator">=</span> ПоместитьФайлы<span class="operator">(</span>МассивФайлов<span class="operator">,</span> ПомещенныеФайлы<span class="operator">,</span> <span class="operator">,</span> <span class="keyword">Ложь</span><span class="operator">,</span> УникальныйИдентификатор<span class="operator">)</span><span class="operator">;</span></pre>

<p class="NoteCxSpFirst"><span class="Note">Примечание 1.</span>
Для использования метода <span class="Term">ПоместитьФайлы()</span> в
веб-клиенте требуется подключение расширения работы с файлами (см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 4. встроенный язык.htm?_=1496848987#_ref404250037">здесь</a>).</p>

<p class="NoteCxSpLast">Примечание 2. Объем данных, перемещаемых между
клиентом и сервером, за один вызов метода <span class="Term">ПоместитьФайлы()</span>,
не должен превышать 4 Gb (в сериализованном виде).</p>

<a name="_ref370403802"></a><a name="_ref370403801"></a><a id="TI000000809" class="bookmark" name="issogl2_20.3.2_помещение_данных_во_временное_хранилище"><h3>20.3.2. Помещение данных во временное хранилище</h3></a>

<p class="MsoNormal">Метод ПоместитьВоВременноеХранилище() схож
с методом <span class="Term">ПоместитьФайл()</span>, за исключением того, что
данные для записи во временное хранилище представляются не в виде пути в
файловой системе, а в виде значения. Точно так же, если не указан существующий
адрес во временном хранилище, создается новый адрес. Адрес возвращается как
результат функции. Так же как и для файлов, размещенные данные обязательно
принадлежат какой-либо форме и автоматически удаляются после ее удаления.</p>

<p class="NoteCxSpFirst">Примечание. Объем данных, перемещаемых между клиентом
и сервером, за один вызов метода <span class="Term">ПоместитьВоВременноеХранилище()</span>, не должен
превышать 4 Gb (в сериализованном виде).</p>

<p class="NoteCxSpLast"><span class="Note">Внимание!</span> При помещении во временное хранилище
фактическая сериализация значения не выполняется. Помещается ссылка на
значение, которая хранится в кеше в течение 20 минут. По истечении этого
периода значение сериализуется, записывается на диск (в хранилище сеансовых
данных) и удаляется из кеша.</p>

<a name="_ref369791238"></a><a name="_ref369791237"></a><a id="TI000000810" class="bookmark" name="issogl2_20.3.3_получение_данных_из_временного_хранилища"><h3>20.3.3. Получение данных из временного хранилища</h3></a>

<p class="MsoNormal">При записи объекта в информационную базу
может понадобиться извлечь данные из временного хранилища и поместить их, например,
в реквизит объекта информационной базы. Для этого существует специальный
метод – <span class="Term">ПолучитьИзВременногоХранилища()</span>. Этот метод
извлекает данные из временного хранилища и возвращает их в качестве результата
выполнения. Для получения данных необходимо указать адрес во временном
хранилище. Этот адрес возвращают методы помещения данных во временное хранилище
в случае их успешного выполнения (см. предыдущие разделы).</p>

<p class="NoteCxSpFirst">Внимание! При получении на сервере значения из
временного хранилища следует учитывать то, что оно получается по ссылке. В
действительности, ссылка эта указывает на значение, которое хранится в кеше. В
течение 20 минут, с момента помещения в хранилище или же с момента последнего
обращения, значение сохранится в кеше, а затем записывается на диск и из кеша
удаляется. При следующем обращении значение загружается с диска и снова
помещается в кеш.</p>

<p class="NoteCxSpLast">После
десериализации и восстановления значения из временного хранилища ссылки не
восстанавливаются. Значение в кеше восстанавливается с диска. Но после
сериализации/десериализации восстановить ссылки на другие объекты внутри
значения невозможно.</p>

<a id="TI000000811" class="bookmark" name="issogl2_20.3.4_удаление_данных_из_временного_хранилища"><h3>20.3.4. Удаление данных из временного хранилища</h3></a>

<p class="MsoNormal">После того как данные сохранены в реквизите
объекта информационной базы, данные во временном хранилище можно удалить. Для
этого есть метод <span class="Term">УдалитьИзВременногоХранилища()</span>, который
производит удаление. Метод принимает в параметре адрес во временном хранилище.</p>

<a id="TI000000812" class="bookmark" name="issogl2_20.3.5_проверка_адреса_на_принадлежность_временному_хранилищу"><h3>20.3.5. Проверка адреса на принадлежность временному хранилищу</h3></a>

<p class="MsoNormalCxSpFirst">Адрес может указывать как на временное
хранилище, так и на реквизит в информационной базе. Для проверки его типа существует
метод <span class="Term">ЭтоАдресВременногоХранилища()</span>.</p>

<p class="MsoNormalCxSpLast">Он проверяет, что переданный адрес является
адресом, указывающим на хранилище. Возвращает <span class="Term">Истина</span>,
если адрес указывает на временное хранилище.</p>

<a id="TI000000813" class="bookmark" name="issogl2_20.3.6_получение_адреса_реквизита"><h3>20.3.6. Получение адреса реквизита</h3></a>

<p class="MsoNormalCxSpFirst">После того как данные помещены в реквизит
объекта информационной базы, может потребоваться получить доступ к ним с помощью
файловых методов.</p>

<p class="MsoNormalCxSpMiddle">Но прежде чем получить данные, например из
реквизита, необходимо получить адрес этого реквизита. Для этого существует метод
<span class="Term">ПолучитьНавигационнуюСсылку()</span>.</p>

<p class="MsoNormalCxSpLast">Он может вернуть адрес значения в
информационной базе по исходным параметрам. Для этого необходимо передать ключ
объекта (это может быть как ссылка на объект, так и ключ записи регистра
сведений) и имя реквизита. Если нужно получить адрес значения, хранимого в
реквизите табличной части, то к имени реквизита в параметре, задающем имя
реквизита, необходимо добавить имя табличной части и точку «<span class="Interface">.</span>».</p>

<p class="Lang-subheader">Например:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Товары<span class="operator">.</span>Изображение</pre>

<a id="TI000000814" class="bookmark" name="issogl2_20.3.7_получение_файла_из_информационной_базы"><h3>20.3.7. Получение файла из информационной базы</h3></a>

<a name="_ref350954406"></a><a id="TI000000815" class="bookmark" name="issogl3_20.3.7.1_получение_одного_файла"><h4>20.3.7.1. Получение одного файла</h4></a>

<p class="MsoNormalCxSpFirst">Метод <span class="Term">ПолучитьФайл()</span>
получает файл из информационной базы и сохраняет его в локальную файловую
систему пользователя. Первый параметр определяет адрес файла в реквизите
объекта информационной базы или во временном хранилище файлов. Сохранение не
произойдет, если у пользователя, от имени которого выполняется операция,
отсутствует право <span class="Term">Просмотр</span> на реквизит объекта информационной
базы. Второй параметр определяет место сохранения получаемого файла. В
неинтерактивном режиме необходимо указать путь. В интерактивном режиме параметр
является опциональным.</p>

<p class="MsoNormalCxSpLast">По умолчанию метод исполняется в
интерактивном режиме. Это значит, что будет сформировано диалоговое окно, в
котором можно указать действие с полученным файлом: запустить его или сохранить
в указанное пользователем место файловой системы. Если выбран интерактивный
режим, а параметр <span class="Interface">Имя файла</span> не
указан, то операция открытия файла недоступна. Метод возвращает значение типа <span class="Term">Булево</span>.
<span class="Term">Ложь</span> означает, что пользователь выбрал отмену
операции в диалоговом окне сохранения файлов в интерактивном режиме.</p>

<a name="_ref350954413"></a><a id="TI000000816" class="bookmark" name="issogl3_20.3.7.2_получение_набора_файлов"><h4>20.3.7.2. Получение набора файлов</h4></a>

<p class="MsoNormal">Метод <span class="Term">ПолучитьФайлы()</span>
позволяет получить и сохранить в локальной файловой системе пользователя
несколько файлов, хранящихся в информационной базе. В качестве параметра
передается список выгружаемых файлов.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// СписокФайлов – список значений, содержащий ссылки на элементы</span>
<span class="comment">//            справочника, в котором расположены выгружаемые файлы</span>
<span class="comment">// Представлением списка значений является имя выгружаемого файла</span>
МассивФайлов <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
<span class="keyword">Для</span> <span class="keyword">каждого</span> ЭлементСписка <span class="keyword">Из</span> СписокФайлов <span class="keyword">Цикл</span>
    Файл <span class="operator">=</span> <span class="keyword">Новый</span> Файл<span class="operator">(</span>Строка<span class="operator">(</span>ЭлементСписка<span class="operator">.</span>Значение<span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
    ПолучаемыйФайл <span class="operator">=</span> <span class="keyword">Новый</span> ОписаниеПередаваемогоФайла<span class="operator">;</span>
    ПолучаемыйФайл<span class="operator">.</span>Имя <span class="operator">=</span> ЭлементСписка<span class="operator">.</span>Представление<span class="operator">;</span>
    ПолучаемыйФайл<span class="operator">.</span>Хранение <span class="operator">=</span> ПолучитьНавигационнуюСсылку<span class="operator">(</span>ЭлементСписка<span class="operator">.</span>Значение<span class="operator">,</span> <span class="string">&quot;Данные&quot;</span><span class="operator">)</span><span class="operator">;</span>
    МассивФайлов<span class="operator">.</span>Добавить<span class="operator">(</span>ПолучаемыйФайл<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецЦикла</span><span class="operator">;</span>
ПолученныеФайлы <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
Результат <span class="operator">=</span> ПолучитьФайлы<span class="operator">(</span>МассивФайлов<span class="operator">,</span> ПолученныеФайлы<span class="operator">,</span> ПутьВыгружаемыхФайлов<span class="operator">,</span> <span class="keyword">Ложь</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">Если</span> <span class="keyword">НЕ</span> Результат <span class="keyword">Тогда</span>
    Сообщение <span class="operator">=</span> <span class="keyword">Новый</span> СообщениеПользователю<span class="operator">;</span>
    Сообщение<span class="operator">.</span>Текст <span class="operator">=</span> <span class="string">&quot;Ошибка получения файлов!&quot;</span><span class="operator">;</span>
    Сообщение<span class="operator">.</span>Сообщить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецЕсли</span><span class="operator">;</span></pre>

<p class="MsoNormal">После окончания работы метод может вернуть
список реально выгруженных файлов с указанием полного имени каждого сохраненного
файла.</p>

<p class="Note"><span class="Note">Примечание.</span> Для использования
метода <span class="Term">ПолучитьФайлы()</span> в веб-клиенте требуется
подключение расширения работы с файлами (см. <a href="#_ref236130783">здесь</a>).</p>

<p class="MsoNormalCxSpFirst">В случае если свойство <span class="Term">Имя</span>
объекта <span class="Term">ОписаниеПередаваемогоФайла</span> содержит абсолютный
путь к файлу, файл будет сохранен по этому пути, без учета параметра <span class="Term">РасположениеФайлов</span>.</p>

<p class="MsoNormalCxSpLast">В качестве параметра <span class="Term">РасположениеФайлов</span>
может выступать или путь в локальной файловой системе, или объект <span class="Term">ДиалогВыбораФайлов</span>
в режиме выбора каталога или сохранения файлов. Если в качестве значения
параметра <span class="Term">РасположениеФайлов</span> указан объект <span class="Term">ДиалогВыбораФайлов</span>
в режиме сохранения файлов, то:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
диалог будет вызываться для каждого
передаваемого файла, кроме тех файлов, для которых свойство <span class="Term">Имя</span>
объекта <span class="Term">ОписаниеПередаваемогоФайла</span> содержит абсолютный
путь;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
в качестве начального имени файла в диалоге
будет использоваться значение свойства <span class="Term">Имя</span>
объекта <span class="Term">ОписаниеПередаваемогоФайла</span>;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
если для какого-либо файла будет выбран отказ от
сохранения, то свойство <span class="Term">Имя</span> объекта <span class="Term">ОписаниеПереданногоФайла</span>
будет содержать пустую строку;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
метод <span class="Term">ПолучитьФайлы()</span>
вернет значение <span class="Term">Истина</span>, если хотя бы один файл получен успешно;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
следует учитывать, что собственно получение
файлов выполняется после того, как пользователь ответит на вопросы по указанию
имени и пути всех получаемых файлов;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
если у пользователя, от имени которого
выполняется метод <span class="Term">ПолучитьФайлы()</span>, отсутствует право <span class="Term">Просмотр</span>
хотя бы на один реквизит объекта информационной базы, откуда выполняется
получение файлов – неудачей завершится вся операция.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">ПередаваемыеФайлы <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
Описание <span class="operator">=</span> <span class="keyword">Новый</span> ОписаниеПередаваемогоФайла<span class="operator">(</span><span class="string">&quot;Описание&quot;</span><span class="operator">,</span> АдресФайла<span class="operator">)</span><span class="operator">;</span>
ПередаваемыеФайлы<span class="operator">.</span>Добавить<span class="operator">(</span>Описание<span class="operator">)</span><span class="operator">;</span>
ВыборФайла <span class="operator">=</span> <span class="keyword">Новый</span> ДиалогВыбораФайла<span class="operator">(</span>РежимДиалогаВыбораФайла<span class="operator">.</span>Сохранение<span class="operator">)</span><span class="operator">;</span>
ВыборФайла<span class="operator">.</span>Заголовок <span class="operator">=</span> <span class="string">&quot;Сохранение архива&quot;</span><span class="operator">;</span>
ВыборФайла<span class="operator">.</span>Расширение <span class="operator">=</span> <span class="string">&quot;zip&quot;</span><span class="operator">;</span>
ВыборФайла<span class="operator">.</span>Фильтр <span class="operator">=</span> <span class="string">&quot;Архив(*.zip)|*.zip|Все файлы|*.*&quot;</span><span class="operator">;</span>
ВыборФайла<span class="operator">.</span>ИндексФильтра <span class="operator">=</span> <span class="number">0</span><span class="operator">;</span>
ПолучитьФайлы<span class="operator">(</span>ПередаваемыеФайлы<span class="operator">,</span> <span class="operator">,</span> ВыборФайла<span class="operator">,</span> <span class="keyword">Ложь</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="MsoNormal">Если выбран интерактивный режим выбора
каталога сохранения файлов, то веб-клиент будет дополнительно запрашивать разрешение
на сохранение файлов, указанных с абсолютными путями. В случае неинтерактивного
сохранения (путь к каталогу указан в соответствующем параметре) запрос будет
выполнен для всего списка сохраняемых файлов.</p>

<a id="TI000000817" class="bookmark" name="issogl2_20.3.8_пример_использования_файловых_методов"><h3>20.3.8. Пример использования файловых методов</h3></a>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// Получение в интерактивном режиме файла с диска</span>
<span class="comment">// и помещение его во временное хранилище.</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ВыбратьФайлСДискаИЗаписать<span class="operator">(</span><span class="operator">)</span>
    <span class="keyword">Перем</span> ВыбранноеИмя<span class="operator">;</span>
    <span class="keyword">Перем</span> АдресВременногоХранилища<span class="operator">;</span>
    НовыйОбъект <span class="operator">=</span> Объект<span class="operator">.</span>Ссылка<span class="operator">.</span>Пустая<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Если</span> ПоместитьФайл<span class="operator">(</span>АдресВременногоХранилища<span class="operator">,</span> <span class="string">&quot;&quot;</span><span class="operator">,</span> ВыбранноеИмя<span class="operator">,</span> <span class="keyword">Истина</span><span class="operator">)</span> <span class="keyword">Тогда</span>
        Объект<span class="operator">.</span>ИмяФайла <span class="operator">=</span> ВыбранноеИмя<span class="operator">;</span>
        ПоместитьФайлОбъекта<span class="operator">(</span>АдресВременногоХранилища<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>    
<span class="keyword">КонецПроцедуры</span>
<span class="comment">// Копирование файла из временного хранилища в реквизит</span>
<span class="comment">// справочника, запись объекта, удаление файла из временного</span>
<span class="comment">// хранилища.</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ПоместитьФайлОбъекта<span class="operator">(</span>АдресВременногоХранилища<span class="operator">)</span>
    ЭлементСправочника <span class="operator">=</span> РеквизитФормыВЗначение<span class="operator">(</span><span class="string">&quot;Объект&quot;</span><span class="operator">)</span><span class="operator">;</span>
    ДвоичныеДанные <span class="operator">=</span> ПолучитьИзВременногоХранилища<span class="operator">(</span>АдресВременногоХранилища<span class="operator">)</span><span class="operator">;</span>
    ЭлементСправочника<span class="operator">.</span>ДанныеФайла <span class="operator">=</span> <span class="keyword">Новый</span> ХранилищеЗначения<span class="operator">(</span>ДвоичныеДанные<span class="operator">,</span> <span class="keyword">Новый</span> СжатиеДанных<span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
    Файл <span class="operator">=</span> <span class="keyword">Новый</span> Файл<span class="operator">(</span>ЭлементСправочника<span class="operator">.</span>ИмяФайла<span class="operator">)</span><span class="operator">;</span>
    ЭлементСправочника<span class="operator">.</span>ИмяФайла <span class="operator">=</span> Файл<span class="operator">.</span>Имя<span class="operator">;</span>
    ЭлементСправочника<span class="operator">.</span>Записать<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    Модифицированность <span class="operator">=</span> <span class="keyword">Ложь</span><span class="operator">;</span>
    УдалитьИзВременногоХранилища<span class="operator">(</span>АдресВременногоХранилища<span class="operator">)</span><span class="operator">;</span>
    ЗначениеВРеквизитФормы<span class="operator">(</span>ЭлементСправочника<span class="operator">,</span> <span class="string">&quot;Объект&quot;</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="comment">// Считывание файла из реквизита и сохранение его</span>
<span class="comment">// на локальном диске в интерактивном режиме.</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ПрочитатьФайлИСохранитьНаДиск<span class="operator">(</span><span class="operator">)</span>
    Адрес <span class="operator">=</span> ПолучитьНавигационнуюСсылку<span class="operator">(</span>Объект<span class="operator">.</span>Ссылка<span class="operator">,</span><span class="string">&quot;ДанныеФайла&quot;</span><span class="operator">)</span><span class="operator">;</span>
    ПолучитьФайл<span class="operator">(</span>Адрес<span class="operator">,</span> Объект<span class="operator">.</span>ИмяФайла<span class="operator">,</span> <span class="keyword">Истина</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<a name="_ref236115645"></a><a name="_ref435618396"></a><a name="_ref435618395"></a><a id="TI000000818" class="bookmark" name="issogl2_20.3.9_разрешение_на_выполнение_группы_операций_с_файлами"><h3>20.3.9. Разрешение на выполнение группы операций с файлами</h3></a>

<p class="MsoNormalCxSpFirst">При выполнении некоторых операций в
веб-клиенте может потребоваться получить разрешение на несколько операций по
работе с файлами. Например, необходимо выполнить получение документа из
информационной базы и затем открыть сохраненный документ с помощью
ассоциированного приложения.</p>

<p class="MsoNormalCxSpMiddle">Для выполнения этой операции потребуется
отвечать на вопрос о сохранении документа и на вопрос о необходимости запуска.
Если операций будет больше, вопросов пользователю также станет больше.</p>

<p class="MsoNormalCxSpLast">Для уменьшения количества вопросов можно
воспользоваться методом <span class="Term">ЗапроситьРазрешениеПользователя()</span>.
При использовании этого метода пользователю отображается список всех операций,
которые планируется выполнить, и предлагается разрешить выполнение группы
операций. Если пользователь разрешил выполнение, то запрошенные операции будут
выполняться без дополнительных запросов пользователю. Если разрешение не
предоставлено, операции будут выполняться в обычном режиме: один запрос на одну
операцию.</p>

<p class="Note"><span class="Note">Примечание.</span> Для использования
метода <span class="Term">ЗапроситьРазрешениеПользователя()</span>
в веб-клиенте требуется подключить расширение работы с файлами
(см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 4. встроенный язык.htm?_=1496848987#_ref404250037">здесь</a>).</p>

<p class="MsoNormal">Рассмотрим пример использования метода:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Если</span> ПодключитьРасширениеРаботыСФайлами<span class="operator">(</span><span class="operator">)</span> <span class="keyword">Тогда</span>
    Ссылка <span class="operator">=</span> ПолучитьНавигационнуюСсылку<span class="operator">(</span>Объект<span class="operator">.</span>Ссылка<span class="operator">,</span> <span class="string">&quot;ДанныеФайла&quot;</span><span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Формирование описания передаваемых файлов (в данном случае файл один)</span>
    ПередаваемыеФайлы <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
    Описание <span class="operator">=</span> <span class="keyword">Новый</span> ОписаниеПередаваемогоФайла<span class="operator">(</span>Объект<span class="operator">.</span>ИмяФайла<span class="operator">,</span> Ссылка<span class="operator">)</span><span class="operator">;</span>
    ПередаваемыеФайлы<span class="operator">.</span>Добавить<span class="operator">(</span>Описание<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Готовим объект для получения информации о полученных файлах</span>
    ПереданныеФайлы <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
    <span class="comment">// Определяем прочие параметры методов</span>
    КаталогСохранения <span class="operator">=</span> <span class="string">&quot;c:\temp&quot;</span><span class="operator">;</span>
    Интерактивно <span class="operator">=</span> <span class="keyword">Ложь</span><span class="operator">;</span>
    ИмяПереданногоФайла <span class="operator">=</span> КаталогСохранения <span class="operator">+</span> <span class="string">&quot;\&quot;</span> <span class="operator">+</span> Объект<span class="operator">.</span>ИмяФайла<span class="operator">;</span>
    <span class="comment">// Готовим описание методов для получения разрешений</span>
    Методы <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
    Методы<span class="operator">.</span>Добавить<span class="operator">(</span><span class="keyword">Новый</span> Массив<span class="operator">)</span><span class="operator">;</span>
    Методы<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ПолучитьФайлы&quot;</span><span class="operator">)</span><span class="operator">;</span>
    Методы<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>Добавить<span class="operator">(</span>ПередаваемыеФайлы<span class="operator">)</span><span class="operator">;</span>
    Методы<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>Добавить<span class="operator">(</span>ПереданныеФайлы<span class="operator">)</span><span class="operator">;</span>
    Методы<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>Добавить<span class="operator">(</span>КаталогСохранения<span class="operator">)</span><span class="operator">;</span>
    Методы<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>Добавить<span class="operator">(</span>Интерактивно<span class="operator">)</span><span class="operator">;</span>
    Методы<span class="operator">.</span>Добавить<span class="operator">(</span><span class="keyword">Новый</span> Массив<span class="operator">)</span><span class="operator">;</span>
    Методы<span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ЗапуститьПриложение&quot;</span><span class="operator">)</span><span class="operator">;</span>
    Методы<span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">.</span>Добавить<span class="operator">(</span>ИмяПереданногоФайла<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Если</span> <span class="keyword">Не</span> ЗапроситьРазрешениеПользователя<span class="operator">(</span>Методы<span class="operator">)</span> <span class="keyword">Тогда</span>
        Предупреждение<span class="operator">(</span><span class="string">&quot;Пользователь отказал в разрешении.&quot;</span><span class="operator">)</span><span class="operator">;</span>
        <span class="keyword">Возврат</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>    
    ПолучитьФайлы<span class="operator">(</span>ПередаваемыеФайлы<span class="operator">,</span> ПереданныеФайлы<span class="operator">,</span> КаталогСохранения<span class="operator">,</span> Интерактивно<span class="operator">)</span><span class="operator">;</span>
    ЗапуститьПриложение<span class="operator">(</span>ИмяПереданногоФайла<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">Иначе</span>
    Предупреждение<span class="operator">(</span><span class="string">&quot;Выполнение не поддерживается. Не установлено расширение работы с файлами.&quot;</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецЕсли</span><span class="operator">;</span></pre>

<p class="MsoNormal">Следует отметить несколько особенностей
применения метода <span class="Term">ЗапроситьРазрешениеПользователя()</span>.</p>

<p class="MsoListBullet">&#9679; 
Разрешение запрашивается только для следующих
методов:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
<span class="Term">ПолучитьФайлы()</span>/<span class="Term">НачатьПолучениеФайлов()</span>,</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">ПоместитьФайлы()</span>/<span class="Term">НачатьПомещениеФайлов()</span>,</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">НайтиФайлы()</span>/<span class="Term">НачатьПоискФайлов()</span>,</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">КопироватьФайл()</span>/<span class="Term">НачатьКопированиеФайла()</span>,</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">ПереместитьФайл()</span>/<span class="Term">НачатьПеремещениеФайла()</span>,</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">УдалитьФайлы()</span>/<span class="Term">НачатьУдалениеФайлов()</span>,</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">СоздатьКаталог()</span>/<span class="Term">НачатьСозданиеКаталога()</span>,</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
<span class="Term">ЗапуститьПриложение()</span>/<span class="Term">НачатьЗапускПриложения()</span>.</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Разрешение запрашивается для конкретного набора
параметров метода. Если при реальном исполнении метода работы с файлами
значения параметров будут отличаться от тех, для которых получено разрешение, это
разрешение не будет действовать и пользователь получит отдельный запрос на
подтверждение выполнения операции.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Если необходимо выполнить две (или более) одинаковые
операции с файлами (даже с одинаковым набором параметров), следует указать
соответствующее количество элементов в массиве параметров метода <span class="Term">ЗапроситьРазрешениеПользователя()</span>.
Например, если необходимо дважды получить из информационной базы один и тот же
файл и поместить его в фиксированное место файловой системы, следует запросить
разрешение на две операции.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Если запрашивается разрешение на операцию, при
выполнении которой выполняется интерактивная операция (например, функции <span class="Term">ПолучитьФайлы()</span>
в качестве параметра передается объект <span class="Term">ДиалогВыбораФайла</span>),
то такая операция исключается из запроса.</p>

<p class="MsoNormal">Полученные разрешения сохраняются либо до
выполнения разрешенного вызова, либо до окончания исполнения встроенного языка.</p>

<p class="Note"><span class="Note">Примечание.</span> В толстом и тонком
клиентах <span class="Term">ЗапроситьРазрешениеПользователя()
</span>метод всегда возвращает значение <span class="Term">Истина</span>,
без взаимодействия с пользователем.</p>

<a name="_ref263243074"></a><a name="_ref393795390"></a><a name="_ref393795389"></a><a name="_ref393795347"></a><a id="TI000000819" class="bookmark" name="issogl2_20.3.10_работа_с_временным_хранилищем_в_фоновом_задании"><h3>20.3.10. Работа с временным хранилищем в фоновом задании</h3></a>

<p class="MsoNormalCxSpFirst">В механизме работы с временным хранилищем
есть возможность передать данные из фонового задания в сеанс, инициировавший
фоновое задание. Для такой передачи следует в родительском сеансе поместить во
временное хранилище пустое значение (с помощью метода <span class="Term">ПоместитьВоВременноеХранилище()</span>),
указав какой-либо идентификатор создаваемого временного хранилища (параметр <span class="Term">Адрес</span>).
Затем полученный адрес передать в фоновое задание через параметры фонового
задания. Далее, если в фоновом задании этот адрес использовать в качестве
значения параметра <span class="Term">Адрес</span> метода <span class="Term">ПоместитьВоВРеменноеХранилище()</span>,
то результат будет скопирован в сеанс, из которого было запущено фоновое
задание.</p>

<p class="MsoNormalCxSpLast">Данные, помещенные во временное хранилище в
фоновом задании, не будут доступны из родительского сеанса до момента завершения
фонового задания.</p>

<a id="TI000000820" class="bookmark" name="issogl2_20.3.11_поддержка_адресов_в_поле_картинки"><h3>20.3.11. Поддержка адресов в поле картинки</h3></a>

<p class="MsoNormal">Элемент формы <span class="Interface">Поле</span> вида <span class="Interface">Поле картинки</span> поддерживает отображение картинки,
заданной адресом значения (которое может быть картинкой или двоичными данными)
во временном хранилище или в базе данных.</p>

<p class="Regularbeforepicture">Для этого в свойстве <span class="Interface">Данные</span> элемента формы необходимо задать реквизит
строкового типа. Значение этого реквизита и будет интерпретироваться как адрес
картинки.</p>

<p class="Picture"><IMG src="_img/img00464.gif?_=1496848987" WIDTH="573" ALT HEIGHT="489"></p>

<p class="MsoCaption">Рис. 456. Отображение картинки
на форме</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// Пример 1</span>
<span class="comment">// Привязка поля картинки к адресу картинки во временном</span>
<span class="comment">// хранилище. АдресКартинки – реквизит формы строкового типа</span>
ПоместитьФайл<span class="operator">(</span>АдресКартинки<span class="operator">,</span> ИсходноеИмя<span class="operator">,</span> ВыбранноеИмя<span class="operator">,</span> <span class="keyword">Истина</span><span class="operator">,</span> УникальныйИдентификатор<span class="operator">)</span><span class="operator">;</span>
<span class="comment">// Пример 2</span>
<span class="comment">// Получение адреса картинки из реквизита объекта</span>
<span class="comment">// информационной базы</span>
ФайлКартинки <span class="operator">=</span> Объект<span class="operator">.</span>ФайлКартинки<span class="operator">;</span>
<span class="keyword">Если</span> <span class="keyword">Не</span> ФайлКартинки<span class="operator">.</span>Пустая<span class="operator">(</span><span class="operator">)</span> <span class="keyword">Тогда</span>
    АдресКартинки <span class="operator">=</span> ПолучитьНавигационнуюСсылку<span class="operator">(</span>ФайлКартинки<span class="operator">,</span> <span class="string">&quot;ДанныеФайла&quot;</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">Иначе</span>
    АдресКартинки <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="operator">;</span>
<span class="keyword">Конецесли</span><span class="operator">;</span></pre>

<a name="_ref236130783"></a><a name="_ref323222546"></a><a id="TI000000821" class="bookmark" name="issogl2_20.3.12_доступ_к_стандартным_каталогам"><h3>20.3.12. Доступ к стандартным каталогам</h3></a>

<p class="MsoNormalCxSpFirst">При использовании системы требуется
некоторое место в файловой системе, где можно хранить различные файловые
данные, которые с одной стороны являются временными, а с другой – должны
храниться достаточно длительное время. К таким файлам можно отнести черновики
для систем управления документооборотом, внешние компоненты, работающие на
стороне клиентского компьютера и т. д.</p>

<p class="MsoNormalCxSpLast">Для хранения таких файлов предназначен
специальный каталог, который привязан к конкретному пользователю конкретной информационной
базы. Один и тот же пользователь, работающий с двумя информационными базами,
будет иметь доступ к двум разным каталогам хранения данных пользователя.
Местоположение данного каталога определяется с помощью метода РабочийКаталогДанныхПользователя().
Если каталог отсутствует, то он создается при первом обращении к нему. Если
создание каталога невозможно – система вызывает исключение.</p>

<p class="Note"><span class="Note">Примечание.</span> Метод <span class="Term">РабочийКаталогДанныхПользователя()</span>не
доступен на стороне сервера.</p>

<p class="MsoNormalCxSpFirst">В операционной системе имеется специальный
каталог, выделенный для постоянного хранения данных пользователя. Это могут
быть какие-то отчеты, печатные формы документов и т. д. В этот
каталог помещаются данные, которые в дальнейшем могут быть отправлены внешним
потребителям. Для доступа к этому каталогу предназначен метод <span class="Term">КаталогДокументов()</span>.
Физическое расположение каталога зависит от операционной системы, где
исполняется приложение и приведено в синтакс-помощнике.</p>

<p class="MsoNormalCxSpMiddle"> </p>

<br>		<script type="text/javascript">listenCopy('zeroclipboard.swf');</script>
	</body>
</html>