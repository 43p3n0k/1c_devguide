<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>&#1043;&#1083;&#1072;&#1074;&#1072; 17. &#1052;&#1077;&#1093;&#1072;&#1085;&#1080;&#1079;&#1084;&#1099; &#1080;&#1085;&#1090;&#1077;&#1088;&#1085;&#1077;&#1090;-&#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1086;&#1074;</title>
		<LINK REL="stylesheet" href="style.css?_=1496848987">
		<SCRIPT src="script.js?_=1496848987" TYPE="text/javascript"></script>		<!--[if !IE]>--><SCRIPT src="zeroclipboard.js?_=1496848987" TYPE="text/javascript"></script><!--<![endif]-->
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="/db/content/v8310doc/src/руководство разработчика/глава 17. механизмы интернет-сервисов.htm" rel="canonical">
<link href="/static/its.content.css?_=1490872753" type="text/css" rel="stylesheet">
<script type="text/javascript" src="/static/its.content.js?_=1489758009"></script>
<!--[if lt IE 9]><script type="text/javascript" src="/static/html5shiv.js?_=1484636606"></script><![endif]-->

</head>
	<body class="v8310doc">
<a name="_ref380404113"></a><a name="_ref237783505"></a><a id="TI000000783" class="bookmark"><h1>Глава 17.  Механизмы интернет-сервисов</h1></a>

<a name="_ref380403400"></a><a name="_ref380405633"></a><a id="TI000001356" class="bookmark" name="issogl1_17.1_web-сервисы"><h2>17.1. Web-сервисы</h2></a>

<a name="_ref392771870"></a><a id="TI000001473" class="bookmark" name="issogl2_17.1.1_общая_информация"><h3>17.1.1. Общая информация</h3></a>

<p class="MsoNormalCxSpFirst">Механизм Web-сервисов в системе «1С:Предприятие» является средством
поддержки сервисно-ориентированной архитектуры (<span class="Interface">Service-</span><span class="Interface">Oriented </span><span class="Interface">Architecture</span>, <span class="Interface">SOA</span>).</p>

<p class="MsoNormalCxSpMiddle">Сервисно-ориентированная архитектура представляет
собой прикладную архитектуру, в которой все функции определены как независимые
сервисы с вызываемыми интерфейсами. Обращение к этим сервисам в определенной
последовательности позволяет реализовать тот или иной бизнес-процесс.</p>

<p class="MsoNormalCxSpMiddle">Сервисно-ориентированная архитектура предлагает новый
подход к созданию распределенных информационных систем, в которых программные
ресурсы рассматриваются как сервисы, предоставляемые по сети. Такой подход
позволяет обеспечить быструю консолидацию распределенных компонентов (сервисов) в
единое решение для поддержки определенных бизнес-процессов.</p>

<p class="MsoNormalCxSpMiddle">Механизм Web-сервисов позволяет использовать систему «1С:Предприятие» как
набор сервисов в сложных распределенных и гетерогенных системах, а также
позволяет интегрировать ее с другими промышленными системами с использованием
сервисно-ориентированной архитектуры.</p>

<p class="MsoNormalCxSpLast">Конфигурация системы «1С:Предприятие» может
экспортировать свою функциональность через Web-сервисы. Определения Web-сервисов задаются в дереве конфигурации и становятся доступны
произвольным информационным системам благодаря публикации их на веб-сервере.</p>

<p class="Regularbeforepicture">Кроме этого, система «1С:Предприятие» может
обращаться к Web-сервисам
сторонних производителей как через статические ссылки, определенные в дереве
конфигурации, так и с помощью динамических ссылок, создаваемых средствами встроенного
языка.</p>

<p class="Picture"><IMG src="_img/img00457.gif?_=1496848987" WIDTH="649" ALT HEIGHT="370"></p>

<p class="MsoCaption">Рис. 449. Web-сервисы</p>

<p class="MsoNormal">В основе сервисной архитектуры системы «1C:Предприятие 8»
находится менеджер сервисов. Менеджер сервисов выполняет следующие функции:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
управление пулом соединений с информационными
базами;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
поддержка WSDL описания сервиса;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
реализация протокола SOAP, сериализация
сообщений, вызов соответствующего сервиса.</p>

<p class="MsoNormalCxSpFirst">Менеджер сервисов выполняется в процессе сервисного
хоста, который выполняет функцию приема/передачи сообщений из/в менеджер
сервисов. В качестве сервисного хоста может использоваться веб-сервер IIS или Apache.</p>

<p class="MsoNormalCxSpMiddle">Менеджер сервисов содержит в себе пул соединений,
через которые идет взаимодействие с базами данных системы «1С:Предприятие».</p>

<p class="MsoNormalCxSpLast">Механизм Web-сервисов, реализованный в системе «1С:Предприятие»,
поддерживает следующие стандарты:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
SOAP 1.1,</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
SOAP 1.2,</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
WSDL 1.1,</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
WS-I Basic Profile 1.1,</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
HTTP 1.1,</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
TLS 1.x (TLS 1.1 и 1.2 поддерживаются, если не
требуется передача клиентского сертификата на сервер), включая криптографические
алгоритмы, соответствующие ГОСТ Р 34.10-2001, Р 34.10-94, Р 34.11-94
и 28147-89;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
MTOM;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Аутентификация: Basic, NTLM/Negotiate.</p>

<p class="MsoNormal">Механизм Web-сервисов, реализованный в системе
«1С:Предприятие», не поддерживает:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Механизм WS-Policy;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Механизм WS-Addressing;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Протокол WS-Security;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Задание уже используемого XML пространства имен
в качестве целевого пространства имен (targetNamespace).</p>

<p class="MsoNormal">Для получения доступа к Web-сервису
необходимо использовать адрес, который формируется следующим образом: <span class="Interface">http://host/base/ws/ИмяWebСервиса</span>
или <span class="Interface">http://host/base/ws/АдресWebСервиса</span>.
Более подробно рассмотрим составные части адреса:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<a href="http://host/base" target="_blank">http://host/base</a> – обычный URL, по которому
выполняется доступ, например, к информационной базе с помощью веб-клиента. При
наличии разделителей, не поддерживается указание значений разделителей с
помощью параметра <span class="Interface">Z</span> командной строки запуска клиентского
приложения.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">ws</span> – признак
того, что выполняется обращение к Web-сервису (в отличие от <span class="Interface">hs</span>, который определяет доступ к HTTP-сервису,
см. <a href="#_ref380409689">здесь</a>).</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">ИмяWebСервиса</span> –
имя Web-сервиса. Задается в свойстве объекта <span class="Interface">Web-сервис</span>.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">АдресWebСервиса</span> –
описывает альтернативное имя для доступа к Web-сервису. Задается в свойстве <span class="Interface">Имя файла публикации</span> объекта <span class="Interface">Web-сервис</span>.
Может быть изменено при публикации Web-сервиса.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Обращения по имени и адресу Web-сервиса являются
равносильными.</p>

<a name="_ref431987243"></a><a name="_ref431987242"></a><a id="TI000000784" class="bookmark" name="issogl2_17.1.2_предоставление_функциональности_через_web-сервисы"><h3>17.1.2. Предоставление функциональности через Web-сервисы</h3></a>

<p class="MsoNormal">Для того чтобы функциональность системы «1С:Предприятие» стала
доступна внешним потребителям Web-сервисов,
нужно выполнить следующие действия:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
создать в конфигурации необходимое количество Web-сервисов,</p>

<p class="MsoListBulletCxSpLast">&#9679; 
опубликовать Web-сервисы с помощью специального инструмента конфигуратора.</p>

<p class="MsoNormalCxSpFirst">Описание процедуры публикации Web-сервисов см. <a href="/db/v8310doc/bookmark/adm/TI000000222" target="_top">здесь</a>. Описание использования Reverse Proxy для доступа к «1С:Предприятию»
см. <a href="/db/v8310doc/bookmark/adm/TI000000249" target="_top">здесь</a>.</p>

<p class="MsoNormalCxSpLast">Создание Web-сервиса заключается:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
в добавлении в дерево метаданных объекта
конфигурации Web-сервис,</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
описании операций, которые может выполнять создаваемый
Web-сервис,</p>

<p class="MsoListBulletCxSpLast">&#9679; 
описании параметров операций Web-сервиса.</p>

<p class="MsoNormalCxSpFirst">Объект конфигурации <span class="Interface">Web-сервис</span>
содержит модуль, в котором создаются процедуры на встроенном языке, выполняемые
при вызове тех или иных операций Web-сервиса. Типы параметров операций Web-сервиса описываются с помощью типов
XDTO и могут представлять собой либо значения XDTO, либо объекты XDTO.</p>

<p class="MsoNormalCxSpLast">Вызов Web-сервиса происходит следующим образом:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
из пула соединений выбирается подходящее
соединение с информационной базой; при отсутствии необходимого соединения соединение
создается;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
создается новый сеанс и для созданного сеанса
вызывается событие <span class="Term">УстановкаПараметровСеанса</span>
(в модуле сеанса);</p>

<p class="MsoListBulletCxSpLast">&#9679; 
выполняется вызов затребованного метода Web-сервиса, при этом
происходит вызов обработчика <span class="Term">УстановкаПараметровСеанса()</span> (в модуле сеанса)
каждый раз, когда происходит обращение к неинициализированному параметру
сеанса.</p>

<p class="Note"><span class="Note">Совет.</span> Не рекомендуется выполнять ресурсоемкие
операции в обработчике события <span class="Term">УстановкаПараметровСеанса</span>.</p>

<p class="MsoNormalCxSpFirst">Событие <span class="Term">УстановкаПараметровСеанса</span> модуля сеанса
вызывается на сервере в привилегированном режиме. Модуль вызванного сервиса
исполняется на сервере в обычном режиме.</p>

<p class="MsoNormalCxSpLast">Модуль сеанса (см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 5. объекты конфигурации.htm?_=1496848987#_ref135719999">здесь</a>) служит для инициализации параметров сеанса и
выполнения некоторого набора команд при вызове любого Web-сервиса системы «1С:Предприятие».</p>

<a name="_ref215392706"></a><a name="_ref380591312"></a><a id="TI000000785" class="bookmark" name="issogl2_17.1.3_пример_реализации_web-сервиса"><h3>17.1.3. Пример реализации Web-сервиса</h3></a>

<p class="MsoNormalCxSpFirst">Например, требуется создать
Web-сервис системы «1С:Предприятие», который должен по
переданному номеру расходной накладной возвращать состав ее табличной части.
Аналогичный пример с помощью HTTP-сервисов см. <a href="#_ref380593566">здесь</a>.</p>

<p class="MsoNormalCxSpLast">Для описания возвращаемого значения создадим пакет XDTO
<span class="Term">ДанныеРасходнойНакладной</span>
с пространством имен <span class="Interface">http://www.MyCompany.ru/shipment</span>,
содержащий три типа объектов XDTO:</p>

<p class="MsoListBullet">&#9679; 
<span class="Term">Номенклатура</span> – для передачи данных
элемента справочника <span class="Term">Номенклатура</span>.
Этот тип объекта XDTO будет содержать следующие свойства:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
<span class="Term">Наименование</span> – тип <span class="Term">string</span> из
пространства имен <span class="Interface">http://www.w3.org/2001/XMLSchema</span>;</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">ПолноеНаименование</span> – тип <span class="Term">string</span>
из пространства имен <span class="Interface">http://www.w3.org/2001/XMLSchema</span>;</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">ШтрихКод</span> – тип <span class="Term">string</span> из
пространства имен <span class="Interface">http://www.w3.org/2001/XMLSchema</span>;</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
<span class="Term">ЗакупочнаяЦена</span> – тип <span class="Term">int</span> из
пространства имен <span class="Interface">http://www.w3.org/2001/XMLSchema</span>.</p>

<p class="MsoListBullet">&#9679; 
<span class="Term">СтрокаРасходнойНакладной</span> – для передачи
данных одной строки расходной накладной. Этот тип объекта XDTO будет содержать
следующие свойства:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
<span class="Term">Номенклатура</span> – тип <span class="Term">Номенклатура</span> из
пространства имен <span class="Interface">http://www.MyCompany.ru/shipment</span>;
представляет собой ссылку на объект XDTO, который мы определили выше;</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">Количество</span> – тип <span class="Term">int</span> из
пространства имен <span class="Interface">http://www.w3.org/2001/XMLSchema</span>;</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Term">Цена</span> – тип <span class="Term">int</span> из
пространства имен <span class="Interface">http://www.w3.org/2001/XMLSchema</span>;</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
<span class="Term">Сумма</span> – тип <span class="Term">int</span> из
пространства имен <span class="Interface">http://www.w3.org/2001/XMLSchema</span>.</p>

<p class="MsoListBullet">&#9679; 
<span class="Term">РасходнаяНакладная</span> – для передачи данных
всех строк расходной накладной. Этот тип объекта XDTO будет содержать
единственное свойство:</p>

<p class="MsoListBullet2">&#9679; 
<span class="Term">Состав</span> – тип <span class="Term">СтрокаРасходнойНакладной</span>
из пространства имен <span class="Interface">http://www.MyCompany.ru/shipment</span>.
Представляет собой ссылку на объект XDTO, который мы определили выше. Для того
чтобы это свойство могло содержать неограниченное множество значений, необходимо
установить его свойство <span class="Interface">Верхняя граница</span> в значение
-1.</p>

<p class="MsoNormal">После того как необходимые типы XDTO созданы, следует добавить
в конфигурацию новый Web-сервис <span class="Term">ДанныеРасходнойНакладной</span> со следующими
значениями свойств:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">URI Пространства имен</span> –
<span class="Interface">http://www.MyCompany.ru/shipment</span>;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">Пакеты XDTO</span> – <span class="Term">ДанныеРасходнойНакладной</span>;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">Имя файла публикации</span> –
<span class="Term">shipment.1cws</span>.</p>

<p class="MsoNormal">У созданного Web-сервиса следует определить операцию <span class="Term">Получить</span>
со следующими значениями свойств:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">Тип возвращаемого значения</span> –
<span class="Term">РасходнаяНакладная</span>
из пространства имен <span class="Interface">http://www.MyCompany.ru/shipment</span>;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">Возможно пустое значение</span> –
установлен;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">Имя процедуры</span> –
<span class="Term">Получить</span>.</p>

<p class="MsoNormal">У операции <span class="Interface">Получить</span> следует
определить параметр <span class="Interface">НомерДокумента</span> со следующими
значениями свойств:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">Тип значения</span> –
тип <span class="Term">string</span>
из пространства имен <span class="Interface">http://www.w3.org/2001/XMLSchema</span>;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">Направление передачи</span> –
<span class="Interface">Входной</span>.</p>

<p class="MsoNormal">После этого следует открыть модуль созданного Web-сервиса и разместить в
этом модуле функцию <span class="Term">Получить()</span>,
которая будет выполняться при вызове данного Web-сервиса.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Функция</span> Получить<span class="operator">(</span>НомерДокумента<span class="operator">)</span> <span class="keyword">Экспорт</span>
    <span class="comment">// Получить объект расходной накладной по переданному номеру</span>
    ДокументСсылка <span class="operator">=</span> Документы<span class="operator">.</span>РасходнаяНакладная<span class="operator">.</span> НайтиПоНомеру<span class="operator">(</span>НомерДокумента<span class="operator">,</span> ТекущаяДата<span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Если</span> ДокументСсылка<span class="operator">.</span>Пустая<span class="operator">(</span><span class="operator">)</span> <span class="keyword">Тогда</span>
        <span class="keyword">Возврат</span> <span class="keyword">Неопределено</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    Документ <span class="operator">=</span> ДокументСсылка<span class="operator">.</span>ПолучитьОбъект<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Получить типы объектов XDTO</span>
    НоменклатураТип <span class="operator">=</span> ФабрикаXDTO<span class="operator">.</span>Тип<span class="operator">(</span><span class="string">&quot;http://www.MyCompany.ru/shipment&quot;</span><span class="operator">,</span> <span class="string">&quot;Номенклатура&quot;</span><span class="operator">)</span><span class="operator">;</span>
    РасходнаяНакладнаяТип <span class="operator">=</span> ФабрикаXDTO<span class="operator">.</span>Тип<span class="operator">(</span><span class="string">&quot;http://www.MyCompany.ru/shipment&quot;</span><span class="operator">,</span> <span class="string">&quot;РасходнаяНакладная&quot;</span><span class="operator">)</span><span class="operator">;</span>
    СтрокаРасходнойНакладнойТип <span class="operator">=</span> ФабрикаXDTO<span class="operator">.</span>Тип<span class="operator">(</span><span class="string">&quot;http://www.MyCompany.ru/shipment&quot;</span><span class="operator">,</span> <span class="string">&quot;СтрокаРасходнойНакладной&quot;</span><span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Создать объект XDTO расходной накладной</span>
    РасходнаяНакладная <span class="operator">=</span> ФабрикаXDTO<span class="operator">.</span>Создать<span class="operator">(</span>РасходнаяНакладнаяТип<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Для</span> <span class="keyword">Каждого</span> СтрокаДокумента <span class="keyword">Из</span> Документ<span class="operator">.</span>Состав <span class="keyword">Цикл</span>
        <span class="comment">// Создать объекты XDTO строки расходной накладной</span>
        <span class="comment">// и номенклатуры</span>
        СтрокаРасходнойНакладной <span class="operator">=</span> ФабрикаXDTO<span class="operator">.</span>Создать<span class="operator">(</span>СтрокаРасходнойНакладнойТип<span class="operator">)</span><span class="operator">;</span>
        Номенклатура <span class="operator">=</span> ФабрикаXDTO<span class="operator">.</span>Создать<span class="operator">(</span>НоменклатураТип<span class="operator">)</span><span class="operator">;</span>
        <span class="comment">// Заполнить свойства номенклатуры</span>
        Номенклатура<span class="operator">.</span>Наименование <span class="operator">=</span> СтрокаДокумента<span class="operator">.</span>Номенклатура<span class="operator">.</span>Наименование<span class="operator">;</span>
        Номенклатура<span class="operator">.</span>ПолноеНаименование <span class="operator">=</span> СтрокаДокумента<span class="operator">.</span>Номенклатура<span class="operator">.</span>ПолноеНаименование<span class="operator">;</span>
        Номенклатура<span class="operator">.</span>ШтрихКод <span class="operator">=</span> СтрокаДокумента<span class="operator">.</span>Номенклатура<span class="operator">.</span>ШтрихКод<span class="operator">;</span>
        Номенклатура<span class="operator">.</span>ЗакупочнаяЦена <span class="operator">=</span> СтрокаДокумента<span class="operator">.</span>Номенклатура<span class="operator">.</span>ЗакупочнаяЦена<span class="operator">;</span>
        <span class="comment">// Заполнить свойства строки расходной накладной</span>
        СтрокаРасходнойНакладной<span class="operator">.</span>Номенклатура <span class="operator">=</span> Номенклатура<span class="operator">;</span>
        СтрокаРасходнойНакладной<span class="operator">.</span>Количество <span class="operator">=</span> СтрокаДокумента<span class="operator">.</span>Количество<span class="operator">;</span>
        СтрокаРасходнойНакладной<span class="operator">.</span>Цена <span class="operator">=</span> СтрокаДокумента<span class="operator">.</span>Цена<span class="operator">;</span>
        СтрокаРасходнойНакладной<span class="operator">.</span>Сумма <span class="operator">=</span> СтрокаДокумента<span class="operator">.</span>Сумма<span class="operator">;</span>
        <span class="comment">// Добавить строку расходной накладной</span>
        РасходнаяНакладная<span class="operator">.</span>Состав<span class="operator">.</span>Добавить<span class="operator">(</span>СтрокаРасходнойНакладной<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">КонецЦикла</span><span class="operator">;</span>
    <span class="comment">// Вернуть расходную накладную</span>
    <span class="keyword">Возврат</span> РасходнаяНакладная<span class="operator">;</span>
<span class="keyword">КонецФункции</span></pre>

<p class="MsoNormal">В заключение следует опубликовать созданный Web-сервис на
веб-сервере, например <span class="Interface">http://www.MyCompany.ru</span>, в каталоге
<span class="Interface">shipment</span>.</p>

<a id="TI000000786" class="bookmark" name="issogl2_17.1.4_работа_с_веб-сервисами_сторонних_поставщиков"><h3>17.1.4. Работа с веб-сервисами сторонних поставщиков</h3></a>

<a name="_ref435199733"></a><a id="TI000001577" class="bookmark" name="issogl3_17.1.4.1_общая_информация"><h4>17.1.4.1. Общая информация</h4></a>

<p class="MsoNormal">Система «1С:Предприятие» может использовать веб-сервисы, предоставляемые
другими поставщиками, несколькими способами:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
с помощью статических ссылок, создаваемых в
дереве конфигурации;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
с помощью динамических ссылок, создаваемых средствами
встроенного языка;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
комбинацией предыдущих способов.</p>

<p class="MsoNormalCxSpFirst">Преимущество использования статических ссылок
заключается в большей скорости работы, т. к. описание веб-сервиса поставщика
получается один раз, при создании ссылки. В дальнейшем при обращении к данному
веб-сервису используется существующее описание веб-сервиса.</p>

<p class="MsoNormalCxSpMiddle">При использовании динамических ссылок описание
веб-сервиса поставщика будет получаться системой «1С:Предприятие» каждый раз
при вызове веб-сервиса, что, естественно, будет замедлять работу с данным
веб-сервисом. Однако преимуществом такого подхода является возможность
получения актуального описания веб-сервиса поставщика. При использовании же
статических ссылок для получения актуального описания веб-сервиса следует выполнить
повторный импорт WSDL-описания средствами конфигуратора и сохранение измененной
конфигурации.</p>

<p class="MsoNormalCxSpMiddle">При эксплуатации прикладных решений может
возникать ситуация, когда один и тот же веб-сервис предоставляется по разным
адресам (URL), однако имеет абсолютно одинаковое описание (WSDL). В этом случае
возникает потребность загрузить описание веб-сервиса в конфигурацию (создать
объект в дереве объектов конфигурации), но во время использования указать
конкретный адрес, по которому расположен веб-сервис. Комбинированный способ позволяет
работать таким образом. В качестве примера можно рассмотреть следующую
ситуацию: есть тиражируемый веб-сервис, выполняющий некоторую функцию.
Прикладное решение, написанное на «1С:Предприятии», пользуется услугами данного
сервиса, при этом адрес сервиса может быть различным (сервис тиражируемый), а
описание – фиксированное. Тогда в прикладное решение может загрузить
описание веб-сервиса, а в настройках прикладного решения предусмотреть ввод
адреса конкретного экземпляра сервиса, который (адрес) и будет использоваться
при работе.</p>

<p class="MsoNormalCxSpMiddle">Также доступно и другой способ: используется
динамическая ссылка, но адрес расположения веб-сервиса получается не из файла
описания (WSDL), а непосредственно указывается при создании объекта.</p>

<p class="MsoNormalCxSpLast">При попытке загрузить описание Web-сервиса в
конфигураторе (создание статической ссылки) или при использовании динамической
ссылки (при помощи объекта <span class="Term">WSОпределения</span>), система выполняет проверку
загружаемого описания Web-сервиса (WSDL). Если в описании Web-сервиса
присутствует ошибка (с «точки зрения» системы «1С:Предприятия»), то описание не
будет загружено и будет сгенерировано исключение. В тексте исключения будет находиться
подробная диагностика причин отказа в загрузке. Ошибки WSDL располагаются в
порядке их обнаружения. Каждая ошибка WSDL содержить запись с детальным
описанием следующего вида:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
&lt;Тип элемента с ошибкой&gt;.&lt;Имя&gt;
    [&lt;Тип элемента с ошибкой&gt;.&lt;Имя&gt;[…]]
        &lt;Описание ошибки&gt;
        &lt;Тип элемента с ошибкой&gt;
        &lt;Имя&gt;
</pre>

<p class="MsoNormal">В этом описании:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">Тип элемента с ошибкой</span> –
тип элемента WSDL. Чаще всего соответствует имени тега в xml-файле, описывающем
Web-сервис.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">Описание ошибки</span> –
описание конкретной ошибки.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">Имя</span> – имя
объекта WSDL, в котором произошла ошибка.</p>

<p class="Regularbeforetable">В нижеследующей таблице приведены ошибки, которые
могут возникнуть при проверке описания Web-сервиса, и рекомендации по их
(ошибок) исправлению:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Описание ошибки</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Рекомендации по исправлению</b></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Тип
  не найден</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Проверить
  корректность пространств имен и имен типов и элементов</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Сообщение
  не найдено</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Проверить
  корректность пространств имен и имен сообщений</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Привязка
  не найдена</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Проверить
  корректность пространств имен и имен привязок</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Тип
  порта не найден</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Проверить
  корректность пространств имен и имен типов портов</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактная
  операция не найдена</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Проверить
  корректность имени абстрактной операции</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Содержимое
  операции не найдено</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  в операции указать содержимое. Это может быть вход или выход операции</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Описание
  ошибки не найдено</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать имя описания ошибки</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактная
  операция не задана</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать абстрактную операцию</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Имя
  не задано</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать имя объекта WSDL согласно схемы: <a href="http://schemas.xmlsoap.org/wsdl/2003-02-11.xsd" target="_blank">http://schemas.xmlsoap.org/wsdl/2003-02-11.xsd</a></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Вход
  операции не соответствует входу абстрактной операции</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо,
  чтобы операция и абстрактная операция либо имели вход (обе), либо не имели
  его (обе). Нельзя, чтобы абстрактная операция имела вход, а операция нет и
  наоборот.</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Выход
  операции не соответствует выходу абстрактной операции</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Аналогично
  сообщению про вход операции</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Тип
  порта не задан</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать тип порта, проверить пространства имен</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Объект
  не уникален</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  проверить уникальность объекта по пространству имен и имени</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Расположение
  не задано</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать расположение</p>
  <p class="MsoNormalCxSpMiddle">Правило
  R2007 – для элемента
  <span class="Interface">import</span></p>
  <p class="MsoNormalCxSpMiddle">Правило
  R2711 – для элемента
  <span class="Interface">port</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Пространства
  имен отличаются</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  проверить и исправить отличия пространств имен импорта и пространства имен
  импортируемой схемы</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Тип
  части сообщения не задан</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Для
  части сообщения необходимо задать тип (тип или элемент, в зависимости от
  стиля WSDL), проверить пространства имен</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Сообщение
  не задано</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Для
  объекта WSDL необходимо указать или исправить имя сообщения, проверить его
  пространство имен</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактной
  операции требуется вход</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать вход для абстрактной операции</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактной
  операции требуется отсутствие входа</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактная
  операция не должна иметь вход</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактной
  операции требуется выход</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать выход для абстрактной операции</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактной
  операции требуется отсутствие выхода</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактная
  операция не должна иметь выход</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Ошибка
  абстрактной операции не задана</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать или проверить корректность имени абстрактной ошибки, пространства
  имен</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Привязка
  не задана</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Привязка
  порта не задана, некорректное имя привязки, некорректное пространство имен</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактное
  описание операции не задано</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Абстрактное
  описание операции не задано, некорректно указано имя или пространство имен</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Пространство
  имен операции в rpc-literal стиле должно быть задано</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать элемент <span class="Interface">namespace</span> для операции.</p>
  <p class="MsoNormalCxSpMiddle">Правило
  R2717</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Пространство
  имен операции в document-literal стиле не должно быть задано</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  удалить элемент <span class="Interface">namespace</span> для операции.</p>
  <p class="MsoNormalCxSpMiddle">Правило
  R2216</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">В
  rpc-literal стиле часть сообщения должна ссылаться на определение типа в
  схеме</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Для
  указания типа части необходимо у соответствующего объекта <span class="Interface">message</span> в частях сообщений использовать тип, а не элемент
  (тег <span class="Interface">type</span>, а не <span class="Interface">element</span>).</p>
  <p class="MsoNormalCxSpMiddle">Правило
  R2203</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">В
  document-literal стиле часть сообщения должна ссылаться на объявление
  элемента в схеме</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Для
  указания типа части необходимо у соответствующего объекта <span class="Interface">message</span> в частях сообщений использовать элемент, а не
  тип (тег <span class="Interface">element</span>, а не <span class="Interface">type</span>).</p>
  <p class="MsoNormalCxSpMiddle">Правило
  R2204</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Неизвестный
  стиль привязки</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  указать стиль привязки и проверить правильность его написания.</p>
  <p class="MsoNormalCxSpMiddle">Спецификация:
  <a href="http://www.w3.org/TR/wsdl#_bindings" target="_blank">http://www.w3.org/TR/wsdl#_bindings</a>.</p>
  <p class="MsoNormalCxSpMiddle">Правила
  R2705, R2706</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Транспорт
  в привязке должен быть задан как <a href="http://schemas.xmlsoap.org/soap/http" target="_blank">http://schemas.xmlsoap.org/soap/http</a></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  проверить, чтобы транспорт был именно <a href="http://schemas.xmlsoap.org/soap/http" target="_blank">http://schemas.xmlsoap.org/soap/http</a>.</p>
  <p class="MsoNormalCxSpMiddle"><a name="r2702">Правило R2702</a></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Часть
  сообщения не задана</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  для описания ошибку задать часть сообщения.</p>
  <p class="MsoNormalCxSpMiddle">Правило
  R2205</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">В
  схеме ошибка заголовка должна быть описана как объявление элемента</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  в части сообщения, которая используется для описания ошибки использовать тип
  заданный как элемент (использовать тег <span class="Interface">element</span>).</p>
  <p class="MsoNormalCxSpMiddle">Правило
  R2205</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">В
  схеме заголовок должен быть описан как объявление элемента</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  в части сообщения, которая используется для описания заголовка использовать
  тип заданный как элемент (использовать тег <span class="Interface">element</span>).<br>
  Правило R2205</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Схема
  должна содержать атрибут <span class="Interface">targetNamespace</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Необходимо
  для схемы добавить атрибут <span class="Interface">targetNamespace</span> и
  заполнить его. Это требование связано с особенностями реализации платформы</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Ошибка
  загрузки импортируемой схемы</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Проверить
  корректность пространств имен, расположения импортируемой схемы</p>
  </td>
 </tr>
</table>

<p class="MsoNormalCxSpLast">При указании в таблице выражения вида <span class="Interface">Правило RXXXX</span> понимается следующее – в спецификации
Basic Profile Version 1.1 (<a href="http://www.ws-i.org/profiles/basicprofile-1.1-2004-08-24.html" target="_blank">http://www.ws-i.org/profiles/basicprofile-1.1-2004-08-24.html</a>,
на английском языке) необходимо найти правило <span class="Interface">RXXXX</span>.</p>

<a id="TI000000787" class="bookmark" name="issogl3_17.1.4.2_пример_использования_статической_ws-ссылки"><h4>17.1.4.2. Пример использования статической WS-ссылки</h4></a>

<p class="MsoNormalCxSpFirst">В качестве примера использования веб-сервисов
стороннего поставщика рассмотрим обращение к Web-сервису, который ранее был
создан в примере (см. <a href="#_ref215392706">здесь</a>).</p>

<p class="MsoNormalCxSpMiddle">Прежде всего, следует добавить в дерево
конфигурации новый объект конфигурации WS-ссылка с именем <span class="Term">ДанныеРасходнойНакладной</span>,
ссылающийся на опубликованный сервис. Для этого следует выполнить импорт WSDL-описания
опубликованного сервиса и в качестве URL указать <span class="Interface">http://www.MyCompany.ru/shipment/ws/Shipment.1cws?wsdl</span>.
Описание импорта WSDL-описания см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 5. объекты конфигурации.htm?_=1496848987#_ref215392590">здесь</a>.</p>

<p class="MsoNormalCxSpLast">После этого, например, в модуле приходной накладной,
можно создать процедуру, приведенную ниже. Она заполняет табличную часть
документа данными расходной накладной поставщика, полученными с помощью
веб-сервиса поставщика.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Процедура</span> ПолучитьДанныеРасходнойНакладной<span class="operator">(</span>НомерНакладнойПоставщика<span class="operator">)</span>
    <span class="comment">// Создать WS-прокси на основании ссылки</span>
    Прокси <span class="operator">=</span> WSСсылки<span class="operator">.</span>ДанныеРасходнойНакладной<span class="operator">.</span> СоздатьWSПрокси<span class="operator">(</span><span class="string">&quot;http://www.MyCompany.ru/shipment&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладной&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладнойSoap&quot;</span><span class="operator">)</span><span class="operator">;</span>
    ДанныеНакладной <span class="operator">=</span> Прокси<span class="operator">.</span>Получить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Если</span> ДанныеНакладной <span class="operator">=</span> <span class="keyword">Неопределено</span> <span class="keyword">Тогда</span>
        <span class="keyword">Возврат</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    <span class="comment">// Заполнить приходную накладную полученными данными</span>
    <span class="keyword">Для</span> <span class="keyword">Каждого</span> СтрокаНакл <span class="keyword">Из</span> ДанныеНакладной<span class="operator">.</span>Состав <span class="keyword">Цикл</span>
        НоваяСтрока <span class="operator">=</span> ДокументОбъект<span class="operator">.</span>Состав<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
        НоваяСтрока<span class="operator">.</span>Количество <span class="operator">=</span> СтрокаНакл<span class="operator">.</span>Количество<span class="operator">;</span>
        НоваяСтрока<span class="operator">.</span>Цена <span class="operator">=</span> СтрокаНакл<span class="operator">.</span>Цена<span class="operator">;</span>
        НоваяСтрока<span class="operator">.</span>Сумма <span class="operator">=</span> СтрокаНакл<span class="operator">.</span>Сумма<span class="operator">;</span>
        <span class="comment">// Найти элемент номенклатуры по переданным данным</span>
        <span class="comment">// (например, по штрихкоду)</span>
        НоваяСтрока<span class="operator">.</span>Номенклатура <span class="operator">=</span> Справочники<span class="operator">.</span>Номенклатура<span class="operator">.</span> НайтиПоРеквизиту<span class="operator">(</span><span class="string">&quot;ШтрихКод&quot;</span><span class="operator">,</span> СтрокаНакл<span class="operator">.</span>Номенклатура<span class="operator">.</span>ШтрихКод<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">КонецЦикла</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="MsoNormal">Если адрес реального расположения сервиса отличается от
адреса, который использовался во время загрузки описания веб-сервиса в
конфигурацию, то новый адрес необходимо явно указать при создании объекта <span class="Term">WSПрокси</span>:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// Создать WS-прокси на основании ссылки</span>
Прокси <span class="operator">=</span> WSСсылки<span class="operator">.</span>ДанныеРасходнойНакладной<span class="operator">.</span> СоздатьWSПрокси<span class="operator">(</span><span class="string">&quot;http://www.MyCompany.ru/shipment&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладной&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладнойSoap&quot;</span><span class="operator">,</span> <span class="operator">,</span> <span class="operator">,</span> <span class="operator">,</span> <span class="string">&quot;http://www.realURL/realPath&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<a id="TI000000788" class="bookmark" name="issogl3_17.1.4.3_пример_использования_динамической_ws-ссылки"><h4>17.1.4.3. Пример использования динамической WS-ссылки</h4></a>

<p class="MsoNormalCxSpFirst">Использование динамической ссылки отличается от
использования статической ссылки только способом создания WS-прокси и отсутствием
необходимости создавать WS-ссылку в дереве конфигурации.</p>

<p class="MsoNormalCxSpLast">Если провести сравнение с примером, представленным в
предыдущем разделе, то, в отличие от создания прокси на основе статической
ссылки, при использовании динамической ссылки WS-прокси создается с помощью
конструктора следующим образом:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// Создать WS-прокси на основании WS-определения</span>
Определение <span class="operator">=</span> <span class="keyword">Новый</span> WSОпределения<span class="operator">(</span><span class="string">&quot;http://www.MyCompany.ru/shipment/ws/Shipment.1cws?wsdl&quot;</span><span class="operator">)</span><span class="operator">;</span>
Прокси <span class="operator">=</span> <span class="keyword">Новый</span> WSПрокси<span class="operator">(</span>Определение<span class="operator">,</span> <span class="string">&quot;http://www.MyCompany.ru/shipment&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладной&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладнойSoap&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="MsoNormal">В то время как создание WS-прокси на основе статической ссылки
выглядит следующим образом:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// Создать WS-прокси на основании ссылки</span>
Прокси <span class="operator">=</span> WSСсылки<span class="operator">.</span>ДанныеРасходнойНакладной<span class="operator">.</span> СоздатьWSПрокси<span class="operator">(</span><span class="string">&quot;http://www.MyCompany.ru/shipment&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладной&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладнойSoap&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="MsoNormal">Если адрес реального расположения сервиса отличается от
адреса, который указан в WSDL-файле, используемом при создании определения
веб-сервисов, новый адрес необходимо явно указать при создании объекта <span class="Term">WSПрокси</span>
на основании определения веб-сервисов:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// Создать WS-прокси на основании WS-определения</span>
Определение <span class="operator">=</span> <span class="keyword">Новый</span> WSОпределения<span class="operator">(</span><span class="string">&quot;http://www.MyCompany.ru/shipment/ws/Shipment.1cws?wsdl&quot;</span><span class="operator">)</span><span class="operator">;</span>
Прокси <span class="operator">=</span> <span class="keyword">Новый</span> WSПрокси<span class="operator">(</span>Определение<span class="operator">,</span> <span class="string">&quot;http://www.MyCompany.ru/shipment&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладной&quot;</span><span class="operator">,</span> <span class="string">&quot;ДанныеРасходнойНакладнойSoap&quot;</span><span class="operator">,</span> <span class="operator">,</span> <span class="operator">,</span> <span class="operator">,</span> <span class="string">&quot;http://www.realURL/realPath&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<a id="TI000000789" class="bookmark" name="issogl2_17.1.5_редактирование_свойств_web-сервиса"><h3>17.1.5. Редактирование свойств Web-сервиса</h3></a>

<p class="MsoNormalCxSpFirst">На закладке <span class="Interface">Основные</span>
вводится имя, синоним и комментарий объекта.</p>

<p class="MsoNormalCxSpLast">На закладке <span class="Interface">Операции</span>
создаются подчиненные объекты <span class="Interface">Операции</span>, которые, в
свою очередь, могут иметь подчиненные объекты <span class="Interface">Параметры</span>,
необходимые для работы с объектами данного типа. Описание подчиненных объектов
выполняется в палитре свойств.</p>

<a name="_ref427592126"></a><a id="TI000000790" class="bookmark" name="issogl3_17.1.5.1_свойства_операции"><h4>17.1.5.1. Свойства «Операции»</h4></a>

<p class="MsoNormal">Помимо общих свойств объектов конфигурации операция Web-сервиса содержит
следующие свойства:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">Тип возвращаемого значения</span> –
тип значения, которое возвращает операция Web-сервиса. Может являться типом значения XDTO или типом объекта
XDTO.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">Возможно пустое значение</span> –
показывает, может ли возвращаемое значение принимать неопределенное значение.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">В транзакции</span> –
показывает, будет ли выполняться код модуля Web-сервиса в транзакции или нет. Если свойство установлено, то
при вызове Web-сервиса
автоматически будет начата транзакция, а при завершении работы Web-сервиса транзакция
будет либо зафиксирована, либо произойдет откат транзакции (в зависимости от
результатов выполнения). Если свойство не установлено, при начале исполнения
модуля Web-сервиса
транзакция не будет начата.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">Имя метода</span> – имя
экспортируемой процедуры модуля Web-сервиса,
которая будет выполнена при вызове данного свойства.</p>

<p class="MsoNormalCxSpFirst">На закладке <span class="Interface">Подсистемы</span>
указывается, к каким подсистемам относятся объекты данного типа.</p>

<p class="MsoNormalCxSpLast">На закладке <span class="Interface">Прочее</span> определяются
следующие свойства:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">URI пространства имен</span> –
содержит URI пространства имен Web-сервиса. Каждый Web-сервис может быть однозначно
идентифицирован по своему имени и URI пространству имен, которому он принадлежит.
Пространство имен сервиса не должна совпадать с известными пространствами имен,
которые уже используются или зарезервированы другими организациями.
Рекомендуется в пространство имен сервиса включать фрагмент, уникальный для
организации, которая ведет разработку Web-сервиса. Например, для организации с
названием <span class="Interface">Промресурс</span> имеет смысл начинать все
пространства имен с префикса, например, <span class="Interface">http://promresurs.com</span>.
Тогда URI пространства имен Web-сервиса будет иметь вид <span class="Interface">http://promresurs.com/public/services/OurService</span>.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">Пакеты XDTO</span> –
перечень пакетов XDTO, типы которых могут использоваться в качестве типов возвращаемого
значения операций и типов параметров операций Web-сервиса.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">Имя файла публикации</span> –
имя файла описания Web-сервиса, который расположен на веб-сервере.</p>

<p class="MsoNormal">По кнопке <span class="Interface">Модуль</span> открывается
редактор модуля Web-сервиса.</p>

<a id="TI000000791" class="bookmark" name="issogl3_17.1.5.2_свойства_параметр"><h4>17.1.5.2. Свойства «Параметр»</h4></a>

<p class="MsoNormal">Помимо общих свойств объектов конфигурации параметр операции
Web-сервиса содержит
следующие свойства:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">Тип значения</span> –
тип значения параметра операции Web-сервиса.
Может являться типом значения XDTO или типом объекта XDTO.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">Возможно пустое значение</span> –
показывает, может ли значение параметра операции принимать неопределенное значение.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">Направление передачи</span> –
определяет направление передачи данных с помощью данного параметра. Возможные
значения:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
<span class="Interface">Входной</span> – означает,
что параметр используется для передачи данных Web-сервису;</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
<span class="Interface">Выходной</span> – означает,
что параметр используется для получения данных от Web-сервиса;</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
<span class="Interface">Входной-Выходной</span> –
означает, что параметр может использоваться как для передачи данных, так и для
их получения от Web-сервиса.</p>

<a name="_ref380405417"></a><a id="TI000001357" class="bookmark" name="issogl1_17.2_http-сервисы"><h2>17.2. HTTP-сервисы</h2></a>

<a name="_ref380071959"></a><a id="TI000001358" class="bookmark" name="issogl2_17.2.1_cтандартный_интерфейс_odata"><h3>17.2.1. Cтандартный интерфейс OData</h3></a>

<a name="_ref397345054"></a><a id="TI000001359" class="bookmark" name="issogl3_17.2.1.1_общая_информация"><h4>17.2.1.1. Общая информация</h4></a>

<p class="MsoNormalCxSpFirst">Стандартный интерфейс OData в «1С:Предприятии»
предназначен для получения доступа к данным системы из внешнего приложения без
модификации кода прикладного решения (например, если прикладное решение стоит
на поддержке). Для получения такого доступа необходимо особым образом
опубликовать приложение на веб-сервере и указать, какие объекты конфигурации
будут использоваться таким образом (см. <a href="#_ref379996228">здесь</a>).</p>

<p class="MsoNormalCxSpMiddle">Для доступа к данным используется протокол OData (<a href="http://www.odata.org/" target="_blank">http://www.odata.org/</a>, на английском языке) версии 3 (<a href="http://www.odata.org/documentation/odata-version-3-0/odata-version-3-0-core-protocol" target="_blank">http://www.odata.org/documentation/odata-version-3-0/odata-version-3-0-core-protocol</a>, на английском языке). Поддерживаются
следующие форматы представления данных: <span class="Bold">atom-xml</span> и <span class="Bold">json</span>. Для доступа к данным, при публикации, автоматически
генерируется стандартный интерфейс OData, который позволяет читать данные «1С:Предприятия»,
изменять их, создавать новые объекты данных и удалять существующие. Прикладное
решение на базе «1С:Предприятия» может выступать как клиентом, так и сервером
при работе со стандартным интерфейсом OData. Для работы сервером практически
никаких дополнительных действий осуществлять не надо (эта возможность
предоставляется автоматически). Для того, чтобы стать клиентом стандартного
интерфейса OData, необходимо в прикладном решении реализовать программный слой,
который будет использовать данные сервера с использованием стандартных
интерфейсов «1С:Предприятия», например объекта <span class="Term">HTTPСоединение</span>.</p>

<p class="MsoNormalCxSpMiddle">В одной системе могут одновременно существовать и
SOAP-сервисы (которые реализуются в «1С:Предприятие» в виде Web-сервисов,
см. <a href="#_ref380403400">здесь</a>) и стандартный интерфейс OData и HTTP-сервис
(см. <a href="#_ref380409689">здесь</a>).</p>

<p class="MsoNormalCxSpLast">Стандартный интерфейс OData
можно использовать для следующих задач:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Интеграция прикладного решения с различными
сайтами (например, на базе Microsoft SharePoint);</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Реализация сторонними средствами дополнительной
функциональности прикладного решения без изменения его конфигурации;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Загрузка данных в прикладное решение и выгрузка
данных из него;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Интеграция прикладного решения с корпоративными
системами, возможно даже без дополнительного программирования.</p>

<p class="MsoNormal">Типичные операции, выполняемые с помощью стандартного
интерфейса OData:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Получение списка объектов системы с
установленным отбором;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Получение данных конкретного объекта системы;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Создание нового и запись изменений существующего
объекта системы;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Проведение одного документа, старт
бизнес-процесса.</p>

<a name="_ref392761747"></a><a id="TI000001360" class="bookmark" name="issogl3_17.2.1.2_общие_принципы_работы"><h4>17.2.1.2. Общие принципы работы</h4></a>

<p class="MsoNormal">При работе с протоколом OData используется специальная
терминология. При применении протокола используются следующие термины:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Bold">Сущность</span> – нечто,
обладающее идентичностью. Сущность также обладает набором свойств. Некоторые
свойства описывают ее идентичность, комбинация которых определяет ключ
сущности. По этому ключу можно получить конкретную сущность.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Bold">Набор сущностей</span> –
коллекция сущностей определенного типа.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Bold">Составной тип</span> –
набор свойств, не обладающий идентичностью.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Bold">Функция</span> – набор
некоторых операций, выполняемых на стороне сервера, возвращающий данные (не
обязательно сущность или набор сущностей) и не приводящий к наблюдаемым
побочным эффектам (изменениям данных). Функция обязательно связана с сущностью
или набором сущностей.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Bold">Действие</span> – функция,
которая может изменять данные.</p>

<p class="MsoNormal">Термины протокола некоторым образом соответствуют терминам,
принятым в системе «1С:Предприятие»:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Bold">Сущность</span> – в
качестве сущности может выступать один из 4 групп объектов системы
«1С:Предприятие»: объектные типы, наборы записей регистров, записи регистров и
строки табличных частей объектных типов. Записи регистров и строки табличных
объектных типов (как отдельные сущности) доступны только на чтение.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Реквизиты объектов «1С:Предприятия»
представляются как <span class="Bold">свойства</span> сущностей. В некоторых
случаях (например, реквизит объекта конфигурации составного типа) реквизит
может быть представлен несколькими свойствами, одно из которых будет <span class="Bold">навигационным</span>. Такое свойство содержит в качестве значения
ссылку (URL) на сущность, описывающую объект «1С:Предприятия». Свойство,
описывающее тип такого реквизита, называется <span class="Bold">диспетчеризационным</span>.
Название такого свойства завершается суффиксом <span class="Interface">_Type</span>.
Более подробное описание диспетчеризационного свойства приведено далее.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Если реквизит объекта имеет ссылочный тип, то
объект, на который ссылается такой реквизит, будет называться <span class="Bold">связанной
сущностью</span>.</p>

<p class="MsoNormal">Обращение к стандартному интерфейсу OData выполняется с
помощью HTTP-запроса, выполнено по определенному URL. URL формируется
специальным образом и состоит из следующих частей:</p>

<p class="MsoListNumberCxSpFirst">1. 
Адрес информационной базы;</p>

<p class="MsoListNumberCxSpMiddle">2.  Признак
обращения к стандартному интерфейсу OData;</p>

<p class="MsoListNumberCxSpMiddle">3.  Имя
ресурса, к которому выполняется обращение;</p>

<p class="MsoListNumberCxSpLast">4.  Параметры
запроса обращения к ресурсу.</p>

<p class="MsoNormalCxSpFirst">Само обращение выполняется с помощью HTTP-запроса
определенного вида. При более подробном описании работы со стандартным
интерфейсом OData вид запроса будет указываться отдельно.</p>

<p class="MsoNormalCxSpLast">Рассмотрим части URL более подробно.</p>

<p class="Lang-parameter">Адрес информационной базы</p>

<p class="MsoNormal">Это обычный URL, по которому
выполняется доступ, например, к информационной базе с помощью веб-клиента.
Например, <a href="http://host" target="_blank">http://host</a><span class="Interface">/base</span> или <a href="http://host.server.zone/data-base" target="_blank">http://host.server.zone/data-base</a>. Также необходимо помнить, что при
использовании информационной базы, в которой настроено разделение, допустимо
использовать только один способ указания значений разделителей, а именно:
значения разделители можно указывать только в URL информационной базы. Указание
разделителей с помощью параметра <span class="Interface">Z</span> не поддерживается. Более подробную информация про
настройку указания значений разделителей в URL информационной базы можно
получить в описании файла <span class="Interface">default.vrd</span> <a href="/db/v8310doc/bookmark/adm/TI000000385" target="_top">в книге 1С:Предприятие 8.3. &quot;Руководство администратора&quot;</a>.</p>

<p class="Lang-parameter">Признак обращения к стандартному интерфейсу OData</p>

<p class="MsoNormal">В качестве такого признака выступает последовательность <span class="Interface">/odata/standard.odata</span>.</p>

<p class="Lang-parameter">Имя ресурса, к которому выполняется обращение</p>

<p class="MsoNormal">Особым образом сформированный идентификатор ресурса
(возможно, с параметром) или предопределенные ресурсы. Например, <span class="Interface">$metadata</span>, <span class="Interface">Catalog_Контрагент(guid'value')</span>.</p>

<p class="Lang-parameter">Параметры обращения к ресурсу</p>

<p class="MsoNormalCxSpFirst">В качестве параметров обращения выступают параметры
в виде, принятом для HTTP-запросов: <span class="Interface">?ключ=значение&amp;ключ2=значение2</span>.</p>

<p class="MsoNormalCxSpMiddle"> </p>

<p class="MsoNormalCxSpLast">При обращении к ресурсу могут использоваться
специальные ключевые слова, имеющие специальное назначение:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">$format</span> – указывает,
в каком формате необходимо получить данные. Если ключевое слово не указано,
данные получаются в формате atom-xml.</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
<span class="Interface">$format=atom</span> –
возвращает данные в формате <span class="Bold">atom-xml</span>.</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
<span class="Interface">$format=json</span> –
возвращает данные в формате <span class="Bold">json</span>. Для указания того,
что данные должны возвращаться в формате <span class="Bold">json</span>, можно
указать MIME-тип application/json в заголовке <span class="Interface">Accept</span>
HTTP-запроса на получение данных.</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">$metadata</span> – указывает,
что требуется получить описание стандартного интерфейса OData. Подробнее
см. <a href="#_ref397094488">здесь</a>.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">$filter</span> – описывает
отбор, применяемый при получении данных. Подробнее см. <a href="#_ref397094606">здесь</a>.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">$select</span> – описывает
перечень свойств сущности, которые получаются при обращении к стандартному
интерфейсу OData. Подробнее см. <a href="#_ref397340175">здесь</a>.</p>

<p class="MsoNormalCxSpFirst"> </p>

<p class="MsoNormalCxSpLast">После того, как сформирован URL необходимого
ресурса, следует выполнить HTTP-запрос нужного вида. В зависимости от того,
какая операция выполняется, используется соответствующий HTTP-метод:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Получение данных – метод <span class="Term">GET</span>;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Создание объекта – метод <span class="Term">POST</span>;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Обновление данных:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
метод <span class="Term">PATCH</span> – в этом случае можно указывать
только те свойств, которые необходимо обновить;</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
метод <span class="Term">PUT</span> – в этом случае необходимо указывать
все свойства сущности;</p>

<p class="MsoListBullet">&#9679; 
Удаление данных – метод <span class="Term">DELETE</span>.</p>

<p class="MsoNormalCxSpFirst">В результате выполнения запроса клиентское
приложение получает ответ сервера, который кроме кода состояния может содержать
различные данные, предоставленные сервером, в виде XML-документа.</p>

<p class="MsoNormalCxSpLast">В примерах URL, которые используются в данном
разделе, выражение <span class="Interface">guid'value'</span> означает выражение
OData, которое описывает конкретное значение GUID (тип <span class="Term">Edm.Guid</span>).</p>

<a name="_ref392761762"></a><a id="TI000001361" class="bookmark" name="issogl3_17.2.1.3_представление_данных"><h4>17.2.1.3. Представление данных</h4></a>

<p class="RegularbeforetableCxSpFirst">Данные, возвращаемые стандартным
интерфейсом OData, могут быть представлены в виде XML-документа или
JSON-документа. Это зависит от того, в каком формате запрашиваются данные.</p>

<p class="RegularbeforetableCxSpLast">Для различных типов данных используется
следующее соответствие между типом «1С:Предприятия» и типом OData:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Тип «1С:Предприятия»</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Тип свойства OData</b></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Строка</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Edm.String</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Дата</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Edm.DateTime</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Число</span>
  (целое)</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Edm.Int16, <span class="Term">Edm.Int32</span>, <span class="Term">Edm.Int64</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Число</span>
  (дробное)</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Edm.Double</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Булево</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Edm.Boolean</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Ссылка</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Edm.Guid</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Перечисление</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">Edm.String</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Term">ХранилищеЗначения</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpLast">Состоит
  из трех свойств<span class="Bold">*</span>:</p>
  <p class="MsoListNumberCxSpFirst">1.  Навигационное
  свойство;</p>
  <p class="MsoListNumberCxSpMiddle">2. 
  &lt;Имя свойства&gt;<span class="Interface">_Base64Data</span>;</p>
  <p class="MsoListNumberCxSpLast">3.  <span class="Interface">&lt;Имя свойства&gt;_Type</span>.</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Ссылочный
  тип</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpLast">Два
  свойства:</p>
  <p class="MsoListBulletCxSpFirst">&#9679; 
  Собственно значение ссылки на объект типа <span class="Term">Edm.Guid</span>;</p>
  <p class="MsoListBulletCxSpLast">&#9679; 
  Навигационное свойство. </p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Составные
  типы</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpLast">Два
  свойства типа <span class="Term">Edm.String</span>:</p>
  <p class="MsoListBulletCxSpFirst">&#9679; 
  Значение фактического типа, выраженное в виде
  строки;</p>
  <p class="MsoListBulletCxSpLast">&#9679; 
  Имя фактического типа.</p>
  </td>
 </tr>
</table>

<p class="MsoNormalCxSpLast">В таблице символ <span class="Bold">*</span> означает,
что:</p>

<p class="MsoListBullet">&#9679; 
С помощью навигационного свойства можно получить
данные, хранящиеся в реквизите:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
Для типа <span class="Term">Картинка</span> –
будет получена собственно картинка с соответствующим значением HTTP-заголовка content-type;</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
Для типа <span class="Term">ДвоичныеДанные</span> –
будет получен байтовый поток;</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
Для остальных типов – XDTO-сериализованное
значение хранимых данных.</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Свойство <span class="Interface">&lt;Имя
свойства&gt;_Base64Data</span> хранит данные, которые могут быть получены с
помощью навигационного свойства, только закодированные в Base64. Редактировать
данные реквизита типа <span class="Term">ХранилищеЗначения</span>
можно только с помощью этого свойства.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Свойство <span class="Interface">&lt;Имя
свойства&gt;_Type</span> описывает тип данных, хранимых в реквизите. Может
принимать одно и трех значений:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
application/octet-stream –
двоичные данные;</p>

<p class="MsoListBullet2CxSpMiddle">&#9679; 
application/xml+xdto – XDTO-сериализованный
объект;</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
значение HTTP-заголовка content-type, соответствующего картинке,
хранящейся в реквизите, например, image/jpeg для картинки формата JPEG.</p>

<p class="MsoNormalCxSpFirst">Остальные типы не поддерживаются, и при попытке их
чтения будет сгенерирована ошибка c кодом 501.</p>

<p class="MsoNormalCxSpLast">Имена свойств могут оканчиваться на различные
суффиксы. Такие свойства имеют специальный смысл. Далее будут более подробно
рассмотрены возможные суффиксы:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">Key</span>;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">Type</span>;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">Base64Data</span>;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">____Presentation</span>.</p>

<p class="Lang-parameter">Key</p>

<p class="MsoNormal">Свойство с таким суффиксом содержит значение ключа
соответствующего ссылочного реквизита объекта (без такого суффикса) или
независимого регистра сведений без измерений. Имя с таким суффиксом
используется для установки отбора в качестве имени реквизита, по которому
выполняется отбор. Например, для установки отбора по ссылочному полю <span class="Term">Контрагент</span>,
условие будет выглядеть следующим образом: <span class="Interface">Контрагент_Key=guid'value'</span>.
При этом свойство <span class="Interface">Контрагент</span> будет содержать
представление контрагента с указанным значением ссылки.</p>

<p class="Lang-parameter">Type</p>

<p class="MsoNormal">Данный суффикс используется для описания реквизита
составного типа. Так, если в данных есть поле составного типа <span class="Term">Контрагент</span>, то в документе, который возвращает стандартный интерфейс
OData, этому полю будет соответствовать два свойства:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">Контрагент_Type</span> –
будет содержать описание типа значения реквизита в виде строки (тип <span class="Term">Edm.String</span>,
диспетчеризационное свойство);</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">Контрагент</span> –
будет содержать значение реквизита (соответствующего типа).</p>

<p class="MsoNormalCxSpFirst">Перечень допустимых типов, которые могут быть
использованы в поле с таким суффиксом, определяется схемой сервиса, который
можно получить при запросе полного описания стандартного интерфейса OData
(см. <a href="#_ref379542964">здесь</a>). Таким образом, при необходимости установить тип <span class="Term">Документ.РасходТовара</span>,
в элемент с суффиксом <span class="Interface">_Type</span> должно быть записано
значение <span class="Interface">StandardODATA.Document_РасходТовара</span>.</p>

<p class="MsoNormalCxSpLast">Если значение реквизита составного типа в
информационной базе «1С:Предприятия» имеет значение <span class="Term">Неопределено</span>, то
диспетчеризационное свойство будет иметь значение <span class="Interface">StandardODATA.Undefined</span>,
а само значение свойства должно игнорироваться.</p>

<p class="Lang-subheader">Пример представления реквизита
составного типа:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
&lt;d:РеквизитСоставной/&gt;
&lt;d:РеквизитСоставной_Type&gt;StandardODATA.Undefined&lt;/d:РеквизитСоставной_Type&gt;
</pre>

<p class="Lang-parameter">Base64Data</p>

<p class="MsoNormal">Данный суффикс используется при указании имени свойства,
содержащего данные, расположенные в реквизите типа ХранилищеЗначения,
в виде строки <span class="Term">Base64</span>.
Так, если в объекте конфигурации есть реквизит <span class="Term">Файл</span>, который
имеет тип <span class="Term">ХранилищеЗначения</span>,
то в документе, который возвращает стандартный интерфейс OData, этому полю
будет соответствовать два свойства:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">Файл_Type</span> –
содержит наименование типа данных, хранимых реквизитом;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">Файл_Base64Data</span> –
содержит строку <span class="Term">Base64</span>,
содержащую сами данные.</p>

<p class="Lang-parameter">____Presentation</p>

<p class="MsoNormalCxSpFirst">Свойство <span class="Interface">&lt;Имя
свойства&gt;____Presentation</span> содержит представление реквизита (между именем свойства и <span class="Interface">Presentation</span> находятся 4 символа «<span class="Interface">_</span>»). Значение поля эквивалентно значению,
которое является результатом работы функции языка запросов <span class="Term">Представление()</span>.</p>

<p class="MsoNormalCxSpMiddle">Поля
представлений не включаются в результаты запроса с пустым параметром <span class="Interface">$select</span> и при указании в параметре <span class="Interface">$select</span> значений <span class="Interface">*</span> и <span class="Interface">**</span>. Таким образом, если необходимо получить
все реквизиты объекта и представления некоторых реквизитов, необходимо указать
значение <span class="Interface">*</span>, а затем отдельно перечислить поля
представлений требуемых реквизитов, разделяя их запятыми: <span class="Interface">$select=*,
РеквизитСсылка____Presentation</span>.</p>

<p class="MsoNormalCxSpMiddle">Для
получения представлений всех реквизитов объекта, следует в параметре <span class="Interface">$select</span> указать значение <span class="Interface">*____Presentation:</span> <span class="Interface">$select=*____Presentation</span>.</p>

<p class="MsoNormalCxSpMiddle">Для
получения значений всех полей и представлений для всех полей, следует
использовать следующее выражение: <span class="Interface">$select=*, *____Presentation</span>.</p>

<p class="MsoNormalCxSpMiddle">Для
получения представления текущей сущности имеется возможность указывать в списке
запрашиваемых полей поле <span class="Interface">Presentation</span>: <span class="Interface">$select=Ref_Key,
Presentation</span>. В этом
случае будет получено значение ссылки и представление этой ссылки.</p>

<p class="MsoNormalCxSpLast">Поля
представлений не содержатся в описании метаданных, которое возвращается в
описании стандартного интерфейса OData (параметр <span class="Interface">$metadata</span>). Получение представления не поддерживается
для табличных частей и реквизитов типа <span class="Term">ХранилищеЗначения</span>. Не поддерживается модификация значений для
полей представлений.</p>

<a name="_ref379553184"></a><a name="_ref400100384"></a><a id="TI000001362" class="bookmark" name="issogl3_17.2.1.4_правила_формирования_имени_ресурса"><h4>17.2.1.4. Правила формирования имени ресурса</h4></a>

<p class="Regularbeforetable">При обращении к какому-либо ресурсу, его
идентификатор формируется по следующему принципу: <span class="Interface">ПрефиксИмени_ИмяОбъектаКонфигурации_СуффиксИмени</span>.
С помощью стандартного интерфейса OData можно получить доступ к следующим объектам (<span class="Interface">ПрефиксИмени</span>):</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Объект конфигурации</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Префикс имени для указания в URL</b></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Справочник</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Catalog</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Документ</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Document</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Журнал
  документов</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">DocumentJournal</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Константа</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Constant</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">План
  обмена</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">ExchangePlan</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">План
  счетов</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">ChartOfAccounts</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">План
  видов расчета</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">ChartOf<span class="Interface">CalculationTypes</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">План
  видов характеристик</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">ChartOfCharacteristicTypes</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Регистр
  сведений</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">InformationRegister</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Регистр
  накопления</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">AccumulationRegister</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Регистр
  расчета</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">CalculationRegister</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Регистр
  бухгалтерии</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">AccountingRegister</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Бизнес-процесс</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">BusinessProcess</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Задача</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Task</span></p>
  </td>
 </tr>
</table>

<p class="MsoNormalCxSpMiddle"><span class="Interface">ИмяОбъектаКонфигурации</span> –
свойство <span class="Interface">Имя</span> объекта конфигурации, как оно задано
при разработке прикладного решения в конфигураторе.</p>

<p class="MsoNormalCxSpLast"><span class="Interface">СуффиксИмени</span> –
предназначено для уточнения имени ресурса и является необязательной частью
имени. В качестве суффикса имени могут выступать следующие выражения:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Имя табличной части объекта;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Имя реквизита табличной части или набора
записей;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Имя виртуальной таблицы регистра;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">RowType</span>;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">RecordType</span>.</p>

<p class="MsoNormal">Далее будут более подробно рассмотрены вышеописанные
уточнения имени ресурса:</p>

<p class="Lang-parameter">Имя табличной части объекта</p>

<p class="MsoNormal">Если объект обладает табличной частью, то для получения
доступа ко всем записям этой табличной части необходимо добавить имя табличной
части после имени самого объекта, например, для получения всех строк табличных
частей <span class="Term">Товары</span>
всех документов <span class="Term">РасходТовара</span>
будет необходимо выполнить GET-запрос по следующему адресу: http://
host/base/odata/standard.odata/Document_РасходТовара_Товары.</p>

<p class="Lang-parameter">Имя реквизита табличной части или набора записей</p>

<p class="MsoNormal">Если объект обладает табличной частью, то имеется
возможность указать, что требуется получение не всех реквизитов табличной
части, а некоторого списка этих реквизитов. Для этого необходимо указать в
параметре <span class="Interface">$select</span> список требуемых реквизитов в
следующем виде: <span class="Interface">&lt;Имя табличной части&gt;/&lt;Имя
поля&gt;</span>. Аналогичная возможность предоставляется для наборов записей регистров,
где в качестве имени табличной части выступает <span class="Interface">RecordSet</span>:
<span class="Interface">RecordSet/&lt;Имя поля&gt;</span>.</p>

<p class="Lang-parameter">Имя виртуальной таблицы регистра</p>

<p class="MsoNormal">В роли виртуальной таблицы регистра выступает функция,
связанная с ресурсом, возвращающей набор сущностей регистра. Имя функции
совпадает с английским вариантом имени используемой виртуальной таблицы языка
запросов. Параметры функции соответствуют параметрам виртуальной таблицы. Так,
для получения среза последних регистра сведений <span class="Term">КурсыВалют</span>,
следует выполнить GET-запрос по следующему адресу: <span class="Interface">http://localhost/demo/odata/standard.odata/InformationRegister_КурсыВалют/SliceLast()</span>.</p>

<p class="Lang-parameter">RowType</p>

<p class="MsoNormal">Сущность с таким суффиксом описывает
тип строки табличной части какого-либо объекта.</p>

<p class="Lang-parameter">RecordType</p>

<p class="MsoNormal">Сущность с таким суффиксом описывает отдельную запись
регистра.</p>

<a name="_ref379554692"></a><a name="_ref397094606"></a><a id="TI000001363" class="bookmark" name="issogl3_17.2.1.5_правила_формирования_условия_отбора"><h4>17.2.1.5. Правила формирования условия отбора</h4></a>

<a id="TI000001770" class="bookmark" name="issogl4_17.2.1.5.1_общая_информция"><h5>17.2.1.5.1. Общая информция</h5></a>

<p class="MsoNormalCxSpFirst">В данном разделе приводится информация по различным
способам формирования отбора получаемых данных, используемых в стандартном
интерфейсе OData системы «1С:Предприятие».</p>

<p class="MsoNormalCxSpLast">Описание возможностей отбора в протоколе OData можно
получить в документации по протоколу (на английском языке):</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<a href="http://www.odata.org/documentation/odata-v3-documentation/odata-core/#10231_The_filter_System_Query_Option" target="_blank">http://www.odata.org/documentation/odata-v3-documentation/odata-core/#10231_The_filter_System_Query_Option</a>;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">http://www.odata.org/documentation/odata-v3-documentation/url-conventions/#512_Filter_System_Query_Option</span>.</p>

<a id="TI000001757" class="bookmark" name="issogl4_17.2.1.5.2__filter"><h5>17.2.1.5.2. $filter</h5></a>

<p class="MsoNormal">При получении данных можно фильтровать данные. Для этого
предназначен специальный язык, который позволяет описывать условия, каким
должны соответствовать данные, которые возвращает стандартный интерфейс OData.
Описание отбора начинается с ключевого слова <span class="Interface">$filter</span>,
после которого следует собственно условие. Поддерживаются следующие операции:</p>

<p class="MsoListBullet">&#9679; 
Логические операции:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Описание</b></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Имя</b></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Пример</b></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Равно</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">eq</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Города</span><span class="Interface">?$filter=</span><span class="Interface">Description
  eq 'Главный</span><span class="Interface">'</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Не равно</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">ne</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Города</span><span class="Interface">?$filter=Description ne 'Пермь</span><span class="Interface">'</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Больше</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">gt</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">/Catalog_Товары?$filter=<span class="Interface">Цена </span><span class="Interface">gt 10</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Больше или равно</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">ge</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=Цена
  ge 10</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Меньше</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">lt</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=Цена
  lt 10</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Меньше или равно</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">le</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=Цена
  le 10</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Логическое ИЛИ</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">or</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">/Catalog_Товары<span class="Interface">?$filter=Цена</span><span class="Interface"> lt 10 or Цена</span><span class="Interface"> gt 100</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Логическое И</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">and</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/</span><span class="Interface">Catalog_Товары?$</span><span class="Interface">filter=Цена g</span><span class="Interface">t 10 </span><span class="Interface">and Цена l</span><span class="Interface">t 100</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Отрицание</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">not</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары</span><span class="Interface">?$filter=not (Цена</span><span class="Interface"> eq 10)</span></p>
  </td>
  
 </tr>
</table>

<p class="MsoListBullet">&#9679; 
Арифметические операции:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Описание</b></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Имя</b></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Пример</b></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Сложение</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">add</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=Цена
  add 5 gt 10</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Вычитание</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">sub</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=Цена
  sub 5 gt 10</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Умножение</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">mul</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары</span><span class="Interface">?$filter=Цена</span><span class="Interface"> mul 5 gt 1000</span></p>
  </td>
  
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Деление</p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">div</span></p>
  </td>
  
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=Цена
  div 4 gt 2</span></p>
  </td>
  
 </tr>
</table>

<p class="MsoListBullet">&#9679; 
Группирующие операторы:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Описание</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Имя</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Пример</b></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Приоритет
  операции</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">()</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=(Цена add 5) gt 10</span></p>
  </td>
 </tr>
</table>

<p class="Lang-subheader">Пример отбора:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/odata/standard.odata/Catalog_Товары?$filter=Имя eq 'Молоко' and Цена lt 2500</pre>

<p class="MsoNormalCxSpFirst">При формировании условия отбора следует учитывать
приоритет операций. В следующей таблице представлен список операций языка
выражений отбора в порядке уменьшения приоритета. Операции с одинаковым
приоритетом вычисляются слева направо:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Оператор</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Описание</b></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">( )</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Повышение
  приоритета операции</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Навигация</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">-</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Арифметическое
  отрицание</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Not</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Логическое
  отрицание</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Mul</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Умножение</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Div</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Деление</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Add</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Сложение</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Sub</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Вычитание</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Gt</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Больше</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Ge</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Больше
  или равно</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Lt</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Меньше</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Le</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Меньше
  или равно</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Eq</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Равно</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Ne</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Не
  равно</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">And</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Логическое
  «И»</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">Or</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Логическое
  «ИЛИ»</p>
  </td>
 </tr>
</table>

<p class="MsoNormalCxSpLast">При формировании условий запроса (параметр <span class="Interface">filter</span>) или формировании реквизита, по которому
выполняется упорядочивание (параметр <span class="Interface">orderby</span>)
могут применяться следующие функции:</p>

<p class="MsoListBullet">&#9679; 
Строковые функции:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Функция</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Описание</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Пример</b></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">substringof(Str1, Str2)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  <span class="Interface">true</span> в том случае, если <span class="Interface">Str1</span>
  является подстрокой <span class="Interface">Str2</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=substringof('Красный Октябрь',
  Производитель) eq true</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">endswith(Str1, Str2)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  <span class="Interface">true</span> в том случае, если <span class="Interface">Str1</span>
  заканчивается на <span class="Interface">Str2</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=endswith(Производитель, 'ООО') eq
  true</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">startswith(Str1, Str2)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  <span class="Interface">true</span> в том случае, если <span class="Interface">Str1</span>
  начинается на <span class="Interface">Str2</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=startswith(Производитель, 'ООО') eq
  true</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">substring(Str,
  Int1)</span></p>
  <p class="MsoNormalCxSpMiddle"><span class="Interface">substring(Str,
  Int1, Int2)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  подстроку из <span class="Interface">Str1</span>. В варианте с двумя параметрами
  возвращается строка с позиции <span class="Interface">Int</span> и до конца
  строки.</p>
  <p class="MsoNormalCxSpMiddle">В
  варианте с тремя параметрами возвращается подстрока, начиная с позиции <span class="Interface">Int1</span> и длиной <span class="Interface">Int2</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Поставщики</span><span class="Interface">?$filter=substring(ИНН</span><span class="Interface">, 1, 2) eq
  '77'</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">concat(Str1, Str2)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  строку, являющуюся результатом конкатенации <span class="Interface">Str1</span>
  и <span class="Interface">Str2</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Поставщик?$filter=concat(concat(Город, ', '),
  Страна) eq 'Москва, Россия'</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">like(Str, Template)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  <span class="Interface">true</span>, если значение <span class="Interface">Str1</span>
  удовлетворяет шаблону <span class="Interface">Template</span>. Синтаксис
  шаблона аналогичен функции <span class="Term">ПОДОБНО()</span> языка запросов (см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 8. работа с запросами.htm?_=1496848987#_ref436144880">здесь</a>).</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter= like(Наименование, ‘[^к]%’)</span></p>
  </td>
 </tr>
</table>

<p class="MsoListBullet">&#9679; 
Функции работы с датами:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Функция</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Описание</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Пример</b></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">year(DateTime)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  год из значения типа <span class="Term">Edm.DateTime</span>
  или <span class="Term">Edm.DateTimeOffset</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=year(Произведен) eq 2013</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">quarter(DateTime)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Номер
  квартала года, в котором находится указанное значение типа <span class="Term">Edm.DateTime</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=quarter(ДатаПроизводства) eq 1</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">month(DateTime)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  месяц из значения типа <span class="Term">Edm.DateTime</span> или <span class="Term">Edm.DateTimeOffset</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=month(Произведен) eq 12</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">day(DateTime)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  день из значения типа <span class="Term">Edm.DateTime</span> или <span class="Term">Edm.DateTimeOffset</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=day(Произведен) eq 1</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">hour(DateTime)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  значение часов из значения типа <span class="Term">Edm.DateTime</span> или <span class="Term">Edm.DateTimeOffset</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=hour(Произведен) eq 23</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">minute(DateTime)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  значение минут из значения типа <span class="Term">Edm.DateTime</span> или <span class="Term">Edm.DateTimeOffset</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары</span><span class="Interface">?$filter=minute(Произведен</span><span class="Interface">) eq 59</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">second(DateTime)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  значение секунд из значения типа <span class="Term">Edm.DateTime</span> или <span class="Term">Edm.DateTimeOffset</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары</span><span class="Interface">?$filter=second(Произведен</span><span class="Interface">) eq 59</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">datedifference(DateTime1, DateTime2, Type)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpLast">Возвращает
  разность дат <span class="Interface">DateTime2</span> и <span class="Interface">DateTime1</span>
  в единицах, указанных параметром <span class="Interface">Type</span>:</p>
  <p class="MsoListBulletCxSpFirst">&#9679; 
  <span class="Term">second</span> – секунды;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">minute</span> – минуты;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">hour</span> – часы;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">day</span> – дни;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">month</span> – месяцы;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">quarter</span> – кварталы;</p>
  <p class="MsoListBulletCxSpLast">&#9679; 
  <span class="Term">year</span> – года.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><span class="Interface">/Catalog_Товары?$filter=datedifference(Произведен, ГоденДо,
  ‘day’) gt 10</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">dateadd(DateTime1, Type, Int1)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpLast">Возвращает
  дату, полученную добавлением к значению <span class="Interface">DateTime1</span>
  значения <span class="Interface">Int1</span>, выраженное в единицах <span class="Interface">Type</span>:</p>
  <p class="MsoListBulletCxSpFirst">&#9679; 
  <span class="Term">second</span> – секунды;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">minute</span> – минуты;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">hour</span> – часы;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">day</span> – дни;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">month</span> – месяцы;</p>
  <p class="MsoListBulletCxSpMiddle">&#9679; 
  <span class="Term">quarter</span> – кварталы;</p>
  <p class="MsoListBulletCxSpLast">&#9679; 
  <span class="Term">year</span> – года.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><span class="Interface">/Catalog_Товары?$filter=dateadd(Произведен, ‘month’, 1) eq
  ГоденДо</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">dayofweek(DateTime)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  день недели по значению типа <span class="Term">Edm.DateTime</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=dayofweek(ДатаПроизводства) eq 7</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">dayofyear(DateTime)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  день года по значению <span class="Term">Edm.DateTime</span>.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter=dayofyear(ДатаПроизводства) eq 1</span></p>
  </td>
 </tr>
</table>

<p class="MsoListBullet">&#9679; 
Прочие функции:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpFirst"><b>Функция</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Описание</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Пример</b></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">round(Number)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  параметр, округленный до ближайшего целого числа.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары</span><span class="Interface">?$filter=round(Вес</span><span class="Interface">) gt 31</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">isof(expr, type)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  <span class="Interface">true</span> в том случае, когда объект, на который указывает
  параметр <span class="Interface">expr</span>, имеет тип, на который ссылается <span class="Interface">type</span>. В качестве типа значения принимается строка,
  обозначающая имя данного типа, например: <span class="Term">String</span>, <span class="Term">Number</span>,
  <span class="Term">Boolean</span>,
  <span class="Term">Date</span>,
  <span class="Term">Catalog_Товары</span>
  и т. д.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары</span><span class="Interface">?$filter=isof(Цена</span><span class="Interface">, ‘Number’)</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">cast(expr, type)</span></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возвращает
  объект, на который указывает параметр <span class="Interface">expr</span>, приведенный
  к типу, указанному параметром <span class="Interface">type</span>. В качестве
  типа значения принимается строка, обозначающая имя данного типа, например: <span class="Term">String</span>,
  <span class="Term">Number</span>,
  <span class="Term">Boolean</span>,
  <span class="Term">Date</span>,
  <span class="Term">Catalog_Товары</span>
  и т. д.</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><span class="Interface">/Catalog_Товары?$filter= cast(РеквизитСоставной, 'Number') le
  12</span></p>
  </td>
 </tr>
</table>

<p class="Note"><span class="Note">Примечание.</span> Не поддерживаются
операции сравнения с реквизитом типа <span class="Term">ХранилищеЗначения</span>.</p>

<p class="MsoNormal">Имеется возможность выполнять отбор сущностей при помощи
проверки на равенство поля составного типа и ссылки. Для этого следует
использовать функцию <span class="Interface">cast()</span>.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">$filter=ДокументПрихода eq cast(guid'0d4a79cb-9843-4147-bcd9-80ac3ca2b9c7', 'Document_ПриходнаяНакладная') </pre>

<p class="MsoNormalCxSpFirst">В данном примере у используемой сущности имеет
реквизит составного типа <span class="Term">ДокументПрихода</span>. Запрос будет отбирать все
записи сущности, у которой данный реквизит заполнен ссылкой на документ <span class="Term">ПриходнаяНакладная</span>
с указанным уникальным идентификатором (<span class="Interface">0d4a79cb-9843-4147-bcd9-80ac3ca2b9c7</span>).</p>

<p class="MsoNormalCxSpLast">Если требуется выполнить отбор по реквизиту типа <span class="Term">УникальныйИдентификатор</span>,
то это выполняется с помощью простой операции сравнения:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">$filter=ИмяРеквизита eq guid'0d4a79cb-9843-4147-bcd9-80ac3ca2b9c7'</pre>

<p class="MsoNormal">Для отбора по типу какого-либо реквизита составного типа
следует использовать функцию <span class="Interface">isof()</span>:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">$filter=isof(ДокументыПрихода, 'Document_ПриходнаяНакладная')</pre>

<p class="MsoNormal">Следующее выражение всегда вернет пустой результат запроса,
вне зависимости от физического наличия используемого уникального идентифкатора
в соответствующей колонке сущности:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">$filter=ДокументыПрихода eq guid'0d4a79cb-9843-4147-bcd9-80ac3ca2b9c7'</pre>

<p class="MsoNormal">При необходимости выполнить отбор по элементу коллекции,
необходимо использовать лямбда-функции. В качестве аргументов лямбда-функции высутпает
имя лямбда-переменной, за которой следует символ двоеточия и логическое
выражение, которое использует лямбда-переменную для указания на свойства
элемента коллекции. Система поддерживает использование следующих
лямбда-функций:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">any</span> – применяет
логическое выражение к каждому элементу коллекции и возвращает значение <span class="Interface">true</span>, если хоть один элемент коллекции удовлетворяет
этому условию. Лямбда-функция <span class="Interface">any</span> без аргументов
возвращает <span class="Interface">true</span>, если коллекция не пуста.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Document_Продажи?$filter=Товары/any(d: d/Цена gt 10000)</pre>

<p class="Indentlist">В приведенном примере формируется список документов <span class="Term">Продажи</span>,
у которых есть табличная часть <span class="Term">Товары</span>, в которой есть реквизит <span class="Term">Цена</span>.
При этом <span class="Term">Цена</span>
должна быть больше, чем <span class="Term">10000</span>. В результирующий список попадут документы,
в состав которых входит хотя бы одна строка, удовлетворяющая условию.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">all</span> – применяет
логическое выражение к каждому элементу коллекции и возвращает значение <span class="Interface">true</span>, если все элементы коллекции ему удовлетворяет.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Document_Продажи?$filter=Товары/any(d: d/Цена lt 10000)</pre>

<p class="Indentlist">В приведенном примере формируется список документов <span class="Term">Продажи</span>,
у которых есть табличная часть <span class="Term">Товары</span>, в которой есть реквизит <span class="Term">Цена</span>.
При этом <span class="Term">Цена</span>
должна быть меньше, чем <span class="Term">10000</span>. В результирующий список попадут
документы, в составе которых все строки удовлетворяют заданному условию.</p>

<p class="MsoNormal">Не поддерживаются следующие стандартные функции: <span class="Interface">lenght</span>, <span class="Interface">indexof</span>, <span class="Interface">replace</span>, <span class="Interface">tolower</span>, <span class="Interface">toupper</span>, <span class="Interface">trim</span>, <span class="Interface">years</span>, <span class="Interface">days</span>, <span class="Interface">hours</span>, <span class="Interface">seconds</span>, <span class="Interface">floor</span>, <span class="Interface">ceiling</span>;</p>

<a id="TI000001771" class="bookmark" name="issogl4_17.2.1.5.3__top"><h5>17.2.1.5.3. $top</h5></a>

<p class="MsoNormal">Имеется возможность ограничить количество записей,
возвращаемых при обращении к ресурсу. Для этого используется параметр <span class="Interface">$top</span>.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/odata/standard.odata/Catalog_Товары?$filter=Цена lt 1000&amp;$top=10</pre>

<a id="TI000001772" class="bookmark" name="issogl4_17.2.1.5.4_allowedonly"><h5>17.2.1.5.4. allowedOnly</h5></a>

<p class="MsoNormal">Если при выполнении запроса необходимо получить только те
объекты данных, которые не попадают под ограничения доступа к данным, то в URL
получения данных необходимо добавить параметр <span class="Interface">allowedOnly</span>.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Catalog_Товары?$allowedOnly=true</pre>

<p class="MsoNormalCxSpFirst">Если параметр не указан или указан со значением <span class="Interface">false</span>, то во время исполнения запроса к данным может
возникнуть ошибка с кодом 401 (если результат выполнения запроса содержит
данные, доступ к которым запрещен). Ошибка может не произойти в том случае, если
были указаны дополнительные условия, которые ограничили выборку только
разрешенными данными.</p>

<p class="MsoNormalCxSpLast">Например, для справочника <span class="Term">Данные</span> настроено
ограничение доступа к данным, которое не позволяет получить элементы справочника,
у которых реквизит <span class="Term">ЗначениеСекретности</span>
равно 1, но позволяет получить элементы справочника, у которых реквизит <span class="Term">ЗначениеСекретности</span>
равно 2. В этом случае следующий запрос не приведет к возникновению ошибки, т. к.
явно накладывается условие, которое оставляет в выборе только разрешенные данные:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Catalog_Данные?allowedOnly=false&amp;$filter=ЗначениеСекретности eq 2</pre>

<p class="MsoNormal">Параметр <span class="Interface">allowedOnly</span> можно
использовать только для GET-запросов к наборам сущностей.</p>

<a id="TI000001773" class="bookmark" name="issogl4_17.2.1.5.5__skip"><h5>17.2.1.5.5. $skip</h5></a>

<p class="MsoNormal">Позволяет исключить из результата запроса первые несколько
записей. Если параметры <span class="Interface">$top</span> и <span class="Interface">$skip</span> указываются одновременно, то параметр <span class="Interface">$skip</span> будет применен раньше, чем параметр <span class="Interface">$top</span>. Приоритет применения параметров не зависит от
порядка их указания в теле запроса.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Catalog_Товары?$skip=2</pre>

<a name="_ref447119180"></a><a id="TI000001820" class="bookmark" name="issogl3_17.2.1.6_параметры_запроса"><h4>17.2.1.6. Параметры запроса</h4></a>

<a name="_ref379542964"></a><a id="TI000001774" class="bookmark" name="issogl4_17.2.1.6.1__count"><h5>17.2.1.6.1. $count</h5></a>

<p class="MsoNormal">Данный параметр
позволяет получить в качестве результата запроса не выборку, а ее (выборки)
размер. При успешном выполнении, тело ответа должно содержать только число
элементов коллекции, отформатированное как обычное число.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
// возвращает количество элементов справочника Товары,
// для которых справедливо условие: значение реквизита Цена больше 500
http://host/base/odata/standard.odata/Catalog_Товары/$count?$filter=Цена gt 500
</pre>

<a id="TI000001775" class="bookmark" name="issogl4_17.2.1.6.2__inlinecount"><h5>17.2.1.6.2. $inlinecount</h5></a>

<p class="MsoNormal">Параметр позволяет
указать, что система должна включить результат запроса не только полученные
записи, но и количество этих записей. Для этого необходимо указывать значение
параметра <span class="Interface">$inlinecount</span>, равное <span class="Interface">allpages</span>. Использование параметра <span class="Interface">$inlinecount</span> со
значением <span class="Interface">none</span> подавляет возвращение количества записей вместе с
результатом запроса. Если параметр <span class="Interface">$inlinecount</span> не указан в теле запроса, то количество
записей вместе с результатом запроса не возвращается. Использование параметра <span class="Interface">$inlinecount</span>
приводит к игнорированию параметров <span class="Interface">$skip</span> и <span class="Interface">$top</span>. Допускается совместное использование параметров <span class="Interface">$filter</span> и <span class="Interface">$inlinecount</span>.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Catalog_Товары?$inlinecount=allpages</pre>

<p class="MsoNormal">Пример результата запроса, с параметром <span class="Interface">$inlinecount=allpages</span>:</p>

<p class="Lang-subheader">Формат atom-xml:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;feed xmlns=http://www.w3.org/2005/Atom xmlns:at=http://purl.org/atompub/tombstones/1.0 xmlns:d=http://schemas.microsoft.com/ado/2007/08/dataservices xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata xml:base=&quot;http://localhost/ODataTests/odata/standard.odata/&quot;&gt;
    &lt;entry&gt;
        …
    &lt;/entry&gt;
        …
    &lt;entry&gt;
        …
    &lt;/entry&gt;
    &lt;m:count&gt;19&lt;/m:count&gt;
&lt;/feed&gt;
</pre>

<p class="Lang-subheader">Формат json:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
{
    &quot;odata.metadata&quot;: &quot;http://localhost/ODataTests/odata/standard.odata/$metadata#Document_ДемоДокумент&quot;,
    &quot;odata.count&quot;: &quot;19&quot;,
    &quot;value&quot;: [{...}, ..., {...}]
}
</pre>

<a id="TI000001776" class="bookmark" name="issogl4_17.2.1.6.3__orderby"><h5>17.2.1.6.3. $orderby</h5></a>

<p class="MsoNormal">Данный параметр
позволяет задать упорядочивание результата запроса. Значение параметра <span class="Interface">$orderby</span>
содержит список реквизитов, разделенных запятыми. Значение реквизита может
включать направление упорядочивания:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">asc</span> – для
упорядочивания по возрастанию;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">desc</span> – для
упорядочивания по убыванию.</p>

<p class="MsoNormal">Направление
упорядочивания должно быть отделено от имени реквизита на 1 и более пробелов.
Если <span class="Interface">asc</span>
или <span class="Interface">desc</span>
не указан, то считается, что требуется упорядочивание по возрастанию.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Catalog_Товары?$orderby=Название asc, Производитель desc</pre>

<p class="MsoNormal">Допускается
упорядочивание по свойствам дочерних реквизитов. В этом случае полное имя
реквизита, по которому выполняется упорядочивание, формируется с использованием
разделителя &quot;/&quot;.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Document_Расход?$orderby=Контрагент/ИНН asc</pre>

<p class="MsoNormal">В этом примере упорядочивание
будет произведено по возрастанию (<span class="Interface">asc</span>) значения реквизита <span class="Term">ИНН</span>
у сущности, на которую ссылается реквизит <span class="Term">Контрагент</span>
документа <span class="Term">Расход</span>.</p>

<a name="_ref447120795"></a><a id="TI000001821" class="bookmark" name="issogl4_17.2.1.6.4__expand"><h5>17.2.1.6.4. $expand</h5></a>

<p class="MsoNormalCxSpFirst">Данный параметр позволяет вместе с
результатами основного запроса получать значения связанных сущностей, что
позволит не запрашивать каждую сущность отдельно.</p>

<p class="MsoNormalCxSpMiddle">Значением параметра выступает список из
навигационных ссылок или составных реквизитов (если составные реквизиты могут
принимать ссылочное значение), разделенных запятыми. Для расширения реквизитов
составных реквизитов, после имени составного реквизита должно идти название
типа, на который может хранить ссылку составной реквизит, а уже после этого сам
расширяемый реквизит. Тогда, если у сущности составной реквизит имеет ссылку на
объект указанного типа, то в нем будет расширен указанный реквизит. Если же
значение является ссылкой на объект иного типа или не является ссылкой, то
расширение проводиться не будет.</p>

<p class="MsoNormalCxSpLast">Возможно использование опции для расширения
сущностей из результатов функций <span class="Term">SliceLast()</span> и <span class="Term">SliceFirst()</span>.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">http:<span class="comment">//host/base/odata/standard.odata/Catalog_Клиенты?$expand=Сертификат</span></pre>

<p class="MsoNormal">Для каждого элемента из справочника <span class="Term">Клиенты</span>, в
результат запроса должен быть помещен объект, на который ссылается реквизит <span class="Term">Сертификат</span>.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">http:<span class="comment">//host/base/odata/standard.odata/Catalog_Клиенты?$expand=Договор/Document_ДоговорНайма/Заявление</span></pre>

<p class="MsoNormalCxSpFirst">Для каждого элемента из справочника <span class="Term">Клиенты</span>, в
результат запроса должен быть добавлен объект, на который ссылается реквизит
составного типа <span class="Term">Договор</span> (если он содержит какое-либо ссылочное
значение). Если реквизит <span class="Term">Договор</span> хранит ссылку на объект типа <span class="Term">ДокументСсылка.ДоговорНайма</span>,
то объект, на который ссылается <span class="Term">Договор.Заявление</span> так же должен быть добавлен в результате
запроса.</p>

<p class="MsoNormalCxSpLast">Значение <span class="Interface">*</span> в
конце пути параметра <span class="Interface">$</span><span class="Interface">expand</span> означает
необходимость раскрыть все навигационные ссылки внутри сущности. Однако, нельзя
раскрывать навигационные поля у составного реквизита без явного указания типа
ссылки.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">http:<span class="comment">//host/base/odata/standard.odata/Catalog_Клиенты?$expand=Договор/Document_ДоговорНайма/*</span></pre>

<p class="MsoNormal">В данном примере <span class="Term">Договор</span> – это составной реквизит. Данный
вариант указания <span class="Interface">*</span> поддерживается.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">http:<span class="comment">//host/base/odata/standard.odata/Catalog_Клиенты?$expand=Договор/*</span></pre>

<p class="MsoNormal">В данном примере <span class="Term">Договор</span> – это составной реквизит. Данный
вариант указания <span class="Interface">*</span> не поддерживается.</p>

<p class="Lang-subheader">Примеры:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">http:<span class="comment">//host/base/odata/standard.odata/Catalog_Клиенты?$expand=*</span></pre>

<p class="MsoNormal">Для каждого элемента из справочника <span class="Term">Клиенты</span>, в
результат запроса должны быть добавлены объекты, на которые ссылаются все
навигационные ссылки объекта <span class="Term">Клиента</span>.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">http:<span class="comment">//host/base/odata/standard.odata/Catalog_Клиенты?$expand=Договор/*</span></pre>

<p class="MsoNormalCxSpFirst">Для каждого элемента из справочника <span class="Term">Клиенты</span>, в
результат запроса должны быть добавлены объекты, на которые ссылаются все
навигационные ссылки внутри объекта <span class="Term">Договор</span> и сам объект <span class="Term">Договор</span>.
При этом реквизит <span class="Term">Договор</span>
является реквизитом ссылочного типа.</p>

<p class="MsoNormalCxSpLast">Ограничения параметра <span class="Interface">$expand</span>:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Не поддерживается расширение реквизитов
табличных частей.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Не поддерживается расширение при запросе
одиночных сущностей (сущность, строки табличной части, запись регистра).</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Расширение ссылочных и составных типов
виртуальных таблиц не соответствует протоколу OData
версии 3.</p>

<p class="Indentlist">Запрос, в котором
будет выполняться расширение измерения виртуальной таблицы будет выглядеть
следующим образом:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/AccountingRegister_РегистрБухгалтерии/Balance?$expand=Организация</pre>

<p class="Indentlist">В результате
исполнения этого запроса будет получен следующий результат:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
&lt;d:Организация_Key&gt;УникальныйИдентификатор&lt;/d:Организация_Key&gt;
&lt;d:Организация&gt;
    …ДанныеОбъекта…
&lt;/d:Организация&gt;
</pre>

<p class="Indentlist">При расширении
составного типа поведение аналогично, за исключением того, что данные объекта будут
представлены в элементе с суффиксом <span class="Interface">_Expanded</span>.</p>

<a name="_ref397094488"></a><a id="TI000001364" class="bookmark" name="issogl3_17.2.1.7_способы_получения_описания_стандартного_интерфейса_odata"><h4>17.2.1.7. Способы получения описания стандартного интерфейса OData</h4></a>

<p class="MsoNormalCxSpFirst">Для
получения упрощенного описания стандартного интерфейса
OData (только список сущностей) необходимо выполнить GET-запрос с использованием
URL <span class="Interface">http://host/base/odata/standard.odata</span>.</p>

<p class="MsoNormalCxSpMiddle">Для
получения описания стандартного интерфейса OData необходимо выполнить
GET-запрос с использованием URL <a href="http://host/base/odata/standard.odata/$metadata" target="_blank">http://host/base/odata/standard.odata/$metadata</a>. В результате
будет получен полный список доступных сущностей, их атрибутов и функций в виде
XML-документа. Подробное описание документа можно получить по адресу <a href="http://www.odata.org/documentation/odata-v3-documentation/common-schema-definition-language-csdl/" target="_blank">http://www.odata.org/documentation/odata-v3-documentation/common-schema-definition-language-csdl/</a> (на английском языке).</p>

<p class="MsoNormalCxSpLast">В случае получение
данных в формате <span class="Bold">json</span>, не поддерживается запрос
получения расширенного описания метаданных вида <a href="http://host/base/odata/standard.odata/$metadata" target="_blank">http://host/base/odata/standard.odata/$metadata</a>. Однако имеется возможность управлять
детализацией информации о метаданных, которая возвращается при получении данных
(как сущностей, так и списков сущностей). Для этого необходимо особым образом
формировать параметр <span class="Interface">$format</span> при выполнении запроса:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">$</span><span class="Interface">format=</span>application/<span class="Interface">json;</span><span class="Interface">odata=</span><span class="Interface">minimalmetadata</span> – в этом случае информация о
метаданных передается в минимальном объеме. Это значение по умолчанию.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
$<span class="Interface">format=</span><span class="Interface">application/</span><span class="Interface">json;</span><span class="Interface">odata=</span><span class="Interface">nometadata</span> –
в этом случае информация о метаданных не передается вовсе.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">$</span><span class="Interface">format=</span><span class="Interface">application/</span><span class="Interface">json;</span><span class="Interface">odata=full</span><span class="Interface">metadata</span> – в этом случае
информация о метаданных передается в полном объеме.</p>

<a name="_ref397340175"></a><a id="TI000001365" class="bookmark" name="issogl3_17.2.1.8_способы_получения_данных"><h4>17.2.1.8. Способы получения данных</h4></a>

<p class="MsoNormalCxSpFirst">С помощью стандартного интерфейса OData можно
получать как списки сущностей, так и сами сущности. Эти способы получения
данных отличаются URL, по которому происходит обращение к данным.</p>

<p class="MsoNormalCxSpLast">Для получения списка сущностей URL выглядит
следующим образом: <span class="Interface">http://host/base/odata/standard.odata/Catalog_Товары</span>.
Это <span class="Bold">URL набора сущностей</span>. Для получения сущности URL
будет выглядеть следующим образом: <span class="Interface">http://host/base/odata/standard.odata/Catalog_Товары(guid'value')</span>.
В общем виде такой адрес будет называться <span class="Bold">канонический URL экземпляра
сущности</span>. Разница заключается в том, что в первом случае получается вся
таблица справочника товаров, а вот втором выбирается один объект, который
описывается набором ключевых значений (в примере ключевое значение единственное –
ссылка на объект). В конкретном случае набор ключевых полей, описывающих
сущность, зависит от получаемой сущности. Если ключевых полей более одного, то
они должны быть указаны все. Ключевые значения указываются парами <span class="Interface">Имя=Значение</span>, разделенными запятыми. Если ключевое
значение одно – имя ключа можно не указывать. Например, для получения
значения курса валюты на конкретную дату необходимо выполнить GET-запрос со
следующим URL:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/InformationRegister_КурсыВалют(Period=datetime'2008-02-05T00:00:00', Валюта_Key=guid'9d5c4222-8c4c-11db-a9b0-00055d49b45e')</pre>

<p class="MsoNormal">При получении данных существует возможность указать, какие
свойства сущности (или набора сущностей) необходимо получить с помощью стандартного
интерфейса OData. Для этого существует ключевое слово <span class="Interface">$select</span>,
которое имеет несколько вариантов использования:</p>

<p class="MsoListBullet">&#9679; 
Признак получения всех свойств.</p>

<p class="Indentlist">В этом случае следует указать выражение вида <span class="Interface">$select=*</span> или совсем не указывать выражение <span class="Interface">$select</span>.</p>

<p class="MsoListBullet">&#9679; 
Перечень конкретных свойств, которые необходимо
получить.</p>

<p class="Indentlist">В этом случае необходимо указать в выражении оператора <span class="Interface">$select</span> перечень (через запятую) всех необходимых полей.
При этом следует указывать суффиксы свойств, если это необходимо. Например, для
получения значения ссылки на справочник и свойств <span class="Term">Код</span> и <span class="Term">Артикул</span>,
для справочника <span class="Term">Товары</span>,
необходимо использовать следующий URL:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Catalog_Товары?$select=Ref_Key, Код, Артикул</pre>

<p class="Indentlist">Для получения этих же полей для конкретного экземпляра
сущности (с известным идентификатором) будет использоваться следующий URL:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Catalog_Товары(guid'value')?$select=Ref_Key, Код, Артикул</pre>

<p class="MsoListBullet">&#9679; 
Признак получения всех свойств, кроме табличных
частей.</p>

<p class="Indentlist">Для этого в выражении оператора <span class="Interface">$select</span>
необходимо указать значение <span class="Interface">**</span>. При использовании
следующего URL будут получены все документы <span class="Term">РасходТовара</span> со
всеми реквизитами, кроме табличных частей:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Document_РасходТовара?$select=**</pre>

<p class="MsoListBullet">&#9679; 
Указание списка для получения связанных
сущностей.</p>

<p class="Indentlist">Допускается совместное использование параметров запроса <span class="Interface">$select</span> и <span class="Interface">$expand</span>. В этом
случае с помощью параметра <span class="Interface">$expand</span> указываются те
свойства получаемой сущности, которые следует поместить в результат запроса.
Конкретные значения получаемых (или разворачиваемых) свойств указывается с
помощью параметра <span class="Interface">$select</span>. Описание работа с
параметром <span class="Interface">$expand</span> более подробно
см. <a href="#_ref447120795">здесь</a>. В параметре <span class="Interface">$</span><span class="Interface">select</span>,
при использовании совместно с параметром <span class="Interface">$</span><span class="Interface">expand,</span>
поддерживается использование символов <span class="Interface">*</span> и <span class="Interface">**</span>. Указание символа <span class="Interface">*</span> означает,
что необходимо развернуть все реквизиты получаемого объекта. Указание символа <span class="Interface">**</span> означает, что необходимо развернуть все реквизиты
получаемого объекта, кроме табличных частей.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
http://host/base/odata/standard.odata/Catalog_Клиенты?$expand=Сертификат&amp;$select=Сертификат/Дата
http://host/base/odata/standard.odata/Catalog_Клиенты?$expand=Договор/Document_ДоговорНайма/Заявление&amp;$select=Договор/Document_ДоговорНайма/Заявление/**
http://host/base/odata/standard.odata/InformationRegister_КурсыВалют?$expand=Валюта&amp;$select=Период,Валюта/Код,Курс
http://host/base/odata/standard.odata/Catalog_Клиенты?$expand=Сертификат&amp;$select=Сертификат/*
</pre>

<p class="MsoNormal">Если в параметре <span class="Interface">$select</span>
одновременно указаны поля вида <span class="Interface">Объект/*</span>, <span class="Interface">Объект/**</span>, <span class="Interface">Объект/ИмяРеквизита</span>,
то они обрабатываются в следующем порядке:</p>

<p class="MsoListNumberCxSpFirst">1. 
Если указан символ <span class="Interface">*</span>,
то включаются все реквизиты;</p>

<p class="MsoListNumberCxSpMiddle">2. 
Иначе, если указан символ <span class="Interface">**</span>,
то включаются все реквизиты, кроме табличных частей, иные указания
игнорируются. Таким образом, если указано выражение вида <span class="Interface">$select=Объект/**,
Объект/ТабличнаяЧасть</span>, то табличная часть включена не будет.</p>

<p class="MsoListNumberCxSpLast">3. 
Иначе, включаются все указанные реквизиты.</p>

<p class="MsoNormal">Имеется возможность получать данные, доступные «через
точку». В этом случае к адресу, описывающему <span class="Bold">конкретную</span>
сущность, прибавляются имена свойств, идущие «через
точку», но разделенные символом «<span class="Interface">/</span>». При этом для стандартных реквизитов следует
использовать только английские имена реквизитов. Например, для получения свойства
<span class="Term">Наименование</span>
реквизита <span class="Term">Валюта</span>
документа <span class="Term">РасходТовара</span>,
необходимо использовать GET-запрос со следующим URL: http://host/base/odata/standard.odata<span class="Interface">/Document_РасходТовара(guid'value')/Валюта/Description</span>.</p>

<a id="TI000001366" class="bookmark" name="issogl3_17.2.1.9_выполнение_функций_и_действий"><h4>17.2.1.9. Выполнение функций и действий</h4></a>

<p class="MsoNormal">С некоторыми сущностями и наборами сущностей могут быть
связаны функции. Например, через функции выполняется работа с виртуальными
таблицами регистров. В этом случае URL ресурса формируется следующим образом: http://host/base/odata/standard.odata<span class="Interface">/&lt;ресурс&gt;/&lt;функция&gt;(&lt;параметры&gt;)</span>.
Подробнее рассмотрим, из чего состоит адрес. Первая часть адреса (<a href="http://host/base/odata/standard.odata" target="_blank">http://host/base/odata/standard.odata</a>)
представляет собой стандартный префикс адреса при обращении к стандартному
интерфейсу OData. <span class="Interface">&lt;ресурс&gt;</span> – имя
ресурса, правила формирования которого см. <a href="#_ref379553184">здесь</a>. Имя функции соответствует англоязычному имени
виртуальной таблицы языка запросов (см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 8. работа с запросами.htm?_=1496848987#_ref380403500">здесь</a>). <span class="Interface">&lt;параметры&gt;</span> у функции задаются парами <span class="Interface">Ключ=Значение</span> и разделяются запятыми. Если в качестве
параметра функции используется отбор, то выражение, описывающее отбор, должно
удовлетворять общим правилам описания отборов (см. <a href="#_ref379554692">здесь</a>). Так, получение среза первых для регистра курсов
валют (с параметрами), будет выполняться по следующему URL: <span class="Interface">http:// </span><span class="Interface">host/base/odata/standard.odata/InformationRegister_КурсыВалют/SliceFirst(Period=datetime'2008-01-01T00:00:00',Condition='Валюта_Key
eq guid'value'')</span>.</p>

<a name="_ref436147988"></a><a id="TI000001367" class="bookmark" name="issogl3_17.2.1.10_ошибочные_ситуации"><h4>17.2.1.10. Ошибочные ситуации</h4></a>

<p class="MsoNormalCxSpFirst">В случае ошибочной ситуации возвращается ответ с
HTTP-статусом <span class="Term">4XX</span>
или <span class="Term">5XX</span>.
Статус <span class="Term">4XX</span>
информирует об ошибках на стороне клиентского приложения, статус <span class="Term">5XX</span>
информирует об ошибке на стороне сервера.</p>

<p class="MsoNormalCxSpLast">В случае статуса <span class="Term">4XX</span> сервер
пытается уточнить причину ошибки и может передать клиентскому приложению
дополнительный внутренний код ошибки и информационное сообщение (в виде
xml-документа) в теле ответа.</p>

<p class="Lang-subheader">Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
&lt;m:error xmlns:m=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/metadata&quot;&gt;
    &lt;m:code&gt;9&lt;/m:code&gt;
    &lt;m:message&gt;Экземпляр сущности &quot;НакладнаяОтгрузки&quot; не найден по переданному ключу.&lt;/m:message&gt;
&lt;/m:error&gt;
</pre>

<p class="MsoNormalCxSpFirst">Далее
перечислены внутренние коды ошибок с описанием причины появления:</p>

<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0">
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Код</b></p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle"><b>Описание</b></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">0</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Возможность
  не поддерживается</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">1</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Не
  удалось разобрать строку</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">2</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Неверный
  формат запроса</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">3</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Запрошенный
  тип представления не поддерживается</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">4</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Неверное
  значение свойства</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">5</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Отсутствует
  обязательное значение свойства</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">6</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Неверный
  URL</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">7</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Не
  хватает элемента ключа сущности</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">8</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Тип
  сущности не найден</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">9</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Экземпляр
  сущности не найден</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">10</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Запрошенное
  свойство не найдено</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">11</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Метод
  не найден</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">12</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Отсутствует
  обязательный аргумент метода</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">13</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Создание
  строк табличных частей напрямую не поддерживается</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">14</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Ошибка
  разбора опций запроса</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">15</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Сущность
  с таким ключом уже существует</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">16</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Не
  удалось присвоить свойство</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">17</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Объект
  не поддерживает режим загрузки данных</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">18</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Ошибка
  инициализации интерфейса OData: в объекте есть свойства с одинаковыми именами</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">19</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Использованный
  HTTP-метод запрещен в данном контексте</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">20</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpLast">Ошибка
  прав доступа. Может возникать:</p>
  <p class="MsoListBulletCxSpFirst">&#9679; 
  Когда у пользователя нет прав на запрошенное
  действие над данным объектом;</p>
  <p class="MsoListBulletCxSpLast">&#9679; 
  Когда в выборку попадает объект, недоступный в
  связи с ограничением доступа к данным и параметр <span class="Interface">allowedOnly</span>
  не используется.</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">21</p>
  </td>
  <td valign="top">
  <p class="MsoNormalCxSpMiddle">Вызов
  нереализованной функции.</p>
  <p class="MsoNormalCxSpMiddle">Указание
  неверного количества аргументов функции.</p>
  <p class="MsoNormalCxSpMiddle">Попытка
  передачи аргумента неверного типа.</p>
  <p class="MsoNormalCxSpMiddle">Указание
  нереализованной лямбда-функции.</p>
  </td>
 </tr>
</table>

<a id="TI000001368" class="bookmark" name="issogl3_17.2.1.11_установка_значений_разделителей"><h4>17.2.1.11. Установка значений разделителей</h4></a>

<p class="MsoNormal">Значения разделителей можно устанавливать только
следующими способами:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
С помощью фрагментов URL при обращении к стандартному
интерфейсу OData;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
С помощью файла описания публикации <span class="Interface">default.vrd</span>.</p>

<p class="MsoNormal">Указанием разделителей с помощью параметры
командной строки <span class="Interface">Z</span> не
поддерживается.</p>

<a name="_ref379996228"></a><a name="_ref392758863"></a><a id="TI000001369" class="bookmark" name="issogl3_17.2.1.12_публикация_стандартного_интерфейса_odata"><h4>17.2.1.12. Публикация стандартного интерфейса OData</h4></a>

<p class="MsoNormalCxSpFirst">Публикация стандартного
интерфейса OData
выполняется с помощью диалога публикации на веб-сервере (<span class="Interface">Администрирование –
Публикация на веб-сервере</span>) и описано <a href="/db/v8310doc/bookmark/adm/TI000000474" target="_top">в книге 1С:Предприятие 8.3. &quot;Руководство администратора&quot;</a>.</p>

<p class="MsoNormalCxSpMiddle">Для того
чтобы объекты конфигурации стали доступны через стандартный интерфейс OData,
необходимо разрешить это с помощью метода глобального контекста <span class="Term">УстановитьСоставСтандартногоИнтерфейсаOData()</span>.
Если прикладное решение функционирует в режиме совместимости с версией 8.3.4 (и
ниже), данный метод не используется. В этом случае с помощью стандартного
интерфейса OData доступны все поддерживаемые объекты конфигурации.</p>

<p class="MsoNormalCxSpMiddle">С помощью
данного метода можно ограничить перечень доступных объектов конфигурации только
теми (из общего перечня поддерживаемых, см. <a href="#_ref379553184">здесь</a>), доступ к которым действительно необходим для
внешних приложений.</p>

<p class="MsoNormalCxSpLast">Механизм
установки состава объектов, доступных с помощью стандартного интерфейса OData,
можно выполнить в виде внешней обработки. Для этого не требуется модифицировать
прикладное решение.</p>

<a id="TI000001370" class="bookmark" name="issogl3_17.2.1.13_выполнение_типовых_операций"><h4>17.2.1.13. Выполнение типовых операций</h4></a>

<p class="MsoNormal">В данном разделе будут приведены примеры выполнения
некоторых типовых операций по работе с данными с помощью стандартного
интерфейса OData.</p>

<p class="Note"><span class="Note">Внимание!</span> Данные примеры не
являются законченными. Они приведены только для иллюстрации применения
различных конструкций.</p>

<a id="TI000001371" class="bookmark" name="issogl4_17.2.1.13.1_работа_с_одним_объектом"><h5>17.2.1.13.1. Работа с одним объектом</h5></a>

<a name="_ref427078202"></a><a id="TI000001372" class="bookmark" name="issogl5_чтение_данных"><h6>Чтение данных</h6></a>

<p class="MsoNormal">Для получения информации о сущности следует использовать
канонический URL сущности. Чтение выполняется с помощью GET-запроса.</p>

<p class="Lang-subheader">Пример чтения ссылочного
объекта:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Catalog_Товары(guid'value')</pre>

<p class="Lang-subheader">Пример
чтения набора записей подчиненного регистра сведений:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/InformationRegister_ПриходныеЦены(Recorder_Key=guid'value')</pre>

<p class="MsoNormal">В данном примере <span class="Interface">guid'value'</span>
идентифицирует документ, выполнивший движение по регистру сведений.</p>

<p class="Lang-subheader">Пример чтения записи регистра
сведений:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/InformationRegister_ПриходныеЦены_RecordType(Товар_Key=guid'value', ТипЦены=&quot;Приходная&quot;)</pre>

<p class="Lang-subheader">Пример чтения строки
конкретного документа:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/Document_РасходТовара_Товары(Ref_Key=guid'value', LineNumber=1)</pre>

<p class="MsoNormal">Чтение виртуальной таблицы <span class="Term">СрезПоследних</span>
регистра сведений <span class="Term">КурсыВалют</span>
(с отбором по измерению <span class="Term">ОсновнаяВалюта</span> типа <span class="Term">СправочникСсылка.Валюты</span>)
будет выглядеть следующим образом:</p>

<p class="Lang-subheader">Пример чтения независимого
регистра сведений:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/InformationRegister_КурсыВалют/SliceLast?Condition=Валюта/ОсновнаяВалюта_Key eq guid'value'</pre>

<p class="Lang-subheader">Пример чтения подчиненного регистра
сведений (к имени регистра следует добавить _RecordType):</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/InformationRegister_КурсыВалют_RecordType/SliceLast?Condition=Валюта/ОсновнаяВалюта_Key eq guid'value'</pre>

<p class="MsoNormal">В данном примере <span class="Interface">guid'</span><span class="Interface">value'</span> идентифицирует элемент
справочника <span class="Term">Валюты</span>,
по значению которого выполняется отбор.</p>

<p class="Lang-subheader">Пример получения остатков на
счете из регистра бухгалтерии с условием по конкретному контрагенту:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/AccountingRegister_Хозрасчетный/Balance(AccountCondition='Account_Key eq guid'value1'',Condition='ExtDimension1 eq cast(guid'value2', 'Catalog_Контрагенты')',ExtraDimensions='value3')?$format=json</pre>

<p class="MsoNormal">В данном примере:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<span class="Interface">guid'value1'</span> –
уникальный идентификатор элемента плана счетов;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">guid'value2'</span> –
уникальный идентификатор элемента плана видов характеристик <span class="Term">ВидыСубконтоХозрасчетные</span>
с типом значения <span class="Term">СправочникСсылка.Контрагенты</span>;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">'value3'</span> – уникальный
идентификатор элемента справочника <span class="Term">Контрагенты</span>.</p>

<a id="TI000001373" class="bookmark" name="issogl5_создание_объекта"><h6>Создание объекта</h6></a>

<p class="MsoNormalCxSpFirst">Для создания объекта следует воспользоваться
POST-запросом с использованием URL набора сущностей, передав в теле запроса
XML-документ (в формате atom),
который содержит значения полей создаваемого объекта.</p>

<p class="MsoNormalCxSpLast">Далее приводится пример создания элемента
справочника <span class="Term">Товары</span>
и ответ стандартного интерфейса OData
после успешного выполнения операции.</p>

<p class="Lang-subheader">Пример POST-запроса:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
POST http://host/base/odata/standard.odata/Catalog_Товары HTTP/1.1
User-Agent: Fiddler
Host: host
Content-Length: 981
&lt;entry&gt;
    &lt;category term=&quot;StandardODATA.Catalog_Товары&quot; scheme=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/scheme&quot;/&gt;
    &lt;title type=&quot;text&quot;/&gt;
    &lt;updated&gt;2014-02-14T12:05:55&lt;/updated&gt;
    &lt;author/&gt;
    &lt;summary/&gt;        
    &lt;content type=&quot;application/xml&quot;&gt;
        &lt;m:properties xmlns:d=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices&quot; xmlns:m=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/metadata&quot;&gt;
            &lt;d:DeletionMark&gt;false&lt;/d:DeletionMark&gt;
            &lt;d:Parent_Key&gt;bbb079ae-8c51-11db-a9b0-00055d49b45e&lt;/d:Parent_Key&gt;
            &lt;d:IsFolder&gt;false&lt;/d:IsFolder&gt;
            &lt;d:Code&gt;000000800&lt;/d:Code&gt;
            &lt;d:Description&gt;Шлепанцы&lt;/d:Description&gt;
            &lt;d:Артикул&gt;SL56X&lt;/d:Артикул&gt;
            &lt;d:Поставщик_Key&gt;086715b0-f348-11db-a9c5-00055d49b45e&lt;/d:Поставщик_Key&gt;
            &lt;d:Вид&gt;Товар&lt;/d:Вид&gt;
            &lt;d:Штрихкод/&gt;
            &lt;d:Описание&gt;&amp;lt;html&amp;gt;Шлепанцы пляжные&amp;lt;/html&amp;gt;&lt;/d:Описание&gt;
        &lt;/m:properties&gt;
    &lt;/content&gt;
&lt;/entry&gt;
</pre>

<p class="Lang-subheader">Пример ответа стандартного
интерфейса OData:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
HTTP/1.1 201 Created
Content-Length: 2705
Content-Type: application/atom+xml;type=entry;charset=utf-8
Location: http://host/base/odata/standard.odata/Catalog_Товары(guid'41aa6331-954f-11e3-814b-005056c00008')
Server: Microsoft-IIS/7.5
DataServiceVersion: 3.0
X-Powered-By: ASP.NET
Date: Fri, 14 Feb 2014 08:18:36 GMT
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;entry xmlns=&quot;http://www.w3.org/2005/Atom&quot;
    xmlns:d=http://schemas.microsoft.com/ado/2007/08/dataservices xmlns:m=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/metadata&quot;&gt;
    &lt;id&gt;http://host/base/odata/standard.odata/Catalog_Товары(guid'41aa6331-954f-11e3-814b-005056c00008')&lt;/id&gt;
    &lt;category term=&quot;StandardODATA.Catalog_Товары&quot; scheme=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/scheme&quot;/&gt;
    &lt;title type=&quot;text&quot;/&gt;
    &lt;updated&gt;2014-02-14T12:18:36&lt;/updated&gt;
    &lt;author/&gt;
    &lt;summary/&gt;
    &lt;link rel=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/related/ФайлКартинки&quot;
            href=&quot;Catalog_Товары(guid'41aa6331-954f-11e3-814b-005056c00008')/ФайлКартинки&quot;
            type=&quot;application/atom+xml;type=entry;charset=utf-8&quot;
            title=&quot;ФайлКартинки&quot;/&gt;
    &lt;link rel=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/related/Parent&quot;
            href=&quot;Catalog_Товары(guid'41aa6331-954f-11e3-814b-005056c00008')/Parent&quot;
            type=&quot;application/atom+xml;type=entry;charset=utf-8&quot;
            title=&quot;Parent&quot;/&gt;
    &lt;link rel=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/related/Поставщик&quot;
            href=&quot;Catalog_Товары(guid'41aa6331-954f-11e3-814b-005056c00008')/Поставщик&quot;
            type=&quot;application/atom+xml;type=entry;charset=utf-8&quot;
            title=&quot;Поставщик&quot;/&gt;
    &lt;link rel=&quot;edit&quot;
            href=&quot;Catalog_Товары(guid'41aa6331-954f-11e3-814b-005056c00008')&quot;
            title=&quot;edit-link&quot;/&gt;
    &lt;content type=&quot;application/xml&quot;&gt;
        &lt;m:properties xmlns:d=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices&quot; xmlns:m=&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/metadata&quot;&gt;
            &lt;d:Ref_Key&gt;41aa6331-954f-11e3-814b-005056c00008&lt;/d:Ref_Key&gt;
            &lt;d:DataVersion m:null=&quot;true&quot;/&gt;
            &lt;d:Description&gt;Шлепанцы&lt;/d:Description&gt;
            &lt;d:Code&gt;000000800&lt;/d:Code&gt;
            &lt;d:Parent_Key&gt;bbb079ae-8c51-11db-a9b0-00055d49b45e&lt;/d:Parent_Key&gt;
            &lt;d:IsFolder&gt;false&lt;/d:IsFolder&gt;
            &lt;d:DeletionMark&gt;false&lt;/d:DeletionMark&gt;
            &lt;d:Артикул&gt;SL56X&lt;/d:Артикул&gt;
            &lt;d:Поставщик_Key&gt;086715b0-f348-11db-a9c5-00055d49b45e&lt;/d:Поставщик_Key&gt;
            &lt;d:ФайлКартинки_Key&gt;00000000-0000-0000-0000-000000000000&lt;/d:ФайлКартинки_Key&gt;
            &lt;d:Вид&gt;Товар&lt;/d:Вид&gt;
            &lt;d:Штрихкод/&gt;
            &lt;d:Описание&gt;&amp;lt;html&amp;gt;Шлепанцы пляжные&amp;lt;/html&amp;gt;&lt;/d:Описание&gt;
            &lt;d:ФайлКартинки_Key&gt;00000000-0000-0000-0000-000000000000&lt;/d:ФайлКартинки_Key&gt;
            &lt;d:Parent_Key&gt;bbb079ae-8c51-11db-a9b0-00055d49b45e&lt;/d:Parent_Key&gt;
            &lt;d:Поставщик_Key&gt;086715b0-f348-11db-a9c5-00055d49b45e&lt;/d:Поставщик_Key&gt;
        &lt;/m:properties&gt;
    &lt;/content&gt;
&lt;/entry&gt;
</pre>

<a name="_ref427078218"></a><a id="TI000001374" class="bookmark" name="issogl5_обновление_объекта"><h6>Обновление объекта</h6></a>

<p class="MsoNormalCxSpFirst">Для обновления объекта
необходимо выполнить PUT-/PATCH-запрос с использованием канонического URL
сущности (аналогично запросу GET для получения сущности), передав в теле
запроса XML-документ (в формате atom) или JSON-документ (в формате json),
который содержит значения свойств сущности.</p>

<p class="MsoNormalCxSpMiddle">В случае
PATCH-запроса пропущенные свойства сущности будут проигнорированы, т. е.
будут изменены только те свойства, которые переданы в запросе на изменение. Для
PUT-запроса необходимо указывать значения всех свойств обновляемой сущности.</p>

<p class="MsoNormalCxSpLast">В следующем примере рассматривается изменение
реквизита <span class="Term">Наименование</span>
и состава табличной части <span class="Term">ТорговыеЗалы</span> справочника <span class="Term">Магазины</span>.
Остальные реквизиты справочника не используются в рамках данного примера. В
примере используется формат данных json.</p>

<p class="Lang-subheader">Пример PATCH-запроса:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
PATCH http://host/base/odata/standard.odata/Catalog_Магазины(guid'value')?$format=json HTTP/1.1
Host: host
Connection: keep-alive
Accept: application/json
Content-Length: 638
{
    &quot;odata.metadata&quot;: &quot;http://host/base/odata/standard.odata/$metadata#Catalog_Магазины/@Element&quot;,
    &quot;Description&quot;: &quot;Новое описание магазина&quot;,
    &quot;ТорговыеЗалы@odata.type&quot; : &quot;Collection(StandardODATA.Catalog_Магазины_ТорговыеЗалы_RowType)&quot;
    &quot;ТорговыеЗалы&quot;: [
        {
            &quot;LineNumber&quot;: &quot;1&quot;,
            &quot;Название&quot;: &quot;Синий зал&quot;,
            &quot;Площадь&quot;: 56,
            &quot;ДатаОткрытия&quot;: &quot;2015-01-01T00:00:00&quot;
    },
    {
            &quot;LineNumber&quot;: &quot;2&quot;,
            &quot;Название&quot;: &quot;Красный зал&quot;,
            &quot;Площадь&quot;: 56,
            &quot;ДатаОткрытия&quot;: &quot;2015-06-13T11:45:41&quot;
    }
    ]
}
</pre>

<p class="Note"><span class="Note">Внимание!</span> Табличную часть следует
передавать полностью (все строки) даже в том случае, если требуется изменить
данные только в одной строке этой табличной части.</p>

<p class="MsoNormal">В данном примере <span class="Interface">guid'</span><span class="Interface">value'</span> идентифицирует изменяемый
элемент справочника <span class="Term">Магазины</span>.</p>

<a id="TI000001375" class="bookmark" name="issogl5_удаление_объекта"><h6>Удаление объекта</h6></a>

<p class="MsoNormal">Для удаления объекта следует воспользоваться DELETE-запросом
с использованием канонического URL сущности.</p>

<p class="Note"><span class="Note">Внимание!</span> Пометка на удаление не
выполняется, объект удаляется непосредственно.</p>

<a id="TI000001376" class="bookmark" name="issogl5_оптимистическая_блокировка_данных"><h6>Оптимистическая блокировка данных</h6></a>

<p class="MsoNormalCxSpFirst">Для
оптимистической блокировки данных (т.е. для проверки, что данные не изменились с
момента считывания) нужно использовать заголовок <span class="Term">If-Match</span> HTTP-запроса, связанного с модификацией (PATCH) или удалением
(DELETE) данных. В
качестве значения заголовка должно выступать значение
свойства <span class="Term">DataVersion</span>, которое получено при
предварительном чтении сущности.</p>

<p class="MsoNormalCxSpLast">Механизм
работает следующим образом:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
При запросе экземпляра сущности среди прочих
возвращается свойство <span class="Term">DataVersion</span>.
При запросе набора сущностей с каждой из сущностей набора возвращается свойство
<span class="Term">DataVersion</span>.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Клиентское приложение должно сохранить у себя
это значение версии объекта и затем использовать его в запросах PATCH и DELETE,
передавая его в заголовке <span class="Term">If-Match</span>.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Если значение свойства <span class="Term">DataVersion</span> в
момент исполнения запроса совпадает со значением заголовка <span class="Term">If-Match</span>, то
происходит запрошенное действие. В противном случае действие не выполняется, а
клиенту возвращается HTTP статус 412.</p>

<a id="TI000001377" class="bookmark" name="issogl5_запись_объекта_в_режиме_загрузки_данных"><h6>Запись объекта в режиме загрузки данных</h6></a>

<p class="MsoNormal">Если при записи объекта необходимо эмулировать запись,
выполняемую во время работы механизма обмена данными (свойство <span class="Term">ОбменДанными.Загрузка
= Истина</span>) следует использовать HTTP-заголовок <span class="Interface">1C_OData-DataLoadMode</span> со значением <span class="Interface">true</span>
при выполнении соответствующей операции записи.</p>

<a id="TI000001378" class="bookmark" name="issogl5_проведение_и_отмена_проведения_документа"><h6>Проведение и отмена проведения документа</h6></a>

<p class="MsoNormalCxSpFirst">Для проведения документа необходимо выполнить POST-запрос
с использованием канонического URL сущности (аналогично запросу GET для
получения сущности), указав особым образом сформированный суффикс URL. Суффикс
в этом случае будет состоять из команды <span class="Interface">Post</span> и
параметра, указывающего режим проведения документа: <a href="http://host/base/odata/standard.odata/Document_РасходТоваров(guid'value')/Post?PostingModeOperational=false" target="_blank">http://host/base/odata/standard.odata/Document_РасходТоваров(guid'value')/Post?PostingModeOperational=false</a>.</p>

<p class="MsoNormalCxSpLast">Для отмены проведения документа суффикс состоит из
команды <span class="Interface">Unpost</span> без параметров.</p>

<a id="TI000001379" class="bookmark" name="issogl4_17.2.1.13.2_работа_с_коллекцией_объектов"><h5>17.2.1.13.2. Работа с коллекцией объектов</h5></a>

<p class="MsoNormalCxSpFirst">Для получения набора сущностей какого-либо вида,
следует выполнить GET-запрос с использованием URL следующего вида: <a href="http://host/base/odata/standard.odata/ExchangePlan_ОбменДанными" target="_blank">http://host/base/odata/standard.odata/ExchangePlan_ОбменДанными</a>.</p>

<p class="MsoNormalCxSpLast">Если необходимо установить отбор на получаемый
список, его можно выполнить с помощью параметра <span class="Interface">$filter</span>
(см. <a href="#_ref379554692">здесь</a>), который указывается в URL:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/standard.odata/Document_Накладная?$filter=Приоритет eq 1</pre>

<p class="MsoNormal">Обращение к виртуальной таблице регистра выглядит следующим
образом (на примере виртуальной таблицы <span class="Term">ОстаткиИОбороты</span>
регистра накопления <span class="Term">ТоварныеЗапасы</span>):</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">http://host/base/odata/standard.odata/AccumulationRegister_ТоварныеЗапасы/BalanceAndTurnovers(StartPeriod=datetime'2014-01-01', EndPeriod=datetime'2014-02-01', Condition='Товар_Key eq guid'value'')</pre>

<p class="MsoNormal">Также для ограничения набора сущностей можно использовать
параметры <span class="Interface">$top</span> и <span class="Interface">$select</span>
(см. <a href="#_ref379554692">здесь</a>).</p>

<a id="TI000001380" class="bookmark" name="issogl4_17.2.1.13.3_работа_с_планами_обмена"><h5>17.2.1.13.3. Работа с планами обмена</h5></a>

<a id="TI000001381" class="bookmark" name="issogl5_формирование_сообщения_обмена"><h6>Формирование сообщения обмена</h6></a>

<p class="MsoNormal">Для формирования сообщения обмена необходимо выполнить
POST-запрос с использованием URL следующего вида: <a href="http://host/base/odata/standard.odata/SelectChanges?&lt;params" target="_blank">http://host/base/odata/standard.odata/SelectChanges?&lt;params</a><span class="Interface">&gt;</span>.
Где в качестве параметров необходимо указать следующее:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Параметр <span class="Interface">DataExchangePoint</span> –
должен содержать канонический URL сущности треуемого элемента плана обмена;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Параметр <span class="Interface">MessageNo</span> –
должен содержать номер сообщения обмена данными, который будет сформирован в
результате данного вызова.</p>

<p class="MsoNormalCxSpFirst">В результате, полный URL для формирования сообщения
обмена, будет выглядеть следующим образом: <a href="http://host/base/odata/standard.odata/SelectChanges?DataExchangePoint='http://host/base/odata/standard.odata/ExchangePlan_ОбменДанными(guid'value')'&amp;MessageNo=34" target="_blank">http://host/base/odata/standard.odata/SelectChanges?DataExchangePoint='http://host/base/odata/standard.odata/ExchangePlan_ОбменДанными(guid'value')'&amp;MessageNo=34</a>.</p>

<p class="MsoNormalCxSpLast">В результате будет получен список изменений, которые
необходимо передать в другой узел, в виде потока atom-feed. Каждый элемент
будет представлен в формате atom-entry, а удаленные элементы будет представлены
в формате atom-deleted-entry (RFC 6721, <a href="http://tools.ietf.org/html/rfc6721" target="_blank">http://tools.ietf.org/html/rfc6721</a>, на
английском языке).</p>

<a id="TI000001382" class="bookmark" name="issogl5_уведомление_о_получении_изменений"><h6>Уведомление о получении изменений</h6></a>

<p class="MsoNormal">Для уведомления сервера о том, что сообщение обмена успешно
получено, необходимо выполнить POST-запрос с использованием URL следующего
вида: <a href="http://host/base/odata/standard.odata/SelectChanges?&lt;params" target="_blank">http://host/base/odata/standard.odata/ NotifyChangesReceived?&lt;params</a><span class="Interface">&gt;</span>. Где в
качестве параметров необходимо указать следующее:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Параметр <span class="Interface">DataExchangePoint</span> –
должен содержать канонический URL сущности требуемого элемента плана обмена;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Параметр <span class="Interface">MessageNo</span> –
должен содержать номер сообщения обмена данными, подтверждение получения
которого необходимо зафиксировать.</p>

<p class="MsoNormal">В результате, полный URL для подтверждения получения сообщения
обмена, будет выглядеть следующим образом: <a href="http://host/base/odata/standard.odata/NotifyChangesReceived?DataExchangePoint='http://host/base/odata/standard.odata/ExchangePlan_ОбменДанными(guid'value')'&amp;MessageNo=34" target="_blank">http://host/base/odata/standard.odata/NotifyChangesReceived?DataExchangePoint='http://host/base/odata/standard.odata/ExchangePlan_ОбменДанными(guid'value')'&amp;MessageNo=34</a>.</p>

<a name="_ref380409689"></a><a id="TI000001383" class="bookmark" name="issogl2_17.2.2_http-сервисы"><h3>17.2.2. HTTP-сервисы</h3></a>

<a name="_ref380507983"></a><a id="TI000001384" class="bookmark" name="issogl3_17.2.2.1_общая_информация"><h4>17.2.2.1. Общая информация</h4></a>

<p class="MsoNormalCxSpFirst">Помимо стандартного интерфейса OData
(см. <a href="#_ref380071959">здесь</a>), система «1С:Предприятие» позволяет прикладному
разработчику реализовать собственные HTTP-сервисы. Создание HTTP-сервисов
позволяет расширить (по сравнению со стандартным интерфейсом OData) или создать
(если стандартный интерфейса OData не используется) некий прикладной интерфейс,
который будет доступен с помощью HTTP-запросов. Общее описание протокола HTTP 1.1
приведено по ссылке: <a href="http://tools.ietf.org/html/rfc2616" target="_blank">http://tools.ietf.org/html/rfc2616</a>
(на английском языке).</p>

<p class="MsoNormalCxSpMiddle">HTTP-сервисы (REST-сервисы) являются аналогами
SOAP-сервисов, которые в «1С:Предприятии» представлены Web-сервисами
(см. <a href="#_ref380403400">здесь</a>). SOAP-сервис – это
набор параметризованных действий, причем перечень действий не ограничен. Набор
действий определяется во время разработки сервиса. HTTP-сервис – это
ограниченный набор действий (ограничен списком HTTP-методов) и разветвленный
набор ресурсов. Состав ресурсов определяем в процессе разработки сервиса. Набор
ресурсов и определяет функциональные возможности сервиса. При разработке SOAP-сервисов
также определяются структуры данных, передаваемые между клиентом и сервером, а при
разработке HTTP-сервиса – структуры передаваемых данных жестко не
определяются.</p>

<p class="MsoNormalCxSpMiddle">Обращение к HTTP-сервису выполняется по некоторому
URL. В качестве примера можно привести HTTP-сервис, который при обращении по
одному URL возвращает список каких-либо документов (например, расходных
накладных), а при обращении по другому URL будет возвращена конкретная
накладная. Действие, которое следует выполнить серверу, определяется тем, какой
HTTP-метод адресован серверу. Например, если на сервер отправляется GET-запрос,
то выполняется получение каких-либо данных, DELETE-запрос приводит к удалению
каких-либо данных и т. д.</p>

<p class="MsoNormalCxSpLast">При реализации HTTP-сервиса прикладной разработчик
определяет следующие элементы сервиса:</p>

<p class="MsoListNumberCxSpFirst">1. 
Определяет базовую часть URL, по которому будет
выполняться обращение к сервису.</p>

<p class="MsoListNumberCxSpMiddle">2. 
Определяет состав предоставляемой
функциональности и структуру ресурсов, на которые эта функциональность будет
отображаться.</p>

<p class="MsoListNumberCxSpMiddle">3. 
Определяет действия (HTTP-методы), которые можно
будет выполнить при обращении к тому или иному ресурсу.</p>

<p class="MsoListNumberCxSpLast">4. 
Для каждого выбранного действия реализуется
специальный метод, написанный на встроенном языке системы «1С:Предприятие»,
который и реализует необходимую функциональность. Метод расположен в
специальном модуле, связанным с HTTP-сервисом.</p>

<p class="MsoNormalCxSpFirst">После реализации HTTP-сервиса, необходимо опубликовать
его на веб-сервере с помощью стандартного механизма публикации.</p>

<p class="MsoNormalCxSpLast">При обращении к HTTP-сервису формируется URL,
который выглядит следующим образом: <a href="http://host/base/hs/корневойURL/относительныйURL" target="_blank">http://host/base/hs/корневойURL/относительныйURL</a>. Более подробно рассмотрим составные части
адреса:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
<a href="http://host/base" target="_blank">http://host/base</a> – обычный URL, по которому
выполняется доступ, например, к информационной базе с помощью веб-клиента. При
наличии разделителей, не поддерживается указание значений разделителей с
помощью параметра <span class="Interface">Z</span> командной строки запуска
клиентского приложения.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">hs</span> – признак
того, что выполняется обращение к HTTP-сервису (в отличие от <span class="Interface">ws</span>, который определяет доступ к Web-сервису).</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
<span class="Interface">корневойURL</span> –
имя ресурса, которое определяет группу ресурсов, связанных общим смыслом.
Задается в свойстве объекта <span class="Interface">HTTP-сервис</span>.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
<span class="Interface">относительныйURL</span> –
определяет ресурс, к которому будет выполняться обращение. Относительный URL,
указанный в запросе, будет использован для определения конкретного ресурса, к
которому выполнялось обращение. Правило сопоставления задается в объекте <span class="Interface">Шаблон URL</span>.</p>

<a name="_ref380409820"></a><a id="TI000001385" class="bookmark" name="issogl3_17.2.2.2_разработка_http-сервиса"><h4>17.2.2.2. Разработка HTTP-сервиса</h4></a>

<p class="MsoNormal">Создание HTTP-сервисов выполняется в ветке <span class="Interface">Общие – HTTP-сервисы</span> дерева объектов конфигурации.
Вначале создается собственно сервис, затем в каждом сервисе необходимо создать
определенный шаблон фрагмента URL (группу ресурсов), и затем для каждой группы ресурсов
необходимо определить HTTP-метод, который будет реализован для данной группы.
Также надо понимать, что один сервис может включать в себя более одного шаблона
URL (отношение «один ко многим»). Фактически, шаблон URL определяет группу
ресурсов, обрабатываемых по единым правилам.</p>

<a id="TI000001386" class="bookmark" name="issogl4_17.2.2.2.1_редактирование_http-сервиса"><h5>17.2.2.2.1. Редактирование HTTP-сервиса</h5></a>

<p class="MsoNormal">При создании HTTP-сервиса следует обратить внимание на
свойство <span class="Interface">Корневой URL</span>. Определяет группу ресурсов,
объединенных общим смыслом. Например, если необходимо создать несколько ресурсов,
которые работают с заказами, то корневой URL в этом случае может выглядеть как <span class="Interface">order</span>. Тогда начало URL при обращении к такому сервису
будет выглядеть следующим образом: <span class="Interface">http://host/base/hs/order</span>.</p>

<a id="TI000001387" class="bookmark" name="issogl4_17.2.2.2.2_редактирование_шаблона_url"><h5>17.2.2.2.2. Редактирование шаблона URL</h5></a>

<p class="MsoNormal">При создании шаблона URL описываются возможные адреса
ресурсов, которые можно будет использовать для обращения к HTTP-сервису.
Собственно шаблон задается в свойстве <span class="Interface">Шаблон</span>. При
создании шаблона можно использовать следующие символы:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Любые символы, допустимые в идентификаторах языка
«1С:Предприятие».</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Символ «<span class="Interface">/</span>»;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Символы «<span class="Interface">{}</span>» с
непустым текстом между ними;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Символ <span class="Interface">*</span>.</p>

<p class="MsoNormal">Например, шаблон может выглядить следующим образом:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
/query
/documents/{id}/props/{PropertyName}/*
</pre>

<p class="MsoNormal">При описании шаблона будут использовать следующие термины:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Сегмент – часть URL между двумя символами «<span class="Interface">/</span>» Например, <span class="Interface">props</span>, из
примера выше, является сегментом.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Параметризованный сегмент – сегмент,
заключенный в фигурные скобки («<span class="Interface">{сегмент}</span>»).
Фактически, параметризованный сегмент описывает переменную с указанным именем,
к которой можно получить доступ из встроенного языка.</p>

<p class="MsoNormalCxSpFirst">Сегмент (не параметризованный) из шаблона должен
быть перенесен в URL дословно. На месте параметризованного сегмента может
располагаться любое значение, допустимое в URL. Символ «<span class="Interface">*</span>» может
находиться только в конце шаблона. На месте символа «<span class="Interface">*</span>»
может находиться любое количество сегментов, включая отсутствие сегмента. В
одном шаблоне не может встречаться параметризованных сегментов с одинаковым
именем. Имя параметризованного сегмента может состоять только из букв, цифр и
символа «<span class="Interface">_</span>».</p>

<p class="MsoNormalCxSpLast">Шаблон вида <span class="Interface">/documents/*/number</span>
не является допустимым. Если задан шаблон вида <span class="Interface">/documents/{kind}/{number}</span>,
то являются допустимыми следующие URL сервиса:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
/documents/trade/13
/documents/12/test
</pre>

<p class="MsoNormal">При получении запроса система пытается определить, какой шаблон
следует использовать. Для этого выполняется попытка сопоставить текст входящего
запроса с заданными шаблонами. Сопоставление выполняется по следующим правилам:</p>

<p class="MsoListNumberCxSpFirst">1. 
Все строки сравниваются регистрозависимо;</p>

<p class="MsoListNumberCxSpMiddle">2. 
Точное совпадение всегда более приоритетно, чем соответствие
шаблону с параметризованными сегментами или символом «<span class="Interface">*</span>»;</p>

<p class="MsoListNumberCxSpMiddle">3. 
Символ «<span class="Interface">*</span>»
сопоставляется с любым количеством сегментов (включая отсутствие сегмента);</p>

<p class="MsoListNumberCxSpMiddle">4. 
Параметризованный сегмент имеет приоритет над
символом «<span class="Interface">*</span>»;</p>

<p class="MsoListNumberCxSpLast">5. 
Если переданному запросу не удалось однозначно
сопоставить ни один шаблон – будет сгенерирована ошибка.</p>

<p class="MsoNormal">Данные правила поясняют следующие примеры:</p>

<p class="MsoListNumberCxSpFirst">1. 
При сопоставлении URL <span class="Interface">/Накладная</span>
с шаблонами <span class="Interface">/Накладная/</span> и <span class="Interface">/{EntityName}/</span>
для использования будет выбран первый шаблон;</p>

<p class="MsoListNumberCxSpMiddle">2. 
Шаблон <span class="Interface">/Document/*/{Num}</span>
не является допустимым;</p>

<p class="MsoListNumberCxSpMiddle">3. 
URL <span class="Interface">/Накладная/500/Строки/2/Товар</span>
может быть сопоставлен шаблону <span class="Interface">/Накладная/*</span>;</p>

<p class="MsoListNumberCxSpMiddle">4. 
При сопоставлении URL <span class="Interface">/Накладная/500</span>
с шаблонами <span class="Interface">/Document/{Num}</span> и <span class="Interface">/{Document}/*</span>, для использования будет выбран первый
шаблон;</p>

<p class="MsoListNumberCxSpLast">5. 
При сопоставлении URL <span class="Interface">/Накладная/500/</span>
шаблонам <span class="Interface">{Document}/{Num}</span> и <span class="Interface">/{Document}/{Number}
</span>произойдет ошибка, т. к. не удалось однозначно выбрать шаблон.</p>

<a id="TI000001388" class="bookmark" name="issogl4_17.2.2.2.3_редактирование_метода"><h5>17.2.2.2.3. Редактирование метода</h5></a>

<p class="MsoNormal">Для созданного шаблона необходимо определить HTTP-методы,
которые могут быть использованы при работе с ресурсом, совпадающим с шаблоном.
Для этого необходимо создать нужное количество объектов <span class="Interface">Метод</span>,
подчиненных объекту <span class="Interface">Шаблон URL</span>. В каждом методе
необходимо указать свойство <span class="Interface">HTTP-метод</span> и создать
обработчик. Имя обработчика автоматически формируется из имени шаблона URL и
собственно имени метода. Так, если в шаблоне URL указано имя ПримерДляДокументации, и
для метода указано имя <span class="Interface">GET</span>, то для метода
встроенного языка, с помощью которого будет обрабатываться HTTP-запрос, использовано
имя обработчика <span class="Term">ПримерДляДокументацииGET()</span>.</p>

<p class="Note"><span class="Note">Совет.</span> Рекомендуется называть
объекты <span class="Interface">HTTP-метод</span> именем обслуживаемого метода на
английском языке.</p>

<p class="MsoNormal">Имеется возможность создать обработчики для следующих
методов:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
GET;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
POST;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
PUT;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
DELETE;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
PATCH;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
MERGE;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
CONNECT;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
OPTIONS;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
TRACE;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
PROPFIND;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
PROPPATCH;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
MKCOL;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
COPY;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
MOVE;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
LOCK;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
UNLOCK.</p>

<p class="MsoNormalCxSpFirst">Если создается обработчик для метода <span class="Interface">Любой</span>, то обработчик этого метода будет вызван для всех HTTP-методов
(из приведенного выше списка), которые явно не описаны в том шаблоне, который
«обрабатывает» входящий HTTP-запрос.</p>

<p class="MsoNormalCxSpMiddle">После получения необходимого шаблона, будет
предпринята попытка вызвать метод, обслуживающий нужный HTTP-запрос (GET, POST
и т. д.). Если обработчик для необходимого запроса не был обнаружен,
вызывающей стороне будет возвращена ошибка 405. Если в процессе исполнения
метода обнаружена ошибка встроенного языка – вызывающей стороне будет
возвращена ошибка 500, а в тело ответа будет помещен текст исключения.</p>

<p class="MsoNormalCxSpLast">При формировании ответа параметр <span class="Interface">Content-Length</span> может быть не задан. В этом случае он
будет определен автоматически.</p>

<a id="TI000001447" class="bookmark" name="issogl4_17.2.2.2.4_входные_и_выходные_данные_обработчика_метода"><h5>17.2.2.2.4. Входные и выходные данные обработчика метода</h5></a>

<p class="MsoNormalCxSpFirst">Обработчиком того или иного HTTP-метода является
функция, которая получает на вход один параметр типа HTTPСервисЗапрос и должна вернуть объект типа HTTPСервисОтвет.</p>

<p class="MsoNormalCxSpLast">Входной параметр полностью описывает запрос,
поступивший в систему. С помощью объекта можно определить:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Какой HTTP-метод используется в запросе
(свойство <span class="Term">HTTPМетод</span>);</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
На какой URL поступил запрос (свойство <span class="Term">БазовыйURL</span>) –
часть полного URL запроса, не включающая относительный URL
(см. <a href="#_ref380507983">здесь</a>) и параметры запроса;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Относительный URL (свойство <span class="Term">ОтносительныйURL</span>) –
часть полного URL запроса, которая использовалась для определения группы
ресурсов и правил обработки входящего HTTP-запроса;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Какие заголовки (свойство <span class="Term">Заголовки</span>)
содержит HTTP-запроса;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Какие параметризованные сегменты (свойство <span class="Term">ПараметрыURL</span>)
выделены из входящего HTTP-запроса и их значения.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Какие параметры (свойство <span class="Term">ПараметрыЗапроса)</span>
перечислены в URL HTTP-запроса после символа &quot;<span class="Interface">?</span>&quot;
и их значения.</p>

<p class="MsoNormalCxSpFirst">Также существует возможность получать тело запроса
в виде двоичных данных или строки (в зависимости от передаваемой информации).</p>

<p class="MsoNormalCxSpMiddle">Таким образом, прикладному разработчику не
требуется самостоятельно «разбираться» с входящим запросом. С помощью примера,
приведенного далее в этой главе (см. <a href="#_ref380509572">здесь</a>), можно смотреть, каким образом входящий HTTP-запрос
распределяется по свойствам объекта <span class="Term">HTTPСервисЗапрос</span>.</p>

<p class="MsoNormalCxSpLast">После того, как прикладное решение выполнило все
действия, которые определены для данного ресурса и HTTP-метода, необходимо
сформировать ответ сервиса. Для этого необходимо создать объект типа <span class="Term">HTTPСервисОтвет</span>.
В зависимости от результата обработки, следует указать свойство <span class="Term">КодСостояния</span>,
которое описывает стандартный код возврата HTTP (<a href="http://tools.ietf.org/html/rfc2616#section-10" target="_blank">http://tools.ietf.org/html/rfc2616#section-10</a>,
на английском языке). Затем, при необходимости, следует сформировать тело ответа
HTTP-сервиса. Тело может быть установлено как двоичные данные, как строка или с
помощью указания имени файла, откуда будет загружено тело ответа. Если тип
возвращаемого функцией (которая реализует реакцию на HTTP-метод) значения отличается
от <span class="Term">HTTPСервисОтвет</span>,
то клиенту будет возвращена 500 ошибка.</p>

<a id="TI000001389" class="bookmark" name="issogl3_17.2.2.3_примеры_реализации_http-сервисов"><h4>17.2.2.3. Примеры реализации HTTP-сервисов</h4></a>

<p class="Note"><span class="Note">Примечание.</span> Примеры, приведенные
ниже, не являются законченным. Они предназначены для демонстрации некоторых возможностей
HTTP-сервисов.</p>

<a name="_ref380509572"></a><a id="TI000001448" class="bookmark" name="issogl4_17.2.2.3.1_отображение_входящего_запроса"><h5>17.2.2.3.1. Отображение входящего запроса</h5></a>

<p class="Regularbeforepicture">В качестве примера реализуем HTTP-сервис, который
будет возвращать в качестве ответа все параметры входящего запроса.</p>

<p class="Picture"><IMG src="_img/img00458.gif?_=1496848987" WIDTH="662" ALT HEIGHT="455"></p>

<p class="MsoCaption">Рис. 450.
Тестовый пример</p>

<p class="MsoNormal">Для этого нужно создать HTTP-сервис <span class="Interface">ПримерРаботы</span>,
указав для него корневой URL <span class="Interface">example</span>. Затем следует для сервиса создать шаблон URL <span class="Interface">ПоказатьЗапрос</span>
с шаблоном /query/{string}/*. Теперь необходимо в шаблон <span class="Interface">ПоказатьЗапрос</span> добавить следующие
методы:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Метод <span class="Interface">GET</span> для HTTP-запроса <span class="Interface">GET</span>;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Метод <span class="Interface">ANY</span> для HTTP-запроса <span class="Interface">Любой</span>.</p>

<p class="MsoNormal">Обработчики должны
выглядеть следующим образом:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Функция</span> ПоказатьЗапросGET<span class="operator">(</span>Запрос<span class="operator">)</span>
    Ответ <span class="operator">=</span> <span class="keyword">Новый</span> HTTPСервисОтвет<span class="operator">(</span><span class="number">200</span><span class="operator">)</span><span class="operator">;</span>
    Результат <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="operator">;</span>
    Результат <span class="operator">=</span> Результат <span class="operator">+</span> Запрос<span class="operator">.</span>HTTPМетод <span class="operator">+</span> Символы<span class="operator">.</span>ПС<span class="operator">;</span>
    Результат <span class="operator">=</span> Результат <span class="operator">+</span> Запрос<span class="operator">.</span>БазовыйURL <span class="operator">+</span> Символы<span class="operator">.</span>ПС<span class="operator">;</span>
    Результат <span class="operator">=</span> Результат <span class="operator">+</span> Запрос<span class="operator">.</span>ОтносительныйURL <span class="operator">+</span> Символы<span class="operator">.</span>ПС<span class="operator">;</span>
    Результат <span class="operator">=</span> Результат <span class="operator">+</span> <span class="string">&quot;Заголовки:&quot;</span> <span class="operator">+</span> Символы<span class="operator">.</span>ПС<span class="operator">;</span>
    <span class="keyword">Для</span> <span class="keyword">каждого</span> Параметр <span class="keyword">Из</span> Запрос<span class="operator">.</span>Заголовки <span class="keyword">Цикл</span>
        Результат <span class="operator">=</span> Результат <span class="operator">+</span> Параметр<span class="operator">.</span>Ключ <span class="operator">+</span> <span class="string">&quot;:&quot;</span> <span class="operator">+</span> Параметр<span class="operator">.</span>Значение <span class="operator">+</span> Символы<span class="operator">.</span>ПС<span class="operator">;</span>
    <span class="keyword">КонецЦикла</span><span class="operator">;</span>
    Результат <span class="operator">=</span> Результат <span class="operator">+</span> <span class="string">&quot;Параметры URL:&quot;</span> <span class="operator">+</span> Символы<span class="operator">.</span>ПС<span class="operator">;</span>
    <span class="keyword">Для</span> <span class="keyword">каждого</span> Параметр <span class="keyword">Из</span> Запрос<span class="operator">.</span>ПараметрыURL <span class="keyword">Цикл</span>
        Результат <span class="operator">=</span> Результат <span class="operator">+</span> Параметр<span class="operator">.</span>Ключ <span class="operator">+</span> <span class="string">&quot;:&quot;</span> <span class="operator">+</span> Параметр<span class="operator">.</span>Значение <span class="operator">+</span> Символы<span class="operator">.</span>ПС<span class="operator">;</span>
    <span class="keyword">КонецЦикла</span><span class="operator">;</span>
    Результат <span class="operator">=</span> Результат <span class="operator">+</span> <span class="string">&quot;Параметры запроса:&quot;</span> <span class="operator">+</span> Символы<span class="operator">.</span>ПС<span class="operator">;</span>
    <span class="keyword">Для</span> <span class="keyword">каждого</span> Параметр <span class="keyword">Из</span> Запрос<span class="operator">.</span>ПараметрыЗапроса <span class="keyword">Цикл</span>
        Результат <span class="operator">=</span> Результат <span class="operator">+</span> Параметр<span class="operator">.</span>Ключ <span class="operator">+</span> <span class="string">&quot;:&quot;</span> <span class="operator">+</span> Параметр<span class="operator">.</span>Значение <span class="operator">+</span> Символы<span class="operator">.</span>ПС<span class="operator">;</span>
    <span class="keyword">КонецЦикла</span><span class="operator">;</span>
    Ответ<span class="operator">.</span>УстановитьТелоИзСтроки<span class="operator">(</span>Результат<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Возврат</span> Ответ<span class="operator">;</span>
<span class="keyword">КонецФункции</span>
<span class="keyword">Функция</span> ПоказатьЗапросANY<span class="operator">(</span>Запрос<span class="operator">)</span>
    Ответ <span class="operator">=</span> <span class="keyword">Новый</span> HTTPСервисОтвет<span class="operator">(</span><span class="number">405</span><span class="operator">)</span><span class="operator">;</span>
    Ответ<span class="operator">.</span>УстановитьТелоИзСтроки<span class="operator">(</span><span class="string">&quot;Данный HTTP-сервис не поддерживает метод &quot;</span> <span class="operator">+</span> Запрос<span class="operator">.</span>HTTPМетод<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Возврат</span> Ответ<span class="operator">;</span>
<span class="keyword">КонецФункции</span> </pre>

<p class="MsoNormalCxSpFirst">После публикации
HTTP-сервисов, <a href="/db/v8310doc/bookmark/adm/TI000000451" target="_top">описанной в книге 1С:Предприятие 8.3. &quot;Руководство администратора&quot;</a>, сервис должен
возвращать полное «описание» поступившего на вход запроса.</p>

<p class="MsoNormalCxSpLast">При
использовании следующего запроса: <a href="://localhost/db/content/v8310doc/src/руководство разработчика//httpservice/hs/example/query/value/another?p1=1&amp;p2=2"> http://localhost/httpservice/hs/example/query/value/another?p1=1&amp;p2=2</a> будет получен следующий ответ (значение
некоторых заголовков зависит от используемого веб-браузера):</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
GET
http://localhost/httpservice/hs/example
/query/value/another
Заголовки:
Accept-Encoding:gzip,deflate,sdch
Connection:keep-alive
Accept-Language:ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4
DNT:1
Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Content-Length:0
User-Agent:Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.107 Safari/537.36
Host:localhost
Параметры URL:
*:/another
string:value
Параметры запроса:
p1:1
p2:2
</pre>

<p class="MsoNormalCxSpFirst">Рассмотрим, каким образом был разобран запрос. В
примере было указано, что корневой URL сервиса – <span class="Interface">example</span>,
шаблон URL – /query/{string}/*
и был сформирован обработчик HTTP-запроса GET.</p>

<p class="MsoNormalCxSpLast">В результате видно, что система определила следующие
параметры URL:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Параметр <span class="Interface">*</span> со
значением <span class="Interface">/another</span>;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Параметр <span class="Interface">string</span> со
значением <span class="Interface">value</span>.</p>

<p class="MsoNormalCxSpFirst">Это полностью соответствует указанному шаблону URL.
Если шаблон URL установить в значение <span class="Interface">/query/{string}</span>,
то демонстрационный запрос закончится сообщением об ошибке 404, т. к.
такой шаблон не будет допускать наличие в URL информации, после
параметризованного сегмента.</p>

<p class="MsoNormalCxSpMiddle">Также в обработчике метода будут переданы все
параметры запроса, которые были указаны в URL.</p>

<p class="MsoNormalCxSpLast">Любой другой вид запроса (отличный от GET) будет приводить
к ошибке 405 с указанием, какой именно запрос не поддерживается сервисом.</p>

<a name="_ref380593566"></a><a id="TI000001449" class="bookmark" name="issogl4_17.2.2.3.2_работа_с_документами"><h5>17.2.2.3.2. Работа с документами</h5></a>

<p class="MsoNormal">Данный пример является некоторым аналогом Web-сервиса,
который должен по переданному номеру расходной накладной возвращать состав ее табличной
части (см. <a href="#_ref380591312">здесь</a>).</p>

<p class="Regularbeforepicture">Данный пример будет предоставлять возможность
получить список «документов» и получить «документ» по номеру. Также будет
реализована реакция на неверный номер «документа». Для упрощения примера реальных
объектов типа <span class="Term">Документ</span>
в примере создано не будет.</p>

<p class="Picture"><IMG src="_img/img00459.gif?_=1496848987" WIDTH="800" ALT HEIGHT="391"></p>

<p class="MsoCaption">Рис. 451.
Тестовый пример</p>

<p class="MsoNormalCxSpFirst">Для этого нужно создать HTTP-сервис <span class="Interface">СписокДокументов</span>, указав для него корневой URL <span class="Interface">documents</span>. Затем следует для сервиса создать шаблон URL <span class="Interface">Список</span> с шаблоном <span class="Interface">/*</span> и
шаблон URL <span class="Interface">Документ</span> с шаблоном <span class="Interface">/{number}</span>. Для каждого шаблона URL следует добавить
реализацию метода GET.</p>

<p class="MsoNormalCxSpLast">Обработчики должны выглядеть следующим образом:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Функция</span> СписокGET<span class="operator">(</span>Запрос<span class="operator">)</span>
    Ответ <span class="operator">=</span> <span class="keyword">Новый</span> HTTPСервисОтвет<span class="operator">(</span><span class="number">200</span><span class="operator">)</span><span class="operator">;</span>
    Результат <span class="operator">=</span> <span class="string">&quot;Расходная накладная, 1, 01.01.2014</span>
<span class="string">    |Расходная накладная, 2, 01.01.2014&quot;</span><span class="operator">;</span>
    Ответ<span class="operator">.</span>УстановитьТелоИзСтроки<span class="operator">(</span>Результат<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Возврат</span> Ответ<span class="operator">;</span>
<span class="keyword">КонецФункции</span>
<span class="keyword">Функция</span> ДокументGET<span class="operator">(</span>Запрос<span class="operator">)</span>
    Ответ <span class="operator">=</span> <span class="keyword">Новый</span> HTTPСервисОтвет<span class="operator">(</span><span class="number">200</span><span class="operator">)</span><span class="operator">;</span>
    Номер <span class="operator">=</span> Число<span class="operator">(</span>Запрос<span class="operator">.</span>ПараметрыURL<span class="operator">.</span>Получить<span class="operator">(</span><span class="string">&quot;number&quot;</span><span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Если</span> Номер <span class="operator">&gt;</span> <span class="number">2</span> <span class="keyword">Тогда</span>
        Ответ<span class="operator">.</span>КодСостояния <span class="operator">=</span> <span class="number">404</span><span class="operator">;</span>
        Ответ<span class="operator">.</span>УстановитьТелоИзСтроки<span class="operator">(</span><span class="string">&quot;Отсутствует документ с номером: &quot;</span> <span class="operator">+</span> Номер<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Иначе</span>
        <span class="keyword">Если</span> Номер<span class="operator">=</span><span class="number">1</span> <span class="keyword">Тогда</span>
            Ответ<span class="operator">.</span>УстановитьТелоИзСтроки<span class="operator">(</span><span class="string">&quot;Расходная накладная, 1, 01.01.2014&quot;</span><span class="operator">)</span><span class="operator">;</span>
        <span class="keyword">Иначе</span>
            Ответ<span class="operator">.</span>УстановитьТелоИзСтроки<span class="operator">(</span><span class="string">&quot;Расходная накладная, 2, 01.01.2014&quot;</span><span class="operator">)</span><span class="operator">;</span>
        <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    <span class="keyword">Возврат</span> Ответ<span class="operator">;</span>
<span class="keyword">КонецФункции</span></pre>

<p class="MsoNormalCxSpFirst">После публикации HTTP-сервисов,
<a href="/db/v8310doc/bookmark/adm/TI000000451" target="_top">описанной в книге 1С:Предприятие 8.3. &quot;Руководство администратора&quot;</a>, сервис должен возвращать некоторый
набор данных о документах, «хранящихся» в системе.</p>

<p class="MsoNormalCxSpLast">Рассмотрим, каким образом работает созданный сервис:</p>

<p class="MsoListBullet">&#9679; 
Запрос <a href="http://localhost/httpservice/hs/documents" target="_blank">http://localhost/httpservice/hs/documents</a> вернет список «документов»:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">
Расходная накладная, 1, 01.01.2014
Расходная накладная, 2, 01.01.2014
</pre>

<p class="MsoListBulletCxSpFirst">&#9679; 
Запрос вида <a href="http://localhost/httpservice/hs/documents" target="_blank">http://localhost/httpservice/hs/documents</a><span class="Interface">/get/list</span> вернет
список «документов», т. к. этот запрос соответствует шаблону <span class="Interface">Список</span> и не соответствует шаблону <span class="Interface">Документ</span>.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Запрос вида <a href="http://localhost/httpservice/hs/documents" target="_blank">http://localhost/httpservice/hs/documents</a><span class="Interface">/list</span> вернет
ошибку времени исполнения, т. к. приведенный запрос соответствует
шаблону <span class="Interface">Документ</span>, но в функции <span class="Term">ДокументGET()</span> нет
проверки на то, что переданный номер является числом.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Запрос вида <a href="http://localhost/httpservice/hs/documents" target="_blank">http://localhost/httpservice/hs/documents</a><span class="Interface">/2</span> вернет
«документ» с номером 2:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">Расходная накладная, 2, 01.01.2014</pre>

<p class="MsoListBullet">&#9679; 
Запрос вида <a href="http://localhost/httpservice/hs/documents" target="_blank">http://localhost/httpservice/hs/documents</a><span class="Interface">/3</span> вернет ошибку:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_res">Отсутствует документ с номером: 3</pre>

<p class="Indentlist">Обработка корректности номера документа явно реализована в
обработчике метода.</p>

<a id="TI000001390" class="bookmark" name="issogl3_17.2.2.4_установка_значений_разделителей"><h4>17.2.2.4. Установка значений разделителей</h4></a>

<p class="MsoNormal">Значения разделителей можно устанавливать только следующими
способами:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
С помощью фрагментов URL при обращении к
REST-сервису;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
С помощью файла описания публикации <span class="Interface">default.vrd</span>.</p>

<p class="MsoNormal">Указанием разделителей с помощью параметры командной строки <span class="Interface">Z</span> не поддерживается.</p>

<a id="TI000001391" class="bookmark" name="issogl3_17.2.2.5_публикация_http-сервиса"><h4>17.2.2.5. Публикация HTTP-сервиса</h4></a>

<p class="MsoNormal">Публикация HTTP-сервисов выполняется с помощью диалога
публикации на веб-сервере (<span class="Interface">Администрирование –
Публикация на веб-сервере</span>) и <a href="/db/v8310doc/bookmark/adm/TI000000451" target="_top">описана в книге 1С:Предприятие 8.3. &quot;Руководство администратора&quot;</a>.</p>

<a name="_ref449633298"></a><a name="_ref451869302"></a><a name="_ref451869301"></a><a id="TI000001852" class="bookmark" name="issogl1_17.3_повторное_использование_сеансов_интернет-сервисов"><h2>17.3. Повторное использование сеансов интернет-сервисов</h2></a>

<a id="TI000001853" class="bookmark" name="issogl2_17.3.1_общая_информация"><h3>17.3.1. Общая информация</h3></a>

<p class="MsoNormal">Устройство системы «1С:Предприятие» таково, что вызов
интернет-сервиса (Web-сервис,
HTTP-сервис,
стандартный интерфейс OData)
и запуск клиентского приложения выглядит примерно одинаково – система
создается сеанс работы с информационной базой (подробнее см. <a href="/db/v8310doc/bookmark/cs/TI000000025" target="_top">здесь</a>),
в котором и выполняются все необходимые действия. При завершении вызова интернет-сервиса
(и при завершении работы клиентского приложения) сеанс завершается, а при
повторном вызове процесс повторяется заново. Очевидным недостатком такого
поведения является существенное время, которое тратит система на создание
сеанса (включая выполнение всех обработчиков событий и загрузку собственно
конфигурации). Особенно это заметно на «больших» прикладных решениях, которые
содержат много различных объектов конфигурации. Для клиентского приложения
время создания сеанса может быть несущественным (на фоне общего времени
непрерывной работы клиентского приложения), а для интернет-сервисов это время
может привносить существенные задержки в общее время вызова сервиса. Система
предоставляет возможность управлять необходимостью создания сеанса при каждом
вызове интернет-сервиса:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Не использовать повторное использование сеансов.
При каждом обращении к интернет-сервису будет создаваться новый сеанс.</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
Включить повторное использование сеансов. В этом
случае создание и завершение сеансов регулируется вызывающей стороной с помощью
заголовков HTTP-запроса.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Включить автоматическое повторное использование
сеансов. В этом случае системой организуется пул сеансов. Каждый сеанс в пуле
характеризуется некоторым набором параметров. Если сеанс в пуле свободен и
характеризуется тем же набором параметров, что и запрос интернет-сервиса, то
запросу сразу будет предоставлен существующий сеанс.</p>

<p class="MsoNormal">Возможность повторного использования сеансов настраивается в
нескольких местах:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
в свойствах объектов конфигурации Web-сервис и
HTTP-сервис (вид повторного использования и время жизни сеанса);</p>

<p class="MsoListBulletCxSpLast">&#9679; 
в файле публикации <span class="Interface">default.vrd</span>
(параметры пула сеансов).</p>

<p class="MsoNormal">Следует помнить, что значения, указанные в файле <span class="Interface">default.vrd</span>, имеют приоритет над значениями, которые
заданы в свойствах объектов конфигурации.</p>

<a name="_ref449696605"></a><a id="TI000001854" class="bookmark" name="issogl2_17.3.2_виды_повторного_использования_сеансов"><h3>17.3.2. Виды повторного использования сеансов</h3></a>

<p class="Lang-parameter">Не использовать</p>

<p class="MsoNormal">В этом случае
каждый запрос интернет-сервиса приведет к созданию нового сеанса.</p>

<p class="Lang-parameter">Использовать</p>

<p class="MsoNormal">В этом случае
временем жизни и характером повторного использования сеанса управляет
непосредственно клиент интернет-сервиса. В этом случае для управления созданием
нового сеанса используются специальные заголовки HTTP-запроса к интернет-сервису.</p>

<p class="Lang-parameter">Использовать автоматически</p>

<p class="MsoNormal">Пул сеансов ведется в разрезе следующих параметров:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
тип сервиса;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
имя сервиса;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
пользователь;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
пароль;</p>

<p class="MsoListBulletCxSpMiddle">&#9679; 
набор разделителей;</p>

<p class="MsoListBulletCxSpLast">&#9679; 
безопасный режим.</p>

<p class="MsoNormalCxSpFirst">При обнаружении входящего запроса к
интернет-сервису, система анализирует текущий пул сеансов и ищет сеанс с
параметрами, в точности соответствующими входящему запросу. Если такой сеанс
обнаруживается и он не используется запросом от другого клиента
интернет-сервиса, входящий запрос будет обслуживаться найденным сеансом. Если
свободного сеанса не найдено – выполняется попытка создать новый сеанс.
Если при попытке создания нового сеанса будет превышен размер пула сеансов –
входящий запрос будет ожидать некоторое время (таймаут пула). Если по истечению
таймаута пула свободный сеанс не обнаруживается – интернет-запрос будет
завершен с ошибкой <span class="Interface">406 Not </span><span class="Interface">Acceptable</span>. Свободный
сеанс будет уничтожен системой автоматически после истечения времени жизни
свободного сеанса.</p>

<p class="MsoNormalCxSpMiddle">Настройки автоматического пула сеансов действуют в
рамках публикации. Таким образом, если для некоторой информационной базы
созданы несколько публикаций, то при вызове интернет-сервиса используется
настройка пула той публикации, через которую выполняется вызов.</p>

<p class="MsoNormalCxSpLast">Рекомендуется подбирать такой размер пула сеансов,
чтобы при максимальной загрузке в пуле оставалось несколько свободных сеансов
(т.е. выбирать размер пула с небольшим запасом). В противном случае при пиковой
нагрузке некоторые вызовы будут завершаться с ошибками. Система «1С:Предприятие»
не поддерживает автоматическое определение необходимого размера пула сеансов.</p>

<a id="TI000001855" class="bookmark" name="issogl2_17.3.3_настройки_повторного_использования_сеансов"><h3>17.3.3. Настройки повторного использования сеансов</h3></a>

<a id="TI000001856" class="bookmark" name="issogl3_17.3.3.1_свойства_интернет-сервисов"><h4>17.3.3.1. Свойства интернет-сервисов</h4></a>

<p class="MsoNormal">В палитре свойств
интернет-сервисов (Web-сервис,
HTTP-сервис)
присутствует два свойства, описывающие повторное использование сеансов:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Свойство <span class="Interface">Повторное
использование сеансов</span> – указывает вид повторного использования
сеансов для настраиваемого сервиса (подробнее см. <a href="#_ref449696605">здесь</a>).</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Свойство <span class="Interface">Время жизни
сеанса</span>:</p>

<p class="MsoListBullet2CxSpFirst">&#9679; 
описывает, через какой промежуток времени «свободный»
сеанс будет удален из пула сеансов (в случае автоматического повторного
использования сеансов);</p>

<p class="MsoListBullet2CxSpLast">&#9679; 
описывает, через какое время бездействия сеанс
будет принудительно завершен системой при ручном повторном использовании
сеансов.</p>

<p class="Indentlist">Если данное свойство установлено в значение 0, то это
означает, что сеансов повторно не используются. Такая установка эквивалентна
установке свойства <span class="Interface">Повторное использование сеансов</span>
в значение <span class="Interface">Не использовать</span>.</p>

<p class="MsoNormalCxSpFirst">Параметры пула сеансов для автоматического
повторного использования сеансов настраиваются с помощью файла <span class="Interface">default.vrd</span> (подробнее см. <a href="/db/v8310doc/bookmark/adm/TI000000379" target="_top">здесь</a>).</p>

<p class="MsoNormalCxSpLast">Для собственных интернет-сервисов расширения конфигурации
(см. <A href="/db/content/v8310doc/src/руководство разработчика/глава 32. расширение конфигурации.htm?_=1496848987#_ref405464478">здесь</a>) не поддерживается управление данными свойствами с
помощью конфигуратора. Однако имеется возможность вручную настроить данные
свойства после публикации интернет-сервисов расширения с помощью конфигуратора.</p>

<a id="TI000001857" class="bookmark" name="issogl3_17.3.3.2_на_стороне_клиента"><h4>17.3.3.2. На стороне клиента</h4></a>

<p class="MsoNormal">Если для
интернет-сервиса в качестве значения свойства <span class="Interface">Повторное
использование сеансов</span>, то в этом случае управлением временем жизни
сеанса занимается клиент интернет-сервиса. В качестве управляющего элемента выступает заголовок HTTP-запроса <span class="Term">IBSession</span>. Этот заголовок может принимать два
значения:</p>

<p class="MsoListBullet">&#9679; 
<span class="Term">start</span> – в этом случае система «1С:Предприятие»
создает новый сеанс, выполняет аутентификацию, устанавливает разделители,
выполняются все необходимые обработчики событий. Если система не может создать
новый сеанс, то клиент получит ошибку <span class="Interface">406 Not </span><span class="Interface">Acceptable</span>.
Если создание сеанса выполнено успешно, в HTTP-ответ помещается директива установить cookie <span class="Term">ibs</span><span class="Term">ession</span> с
идентификатором созданного сеанса: <span class="Interface">Set-Cookie: </span><span class="Interface">ibsession=&lt;ID
сеанса&gt;</span>.</p>

<p class="IndentlistCxSpFirst">При необходимости использовать ранее созданный
сеанс, необходимо в HTTP-запросе
к системе «1С:Предприятие» указать идентификатор ранее созданного сеанса: <span class="Interface">Cookie: </span><span class="Interface">ibsession=&lt;ID сеанса&gt;</span>. Если
в запросе указывается идентификатор сеанса, который ранее не создавался или был
завершен, клиент получает ошибку <span class="Interface">400 </span><span class="Interface">Bad </span><span class="Interface">Request</span>.</p>

<p class="IndentlistCxSpMiddle">Если в HTTP-запрос не содержит заголовка <span class="Term">IBSession</span>, то
сеанс создается и завершается при каждом вызове интернет-сервиса.</p>

<p class="IndentlistCxSpLast">Если в процессе использования сеанса в HTTP-запросе изменяются значения
разделителей или безопасный режим сеанса, то новые параметры игнорируются и
сеанс будет использовать те значения, которые были указаны при старте сеанса.</p>

<p class="MsoListBullet">&#9679; 
<span class="Term">finish</span> – в этом случае система «1С:Предприятие»
завершает сеанс, который указан в запросе, одновременно с командой завершения
сеанса: <span class="Interface">Cookie: </span><span class="Interface">ibsession=&lt;ID сеанса&gt;</span>.
Завершение сеанса произойдет автоматически, если в этом сеансе не выполнялось
никаких действий за время жизни сеанса.</p>

<p class="MsoNormal">Пул сеансов в этом случае не используется.</p>

<a id="TI000001858" class="bookmark" name="issogl3_17.3.3.3_в_файле_default.vrd"><h4>17.3.3.3. В файле default.vrd</h4></a>

<p class="MsoNormalCxSpFirst">Описание параметров
файла <span class="Interface">default.vrd</span>, которые управляют повторным
использованием сеансов, см. <a href="/db/v8310doc/bookmark/adm/TI000000379" target="_top">здесь</a>.</p>

<p class="MsoNormalCxSpLast">Если интернет-сервис
расширения конфигурации не опубликован в файле <span class="Interface">default.vrd</span>
или в публикации явно не указано правило повторного использования сеансов –
повторное использование сеансов не поддерживается и для каждого вызова
создается новый сеанс.</p>

<a id="TI000001859" class="bookmark" name="issogl3_17.3.3.4_для_стандартного_интерфейса_odata"><h4>17.3.3.4. Для стандартного интерфейса OData</h4></a>

<p class="MsoNormal">Режим и параметры повторного
использования сеансов для стандартного интерфейса OData устанавливаются
системой «1С:Предприятие» при публикации стандартного интерфейса OData на
веб-сервере. При этом по умолчанию используются следующие значения:</p>

<p class="MsoListBulletCxSpFirst">&#9679; 
Повторное использование сеансов – включено
автоматическое использование.</p>

<p class="MsoListBulletCxSpLast">&#9679; 
Время жизни сеанса – 20 секунд.</p>

<p class="MsoNormalCxSpFirst"> </p>

<br>		<script type="text/javascript">listenCopy('zeroclipboard.swf');</script>
	</body>
</html>